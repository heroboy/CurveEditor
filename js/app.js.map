{"version":3,"file":"app.js","sources":["../../src/ControlPoint.ts","../../src/curves/AbstractCurve.ts","../../src/curves/util.ts","../../src/curves/BaseCurveCurve.ts","../../src/curves/CatmullRomCurve3.ts","../../src/curves/QuadraticBezierCurve3.ts","../../src/curves/CubicBezierCurve3.ts","../../src/curves/ArcCurve.ts","../../src/curves/TranslationGhostCurve.ts","../../src/curves/MirrorGhostCurve.ts","../../src/curves/index.ts","../../src/CurveObject.ts","../../src/ObjectPickControl.ts","../../src/util/EventDispatcherHelper.ts","../../src/control/PlaneDragControl.ts","../../src/ControlPointSelection.ts","../../src/AnimationPreviewControl.ts","../../src/ui/controls/NumberBox.tsx","../../src/ui/controls/ControlPointEditor.tsx","../../src/ui/controls/TranslationGhostCurveEditor.tsx","../../src/ui/controls/IndeterminateCheckbox.tsx","../../src/ui/controls/MirrorGhostCurveEditor.tsx","../../src/ui/controls/CurveEditor.tsx","../../src/ui/controls/AnimationEditor.tsx","../../src/ui/controls/Panel.tsx","../../src/ui/UIApplication.tsx","../../src/Application.ts","../../src/main.ts"],"sourcesContent":["import { Application } from './Application'\r\nimport { CurveObject } from './CurveObject'\r\nimport * as CurveImpl from './curves'\r\nconst UNSELECTED_COLOR = 0xff0000;\r\nconst SELECTED_COLOR = 0x00ff00;\r\nconst UNHOVERED_OPACITY = 0.7;\r\nconst HOVERED_OPACITY = 1;\r\n\r\nexport class ControlPoint\r\n{\r\n\tpoint: THREE.Vector3;\r\n\tindex: number = -1;\r\n\tcurve: CurveObject;\r\n\tdisposed = false;\r\n\tprivate _attached = false;\r\n\tprivate _box: THREE.Mesh;\r\n\tprivate _hovered = false;\r\n\tprivate _selected = false;\r\n\tprivate _forward = new THREE.Vector3(1, 0, 0);\r\n\tprivate _rotation = 0;\r\n\t//private _isOnCurve = false;\r\n\tconstructor(curve: CurveObject, x?: number, y?: number, z?: number)\r\n\t{\r\n\t\tconst SCALE = 90;\r\n\t\tthis.curve = curve;\r\n\t\tthis.point = new THREE.Vector3(x, y, z);\r\n\t\tvar geom = new THREE.BoxBufferGeometry(0.2 * SCALE, 0.2 * SCALE, 0.2 * SCALE);\r\n\t\tvar mat = new THREE.MeshLambertMaterial({\r\n\t\t\tcolor: UNSELECTED_COLOR,\r\n\t\t\ttransparent: true,\r\n\t\t\topacity: UNHOVERED_OPACITY\r\n\t\t});\r\n\t\tvar box = this._box = new THREE.Mesh(geom, mat);\r\n\t\tbox.position.copy(this.point);\r\n\t\tconst ARROW_SCALE = 0.2 * SCALE;\r\n\t\tbox.add(\r\n\t\t\tnew THREE.ArrowHelper(new THREE.Vector3(1, 0, 0), new THREE.Vector3(-1 * ARROW_SCALE, 0, 0), 2 * ARROW_SCALE, 0xff0000, 0.3 * ARROW_SCALE, 0.18 * ARROW_SCALE),\r\n\t\t\tnew THREE.ArrowHelper(new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, 0 * ARROW_SCALE, 0), 1.5 * ARROW_SCALE, 0x00ff00, 0.3 * ARROW_SCALE, 0.18 * ARROW_SCALE),\r\n\t\t\tnew THREE.ArrowHelper(new THREE.Vector3(0, 0, 1), new THREE.Vector3(0, 0, -1 * ARROW_SCALE), 3 * ARROW_SCALE, 0x0000ff, 0.5 * ARROW_SCALE, 0.18 * ARROW_SCALE),\r\n\t\t);\r\n\r\n\t\t{\r\n\t\t\tvar geom2 = new THREE.BoxBufferGeometry(0.1 * SCALE, 0.1 * SCALE, 0.5 * SCALE);\r\n\t\t\tvar mat2 = new THREE.MeshLambertMaterial({ color: 0xff0000 });\r\n\t\t\tbox.add(new THREE.Mesh(geom2, mat2));\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tvar geom3 = new THREE.BoxBufferGeometry(0.3 * SCALE, 0.02 * SCALE, 0.4 * SCALE);\r\n\t\t\tvar mat3 = new THREE.MeshLambertMaterial({ color: 0x0000ff });\r\n\t\t\tbox.add(new THREE.Mesh(geom3, mat3));\r\n\t\t}\r\n\r\n\t\tbox['controlPoint'] = this;\r\n\t\tbox['dispose'] = function ()\r\n\t\t{\r\n\t\t\t(box.material as any).dispose();\r\n\t\t\tbox.geometry.dispose();\r\n\t\t\tgeom2.dispose();\r\n\t\t\tmat2.dispose();\r\n\t\t\tgeom3.dispose();\r\n\t\t\tmat3.dispose();\r\n\t\t}\r\n\t\tbox.addEventListener('hoveron', e => { this.hovered = true; });\r\n\t\tbox.addEventListener('hoveroff', e => { this.hovered = false; });\r\n\t\tthis.visible = curve.visible;\r\n\t}\r\n\r\n\treset(x, y, z, rotation)\r\n\t{\r\n\t\tthis.point.set(x, y, z);\r\n\t\tthis._rotation = rotation;\r\n\t\tthis.mesh.position.copy(this.point);\r\n\t}\r\n\r\n\tget mesh() { return this._box; }\r\n\tget hovered() { return this._hovered; }\r\n\tget selected() { return this._selected; }\r\n\tget visible() { return this._box.visible; }\r\n\tget selectable() { return this._box['disablePick'] !== true; }\r\n\t//get isOnCurve() { return this._isOnCurve; }\r\n\tset hovered(val)\r\n\t{\r\n\t\tthis._hovered = val;\r\n\t\tthis._box['material']['opacity'] = ((this._hovered && !this._selected) ? HOVERED_OPACITY : UNHOVERED_OPACITY);\r\n\t}\r\n\r\n\tset selected(val)\r\n\t{\r\n\t\tthis._selected = val;\r\n\t\tthis._box['material']['color'].set(this._selected ? SELECTED_COLOR : UNSELECTED_COLOR);\r\n\t\tthis._box['material']['opacity'] = ((this._hovered || !this._selected) ? HOVERED_OPACITY : UNHOVERED_OPACITY);\r\n\t\tthis.mesh.scale.setScalar(this._selected ? 0.5 : 1);\r\n\t}\r\n\tset visible(val) \r\n\t{\r\n\t\tthis._box.visible = val;\r\n\t}\r\n\tset selectable(val) { this._box['disablePick'] = !val; }\r\n\t// set isOnCurve(val)\r\n\t// {\r\n\t// \tthis._isOnCurve = val;\r\n\t// \tfor (var inner of this._box.children)\r\n\t// \t{\r\n\t// \t\tinner.visible = val;\r\n\t// \t}\r\n\t// }\r\n\r\n\trefreshAllowRotation()\r\n\t{\r\n\t\tthis.allowRotation = this.curve.curve.allowPointRotation(this.index);\r\n\t}\r\n\r\n\tset allowRotation(val)\r\n\t{\r\n\t\tfor (var inner of this._box.children)\r\n\t\t{\r\n\t\t\tinner.visible = val;\r\n\t\t}\r\n\t}\r\n\tget allowRotation() { return this.curve.curve.allowPointRotation(this.index); }\r\n\tget allowTranslation() { return this.curve.curve.allowPointTranslation(this.index); }\r\n\tattachTo(app: Application)\r\n\t{\r\n\t\tif (this._attached) return;\r\n\t\tthis._attached = true;\r\n\t\tapp.scene.add(this._box);\r\n\t\tapp.addControlPoint(this);\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tif (this._box.parent)\r\n\t\t{\r\n\t\t\tthis._box.parent.remove(this._box);\r\n\t\t}\r\n\t\tthis._box['dispose']();\r\n\t\tthis.disposed = true;\r\n\t\tapp.removeControlPoint(this);\r\n\t}\r\n\r\n\r\n\tget forward() { return this._forward; }\r\n\tget rotation() { return this._rotation; }\r\n\r\n\r\n\t_updateFromLogicCurve(index: number, curve: CurveImpl.ICurveImpl)\r\n\t{\r\n\t\tthis.index = index;\r\n\t\tcurve.getPointPosition(index, this.point);\r\n\t\tcurve.getPointForward(index, this._forward);\r\n\t\tthis._rotation = curve.getPointRotation(index);\r\n\t\tthis.mesh.position.copy(this.point);\r\n\t\tcurve.getPointQuaternion(this.index, this.mesh.quaternion);\r\n\t\tthis.refreshAllowRotation();\r\n\t}\r\n\r\n\r\n\t//private _updateRotation()\r\n\t//{\r\n\t// var mesh = this.mesh;\r\n\t// if (!this.isOnCurve)\r\n\t// {\r\n\t// \tmesh.quaternion.set(0, 0, 0, 1);\r\n\t// \treturn;\r\n\t// }\r\n\t// var pcp = this.curve.getPreviousOnCurveControlPoint(this);\r\n\t// //var idx = this.curve.controlPoints.indexOf(this);\r\n\t// if (!pcp)\r\n\t// {\r\n\t// \tmesh.quaternion.setFromUnitVectors(new THREE.Vector3(0, 0, 1), this._forward);\r\n\t// \tmesh.rotateOnAxis(new THREE.Vector3(0, 0, 1), this._rotation / 180 * Math.PI);\r\n\t// }\r\n\t// else\r\n\t// {\r\n\t// \t//var pcp = this.curve.controlPoints[idx - 1];\r\n\t// \tmesh.quaternion.copy(pcp.mesh.quaternion);\r\n\r\n\t// \tvar rot = new THREE.Quaternion();\r\n\t// \trot.setFromUnitVectors(pcp.forward, this.forward);\r\n\t// \tmesh.quaternion.premultiply(rot);\r\n\t// \tmesh.rotateOnAxis(new THREE.Vector3(0, 0, 1), this._rotation / 180 * Math.PI);\r\n\t// }\r\n\t// var idx = this.curve.controlPoints.indexOf(this);\r\n\t// for (++idx; idx < this.curve.controlPoints.length; ++idx)\r\n\t// {\r\n\t// \tthis.curve.controlPoints[idx]._updateRotation();\r\n\t// }\r\n\t// this.curve.dirtyForAnimation = true;\r\n\t//}\r\n}","import { ICurveImpl } from '.'\r\nexport abstract class AbstractCurve implements ICurveImpl\r\n{\r\n\tabstract readonly curveType: string;\r\n\tisGhostCurve = false;\r\n\t//curveType: string;\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n\r\n\tabstract generate(numpoints?);\r\n\tgenerateMulti()\r\n\t{\r\n\t\treturn [this.generate()];\r\n\t}\r\n\tgetControlPointCount() { return 0; }\r\n\tallowPointRotation(i: number): boolean { return true; }\r\n\tallowPointTranslation(i: number): boolean { return true; }\r\n\r\n\tgetPointPosition(i: number, target: THREE.Vector3) { }\r\n\tgetPointRotation(i: number): number { return 0; }\r\n\r\n\tgetPointForward(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\ttarget.set(0, 0, 0);\r\n\t}\r\n\tgetPointQuaternion(i: number, target: THREE.Quaternion)\r\n\t{\r\n\t\ttarget.set(0, 0, 0, 1);\r\n\t}\r\n\tsetPointPosition(i: number, pos: THREE.Vector3)\r\n\t{\r\n\r\n\t}\r\n\tsetPointRotation(i: number, rot: number)\r\n\t{\r\n\t}\r\n\tupdate()\r\n\t{\r\n\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\treturn { type: this.curveType };\r\n\t}\r\n\tfromJSON(obj: any)\r\n\t{\r\n\r\n\t}\r\n\tallowOperator(op: any): boolean { return false; }\r\n\tapplyOperator(op: any): boolean { return false; }\r\n\tgetParameter(key: string): any { }\r\n\tsetParameter(key: string, value: any) { }\r\n\tgetHelperLine(): THREE.Vector3[] { return []; }\r\n}","import { CurveGenerateResult } from '.'\r\nexport function lerpRotation(r0, r1, t)\r\n{\r\n\tif (t <= 0) return r0;\r\n\tif (t >= 1) return r1;\r\n\t//make it simple swap r0 and r1\r\n\tif (r0 > r1)\r\n\t{\r\n\t\tvar temp = r0;\r\n\t\tr0 = r1;\r\n\t\tr1 = temp;\r\n\t\tt = 1 - t;\r\n\t}\r\n\r\n\tif (r1 - r0 <= 180)\r\n\t{\r\n\t\treturn r0 + (r1 - r0) * t;\r\n\t}\r\n\r\n\tvar r = r1 + (360 - (r1 - r0)) * t;\r\n\tif (r > 180)\r\n\t{\r\n\t\tr = -180 + r - 180;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\n\r\nexport function findClosestPointIndex(arr: THREE.Vector3[], pt: THREE.Vector3)\r\n{\r\n\tvar idx = 0;\r\n\tvar dist = Number.MAX_VALUE;\r\n\tfor (var i = 0; i < arr.length; ++i)\r\n\t{\r\n\t\tvar dist2 = pt.distanceToSquared(arr[i]);\r\n\t\tif (dist2 < dist)\r\n\t\t{\r\n\t\t\tidx = i;\r\n\t\t\tdist = dist2;\r\n\t\t}\r\n\t}\r\n\treturn idx;\r\n}\r\n\r\nconst Z_AXIS = new THREE.Vector3(0, 0, 1);\r\nconst TEMP_Q = new THREE.Quaternion;\r\nconst ZERO = new THREE.Vector3();\r\nconst UP = new THREE.Vector3(0, 1, 0);\r\nvar ROT_MAT = new THREE.Matrix4();\r\nfunction calcQuaternion(previousQuaternion: THREE.Quaternion | null, previousTarget: THREE.Vector3 | null,\r\n\tpreviousRotation: number,\r\n\tquaternion: THREE.Quaternion, forward: THREE.Vector3, rotation: number)\r\n{\r\n\tif (0)\r\n\t{\r\n\t\tif (!previousQuaternion)\r\n\t\t{\r\n\t\t\tquaternion.setFromUnitVectors(Z_AXIS, forward);\r\n\t\t\tvar q1 = TEMP_Q;\r\n\t\t\tq1.setFromAxisAngle(Z_AXIS, rotation / 180 * Math.PI);\r\n\t\t\tquaternion.multiply(q1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tquaternion.copy(previousQuaternion);\r\n\t\t\tTEMP_Q.setFromUnitVectors(previousTarget!, forward);\r\n\t\t\tquaternion.premultiply(TEMP_Q);\r\n\r\n\t\t\tTEMP_Q.setFromAxisAngle(Z_AXIS, (rotation - previousRotation) / 180 * Math.PI);\r\n\t\t\tquaternion.multiply(TEMP_Q);\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif (!previousQuaternion)\r\n\t\t{\r\n\t\t\tROT_MAT.lookAt(forward,ZERO, UP);\r\n\t\t\tquaternion.setFromRotationMatrix(ROT_MAT);\r\n\r\n\t\t\tvar q1 = TEMP_Q;\r\n\t\t\tq1.setFromAxisAngle(Z_AXIS, rotation / 180 * Math.PI);\r\n\t\t\tquaternion.multiply(q1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tquaternion.copy(previousQuaternion);\r\n\t\t\tTEMP_Q.setFromUnitVectors(previousTarget!, forward);\r\n\t\t\tquaternion.premultiply(TEMP_Q);\r\n\r\n\t\t\tTEMP_Q.setFromAxisAngle(Z_AXIS, (rotation - previousRotation) / 180 * Math.PI);\r\n\t\t\tquaternion.multiply(TEMP_Q);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function generateQuaternion(result: Partial<CurveGenerateResult>)\r\n{\r\n\tvar count = result.positions!.length;\r\n\tresult.quaternions = new Array(count);\r\n\tfor (var i = 0; i < count; ++i)\r\n\t{\r\n\t\tresult.quaternions[i] = new THREE.Quaternion();\r\n\t\tif (i === 0)\r\n\t\t{\r\n\t\t\tcalcQuaternion(null, null, 0, result.quaternions[i], result.forwards![i], result.rotations![i]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tcalcQuaternion(result.quaternions[i - 1], result.forwards![i - 1], result.rotations![i - 1]\r\n\t\t\t\t, result.quaternions[i], result.forwards![i], result.rotations![i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function calcPositionError(positions: THREE.Vector3[])\r\n{\r\n\tvar max = 0;\r\n\tvar min = Infinity;\r\n\tfor (var i = 0; i + 1 < positions.length; ++i)\r\n\t{\r\n\t\tvar s = positions[i].distanceToSquared(positions[i + 1]);\r\n\t\tif (s > max) max = s;\r\n\t\tif (s < min) min = s;\r\n\t}\r\n\r\n\tmax = Math.sqrt(max);\r\n\tmin = Math.sqrt(min);\r\n\tvar error = (max - min) / min;\r\n\r\n\treturn { min, max, error };\r\n}\r\n\r\nexport function applyRoll(q: THREE.Quaternion, rot: number)\r\n{\r\n\tTEMP_Q.setFromAxisAngle(Z_AXIS, rot * Math.PI / 180);\r\n\tq.multiply(TEMP_Q);\r\n}","import { ICurveImpl, CurveGenerateResult } from '.'\r\nimport { AbstractCurve } from './AbstractCurve'\r\nimport { lerpRotation, findClosestPointIndex, generateQuaternion, calcPositionError } from './util';\r\ntype Vector3 = THREE.Vector3;\r\n//base class for implement a THREE.Curve<> curve.\r\nexport abstract class BaseCurveCurve extends AbstractCurve\r\n{\r\n\tcurveType: string;\r\n\tprotected _generateQuality = 100;\r\n\tprotected _curve: THREE.Curve<Vector3>;\r\n\tprotected _positions: Vector3[] = [];\r\n\tprotected _rotations: number[] = [];\r\n\tprotected _cacheGenerate: CurveGenerateResult | null;\r\n\tprotected _curveErrorInfo;\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.curveType = '';\r\n\t}\r\n\tabstract toJSON();\r\n\tabstract fromJSON(obj);\r\n\r\n\tgetInternalCurve() { return this._curve; }\r\n\r\n\tgetControlPointCount()\r\n\t{\r\n\t\treturn this._positions.length;\r\n\t}\r\n\tgetPointPosition(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\ttarget.copy(this._positions[i]);\r\n\t}\r\n\r\n\tgetPointRotation(i: number)\r\n\t{\r\n\t\treturn this._rotations[i];\r\n\t}\r\n\r\n\tgetPointForward(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\tif (i >= 0 && i < this._positions.length)\r\n\t\t{\r\n\t\t\tif (!this._cacheGenerate)\r\n\t\t\t{\r\n\t\t\t\tthis.generate();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.allowPointRotation(i))\r\n\t\t\t{\r\n\t\t\t\tvar idx = findClosestPointIndex(this._cacheGenerate!.positions, this._positions[i]);\r\n\t\t\t\ttarget.copy(this._cacheGenerate!.forwards[i]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttarget.set(0, 0, 0);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tgetPointQuaternion(i: number, target: THREE.Quaternion)\r\n\t{\r\n\t\tif (i >= 0 && i < this._positions.length)\r\n\t\t{\r\n\t\t\tif (!this._cacheGenerate) this.generate();\r\n\t\t\tif (this.allowPointRotation(i))\r\n\t\t\t{\r\n\t\t\t\tvar idx = findClosestPointIndex(this._cacheGenerate!.positions, this._positions[i]);\r\n\t\t\t\ttarget.copy(this._cacheGenerate!.quaternions[idx]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttarget.set(0, 0, 0, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tallowPointRotation(i) { return true; }\r\n\tallowPointTranslation(i) { return true; }\r\n\t//call update() is needed.\r\n\tsetPointPosition(i: number, pos: THREE.Vector3)\r\n\t{\r\n\t\tif (i >= 0 && i < this._positions.length)\r\n\t\t{\r\n\t\t\tthis._positions[i].copy(pos);\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t}\r\n\t}\r\n\r\n\t//call update() is needed.\r\n\tsetPointRotation(i: number, rot: number)\r\n\t{\r\n\t\tif (i >= 0 && i < this._rotations.length\r\n\t\t\t&& this.allowPointRotation(i))\r\n\t\t{\r\n\t\t\tif (rot < -180) rot = -180;\r\n\t\t\telse if (rot > 180) rot = 180;\r\n\t\t\tthis._rotations[i] = rot;\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis._cacheGenerate = null;\r\n\t\tif (this._curve instanceof THREE.CurvePath)\r\n\t\t{\r\n\t\t\tfor (var cc of this._curve.curves)\r\n\t\t\t{\r\n\t\t\t\tcc.arcLengthDivisions = cc.getLength() | 0;\r\n\t\t\t\tcc.updateArcLengths();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._curve.arcLengthDivisions = this._curve.getLength() | 0;\r\n\t\tthis._curve.updateArcLengths();\r\n\t}\r\n\r\n\tsupportedOperator() { return []; }\r\n\tallowOperator(op)\r\n\t{\r\n\t\tif (op.type === 'mirrorX') return true;\r\n\t\treturn false;\r\n\t}\r\n\tapplyOperator(op)\r\n\t{\r\n\t\tif (op.type === 'mirrorX')\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < this._positions.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tthis._positions[i].x = -this._positions[i].x;\r\n\t\t\t\tthis._positions[i].y = -this._positions[i].y;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < this._rotations.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tthis._rotations[i] = -this._rotations[i];\r\n\t\t\t}\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\t//generate helper\r\n\tgeneratePositions(numpoints: number, result: Partial<CurveGenerateResult>)\r\n\t{\r\n\t\tresult.positions = this._curve.getSpacedPoints(numpoints - 1);\r\n\t\tthis._curveErrorInfo = calcPositionError(result.positions);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgenerateForwards(numpoints: number, result: Partial<CurveGenerateResult>)\r\n\t{\r\n\t\tvar forwards = new Array(numpoints);\r\n\t\tfor (var i = 0; i < numpoints; ++i)\r\n\t\t{\r\n\t\t\tforwards[i] = this._curve.getTangentAt(i / (numpoints - 1));\r\n\t\t}\r\n\t\tresult.forwards = forwards;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgenerateRotations(numpoints: number, result: Partial<CurveGenerateResult>)\r\n\t{\r\n\t\tif (!result.positions || result.positions.length !== numpoints)\r\n\t\t{\r\n\t\t\tthrow new Error('invalid input result');\r\n\t\t}\r\n\t\tvar rotations = new Array(numpoints);\r\n\t\tvar segments: any[] = [];\r\n\t\tfor (var i = 0; i < this._rotations.length; ++i)\r\n\t\t{\r\n\t\t\tif (this.allowPointRotation(i))\r\n\t\t\t{\r\n\t\t\t\tvar idx = findClosestPointIndex(result.positions, this._positions[i]);\r\n\t\t\t\tsegments.push({ idx: idx, rot: this._rotations[i] });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (segments.length === 0 || segments.length === 1)\r\n\t\t{\r\n\t\t\tvar rot = segments.length === 0 ? 0 : segments[0].rot;\r\n\t\t\tfor (var i = 0; i < rotations.length; ++i)\r\n\t\t\t\trotations[i] = rot;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (segments[0].idx > 0)\r\n\t\t\t{\r\n\t\t\t\tsegments.unshift({ idx: 0, rot: segments[0].rot });\r\n\t\t\t}\r\n\t\t\tif (segments[segments.length - 1].idx != rotations.length - 1)\r\n\t\t\t{\r\n\t\t\t\tsegments.push({ idx: rotations.length - 1, rot: segments[segments.length - 1].rot });\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i + 1 < segments.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar seg1 = segments[i];\r\n\t\t\t\tvar seg2 = segments[i + 1];\r\n\t\t\t\t//to avoid divide by 0\r\n\t\t\t\tif (seg1.idx === seg2.idx)\r\n\t\t\t\t{\r\n\t\t\t\t\trotations[seg1.idx] = seg1.rot;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (var j = seg1.idx; j <= seg2.idx; ++j)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trotations[j] = lerpRotation(seg1.rot, seg2.rot, (j - seg1.idx) / (seg2.idx - seg1.idx));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//finally check it\r\n\t\tfor (var o of rotations)\r\n\t\t{\r\n\t\t\tif (isNaN(o)) { throw new Error('invalid generate rotations') }\r\n\t\t\tif (typeof o !== 'number') { throw new Error('invalid generate rotations') }\r\n\t\t}\r\n\t\tresult.rotations = rotations;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgenerateQuaternions(numpoints: number, result: Partial<CurveGenerateResult>)\r\n\t{\r\n\t\tgenerateQuaternion(result);\r\n\t}\r\n\r\n\tgenerate(numpoints?: number)\r\n\t{\r\n\t\tnumpoints = numpoints || 200;\r\n\r\n\r\n\t\tif (this._generateQuality < 100) numpoints = (numpoints * this._generateQuality / 100) | 0;\r\n\t\tif (numpoints < 20) numpoints = 20;\r\n\r\n\t\tif (this._cacheGenerate && this._cacheGenerate.positions.length === numpoints)\r\n\t\t{\r\n\t\t\treturn this._cacheGenerate;\r\n\t\t}\r\n\t\tvar result: Partial<CurveGenerateResult> = { positions: undefined, rotations: undefined, forwards: undefined, quaternions: undefined };\r\n\t\tthis.generatePositions(numpoints, result);\r\n\t\tthis.generateForwards(numpoints, result);\r\n\t\tthis.generateRotations(numpoints, result);\r\n\t\tthis.generateQuaternions(numpoints, result);\r\n\t\tthis._cacheGenerate = result as CurveGenerateResult;\r\n\t\treturn this._cacheGenerate;\r\n\t}\r\n\tgetParameter(key: string)\r\n\t{\r\n\t\tif (key === 'curveError')\r\n\t\t{\r\n\t\t\treturn this._curveErrorInfo ? this._curveErrorInfo.error : 0;\r\n\t\t}\r\n\t\telse if (key === 'generateQuality')\r\n\t\t{\r\n\t\t\treturn this._generateQuality;\r\n\t\t}\r\n\t}\r\n\tsetParameter(key: string, value: any)\r\n\t{\r\n\t\tif (key === 'generateQuality' && (value >= 0 && value <= 100) && typeof value === 'number')\r\n\t\t{\r\n\t\t\tthis._generateQuality = value;\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n}","import { BaseCurveCurve } from './BaseCurveCurve'\r\nimport { ICurveImpl, CurveGenerateResult } from '.'\r\nimport { lerpRotation, findClosestPointIndex, generateQuaternion } from './util';\r\ntype Vector3 = THREE.Vector3;\r\n\r\nexport class CatmullRomCurve3 extends BaseCurveCurve implements ICurveImpl\r\n{\r\n\tconstructor(initJson: any)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.curveType = 'CatmullRomCurve3';\r\n\t\tthis._positions = [\r\n\t\t\tnew THREE.Vector3(-100, 0, 0),\r\n\t\t\tnew THREE.Vector3(0, 100, 0),\r\n\t\t\tnew THREE.Vector3(100, 0, 0),\r\n\t\t]\r\n\t\tthis._rotations = [\r\n\t\t\t0, 0, 0\r\n\t\t]\r\n\t\tthis._curve = new (THREE.CatmullRomCurve3 as any)(this._positions, false, 'catmullrom');\r\n\t\tif (initJson && initJson.points)\r\n\t\t{\r\n\t\t\tthis.fromJSON(initJson);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\t//#region impl interface\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\tvar points: any[] = [];\r\n\t\tfor (var i = 0; i < this._positions.length; ++i)\r\n\t\t{\r\n\t\t\tpoints.push({\r\n\t\t\t\tx: this._positions[i].x,\r\n\t\t\t\ty: this._positions[i].y,\r\n\t\t\t\tz: this._positions[i].z,\r\n\t\t\t\trotation: this._rotations[i]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: this.curveType,\r\n\t\t\tpoints,\r\n\t\t\ttension: this._curve['tension']\r\n\t\t}\r\n\t}\r\n\r\n\tfromJSON(obj: any)\r\n\t{\r\n\t\tif (obj.type === this.curveType)\r\n\t\t{\r\n\t\t\tvar points = obj.points;\r\n\t\t\tif (points && points.length >= 2)\r\n\t\t\t{\r\n\t\t\t\tthis._positions.length = points.length;\r\n\t\t\t\tthis._rotations.length = points.length;\r\n\t\t\t\tfor (var i = 0; i < points.length; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._rotations[i] = points[i].rotation || 0;\r\n\t\t\t\t\tif (!this._positions[i]) this._positions[i] = new THREE.Vector3();\r\n\t\t\t\t\tthis._positions[i].set(points[i].x || 0, points[i].y || 0, points[i].z || 0);\r\n\t\t\t\t}\r\n\t\t\t\tthis._curve['tension'] = (typeof obj.tension === 'number' && obj.tension >= 0 && obj.tension <= 1) ? obj.tension : 0.5;\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tallowPointRotation(i: number)\r\n\t{\r\n\t\treturn true;\r\n\t}\r\n\r\n\tallowPointTranslation(i: number)\r\n\t{\r\n\t\treturn true;\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tsuper.update();\r\n\t}\r\n\t//#endregion\r\n\r\n\tallowOperator(op: any)\r\n\t{\r\n\t\tif (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\tvar points = op.points;\r\n\t\t\tif (Array.isArray(op.points)\r\n\t\t\t\t&& (new Set(points)).size === points.length\r\n\t\t\t\t&& this._positions.length - points.length >= 2)\r\n\t\t\t{\r\n\t\t\t\tfor (var idx of points)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!(idx >= 0 && idx < this._positions.length))\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\tvar points = op.points;\r\n\t\t\tif (Array.isArray(op.points)\r\n\t\t\t\t&& op.points.length === 2)\r\n\t\t\t{\r\n\t\t\t\tvar i = op.points[0];\r\n\t\t\t\tvar j = op.points[1];\r\n\t\t\t\tif (i >= 0 && i < this._positions.length &&\r\n\t\t\t\t\tj >= 0 && j < this._positions.length)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn i == j + 1 || i == j - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn super.allowOperator(op);\r\n\t}\r\n\r\n\tapplyOperator(op: any)\r\n\t{\r\n\t\tif (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\tif (!this.allowOperator(op))\r\n\t\t\t\treturn false;\r\n\t\t\tlet points = op.points;\r\n\t\t\tfor (let i = this._positions.length - 1; i >= 0; --i)\r\n\t\t\t{\r\n\t\t\t\tif (points.indexOf(i) >= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._positions.splice(i, 1);\r\n\t\t\t\t\tthis._rotations.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\tif (!this.allowOperator(op))\r\n\t\t\t\treturn false;\r\n\t\t\tlet i = op.points[0];\r\n\t\t\tlet j = op.points[1];\r\n\t\t\tif (i > j)\r\n\t\t\t{\r\n\t\t\t\t[i, j] = [j, i];\r\n\t\t\t}\r\n\r\n\t\t\tvar mid = this._positions[i].clone().add(this._positions[j]).multiplyScalar(0.5);\r\n\t\t\tvar midrot = lerpRotation(this._rotations[i], this._rotations[j], 0.5);\r\n\t\t\tthis._positions.splice(j, 0, mid);\r\n\t\t\tthis._rotations.splice(j, 0, midrot);\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn super.applyOperator(op);\r\n\t}\r\n\r\n\tsetParameter(key, value)\r\n\t{\r\n\t\tif (key === 'tension')\r\n\t\t{\r\n\t\t\tif (typeof value === 'number' && !isNaN(value))\r\n\t\t\t{\r\n\t\t\t\tif (value > 1) value = 1;\r\n\t\t\t\tif (value < 0) value = 0;\r\n\t\t\t\tthis._curve['tension'] = value;\r\n\t\t\t\tthis.update();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn super.setParameter(key, value);\r\n\t}\r\n\tgetParameter(key)\r\n\t{\r\n\t\tif (key === 'tension')\r\n\t\t{\r\n\t\t\treturn (this._curve as THREE.CatmullRomCurve3)['tension']\r\n\t\t}\r\n\t\treturn super.getParameter(key);\r\n\t}\r\n}","import { BaseCurveCurve } from './BaseCurveCurve'\r\nimport { lerpRotation } from './util'\r\n\r\nconst DEFAULT_OBJECT = {\r\n\ttype: 'QuadraticBezierCurve3',\r\n\tpoints: [\r\n\t\t{ x: -400, y: -120, z: 0 },\r\n\t\t{ x: -200, y: 120, z: 0 },\r\n\t\t{ x: 0, y: 120, z: 0 },\r\n\t\t{ x: 200, y: 120, z: 0 },\r\n\t\t{ x: 400, y: -120, z: 0 },\r\n\t]\r\n};\r\n\r\nexport class QuadraticBezierCurve3 extends BaseCurveCurve\r\n{\r\n\r\n\tconstructor(jsObj)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.curveType = 'QuadraticBezierCurve3';\r\n\t\tif (!jsObj || !jsObj.points)\r\n\t\t{\r\n\t\t\tthis.fromJSON(DEFAULT_OBJECT);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.fromJSON(jsObj);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tif (obj.type === this.curveType &&\r\n\t\t\tobj.points && obj.points.length >= 3)\r\n\t\t{\r\n\t\t\tvar points = obj.points;\r\n\t\t\tvar positions = this._positions;\r\n\t\t\tvar rotations = this._rotations;\r\n\t\t\tpositions.length = rotations.length = points.length;\r\n\t\t\tfor (var i = 0; i < points.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tpositions[i] = new THREE.Vector3(points[i].x || 0, points[i].y || 0, points[i].z || 0);\r\n\t\t\t\trotations[i] = points[i].rotation || 0;\r\n\t\t\t}\r\n\t\t\tthis._rebuild();\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\tvar points: any[] = [];\r\n\t\tvar count = this._positions.length;\r\n\t\tfor (var i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\tpoints.push({\r\n\t\t\t\tx: this._positions[i].x,\r\n\t\t\t\ty: this._positions[i].y,\r\n\t\t\t\tz: this._positions[i].z,\r\n\t\t\t\trotation: this._rotations[i]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn { type: this.curveType, points };\r\n\t}\r\n\r\n\tallowPointRotation(i)\r\n\t{\r\n\t\tif (i >= 0 && i < this._positions.length)\r\n\t\t{\r\n\t\t\treturn i % 2 === 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tallowOperator(op)\r\n\t{\r\n\t\tif (op.type === 'smooth')\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\tvar points = op.points;\r\n\t\t\tif (points && points.length <= 3 && points.length > 0)\r\n\t\t\t{\r\n\t\t\t\tvar pts = points.slice();\r\n\t\t\t\tpts.sort((a, b) => a - b);\r\n\t\t\t\tvar ptpt = pts[0];\r\n\t\t\t\tfor (var i = 0; i + 1 < pts.length; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (pts[i] + 1 !== pts[i + 1])\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\tif (pts[i + 1] % 2 == 1) ptpt = pts[i + 1];\r\n\t\t\t\t}\r\n\t\t\t\tif (ptpt !== -1 && ptpt % 2 === 1) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\tvar points = op.points;\r\n\t\t\t//简单一点，只能删除一个\r\n\t\t\tif (points && points.length === 1 && points[0] % 2 === 0 && this._positions.length > 3)\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn super.allowOperator(op);\r\n\t}\r\n\r\n\tapplyOperator(op)\r\n\t{\r\n\t\tif (!this.allowOperator(op)) return false;\r\n\t\tif (op.type === 'smooth')\r\n\t\t{\r\n\t\t\tvar positions = this._positions;\r\n\t\t\tvar count = positions.length;\r\n\r\n\t\t\tfor (var i = 1; i + 2 < count; i += 2)\r\n\t\t\t{\r\n\t\t\t\tvar p0 = positions[i];\r\n\t\t\t\tvar p1 = positions[i + 1];\r\n\t\t\t\tvar p2 = positions[i + 2];\r\n\t\t\t\tvar dist = p1.distanceTo(p2);\r\n\t\t\t\tvar len = p1.distanceTo(p2);\r\n\t\t\t\tif (len >= 0.00000001)\r\n\t\t\t\t{\r\n\t\t\t\t\tp2.copy(p1).sub(p0).multiplyScalar(dist / len).add(p1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\tvar pt = -1;\r\n\t\t\tfor (var i = 0; i < op.points.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tif (op.points[i] % 2 === 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tpt = op.points[i] % 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (pt !== -1)\r\n\t\t\t{\r\n\t\t\t\tvar p0 = this._positions[pt - 1];\r\n\t\t\t\tvar p1 = this._positions[pt + 1];\r\n\t\t\t\tvar rot = lerpRotation(this._rotations[pt - 1], this._rotations[pt + 1], 0.5);\r\n\r\n\t\t\t\tvar diff = p1.clone().sub(p0);\r\n\t\t\t\tthis._positions.splice(pt, 1,\r\n\t\t\t\t\tdiff.clone().multiplyScalar(0.25).add(p0),\r\n\t\t\t\t\tdiff.clone().multiplyScalar(0.5).add(p0),\r\n\t\t\t\t\tdiff.clone().multiplyScalar(0.75).add(p0),\r\n\t\t\t\t);\r\n\t\t\t\tthis._rotations.splice(pt, 1, 0, rot, 0);\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\tthis._rebuild();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\tlet pt = op.points[0];\r\n\t\t\tif (pt % 2 === 0)\r\n\t\t\t{\r\n\t\t\t\tif (pt === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._positions.splice(0, 3);\r\n\t\t\t\t\tthis._rotations.splice(0, 3);\r\n\t\t\t\t}\r\n\t\t\t\telse if (pt === this._positions.length - 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._positions.splice(pt - 2, 3);\r\n\t\t\t\t\tthis._rotations.splice(pt - 2, 3);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar mid = this._positions[pt - 1].clone().add(this._positions[pt + 1]).multiplyScalar(0.5);\r\n\t\t\t\t\tthis._positions.splice(pt - 1, 3, mid);\r\n\t\t\t\t\tthis._rotations.splice(pt - 1, 3, 0);\r\n\t\t\t\t}\r\n\t\t\t\tthis._rebuild();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn super.applyOperator(op);\r\n\t}\r\n\tgetHelperLine()\r\n\t{\r\n\t\tvar arr: THREE.Vector3[] = [];\r\n\t\tfor (var i = 1; i < this._positions.length; i += 2)\r\n\t\t{\r\n\t\t\tarr.push(this._positions[i], this._positions[i + 1]);\r\n\t\t\tarr.push(this._positions[i], this._positions[i - 1]);\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tprivate _rebuild()\r\n\t{\r\n\t\tvar curve: THREE.CurvePath<THREE.Vector3> = new THREE.CurvePath();\r\n\t\tfor (var i = 0; i + 2 < this._positions.length; i += 2)\r\n\t\t{\r\n\t\t\tvar bc = new THREE.QuadraticBezierCurve3(this._positions[i], this._positions[i + 1], this._positions[i + 2]);\r\n\t\t\tcurve.add(bc);\r\n\t\t}\r\n\t\tthis._curve = curve;\r\n\t\tthis.update();\r\n\t}\r\n}","import { BaseCurveCurve } from './BaseCurveCurve'\r\nimport { findClosestPointIndex } from './util'\r\nconst DEFAULT_OBJECT = {\r\n\ttype: 'CubicBezierCurve3',\r\n\tpoints: [\r\n\t\t{ x: -400, y: 120, z: 300 },\r\n\t\t{ x: -400, y: -120, z: 300 },\r\n\t\t{ x: 0, y: -120, z: 300 },\r\n\t\t{ x: 0, y: 0, z: 300 },\r\n\t\t{ x: 0, y: 120, z: 300 },\r\n\t\t{ x: 400, y: 120, z: 300 },\r\n\t\t{ x: 400, y: -120, z: 300 }\r\n\t]\r\n}\r\n\r\nexport class CubicBezierCurve3 extends BaseCurveCurve\r\n{\r\n\tconstructor(jsObj)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.curveType = 'CubicBezierCurve3';\r\n\t\tif (!jsObj || !jsObj.points)\r\n\t\t{\r\n\t\t\tthis.fromJSON(DEFAULT_OBJECT);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.fromJSON(jsObj);\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\tvar points: any[] = [];\r\n\t\tfor (var i = 0; i < this._positions.length; ++i)\r\n\t\t{\r\n\t\t\tpoints.push({\r\n\t\t\t\tx: this._positions[i].x,\r\n\t\t\t\ty: this._positions[i].y,\r\n\t\t\t\tz: this._positions[i].z,\r\n\t\t\t\trotation: this._rotations[i]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: this.curveType,\r\n\t\t\tpoints\r\n\t\t}\r\n\t}\r\n\r\n\tfromJSON(jsObj)\r\n\t{\r\n\t\tif (jsObj && jsObj.type === this.curveType && jsObj.points && jsObj.points.length >= 4)\r\n\t\t{\r\n\t\t\tvar points = jsObj.points;\r\n\t\t\tthis._positions.length = this._rotations.length = points.length;\r\n\t\t\tfor (var i = 0; i < points.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tthis._positions[i] = new THREE.Vector3(\r\n\t\t\t\t\tpoints[i].x || 0,\r\n\t\t\t\t\tpoints[i].y || 0,\r\n\t\t\t\t\tpoints[i].z || 0,\r\n\t\t\t\t);\r\n\t\t\t\tthis._rotations[i] = points[i].rotation || 0;\r\n\t\t\t}\r\n\t\t\tthis.rebuild();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tallowPointRotation(i)\r\n\t{\r\n\t\treturn i % 3 == 0;\r\n\t}\r\n\r\n\tprivate rebuild()\r\n\t{\r\n\t\tvar curve: THREE.CurvePath<THREE.Vector3> = new THREE.CurvePath();\r\n\t\tfor (var i = 0; i + 3 < this._positions.length; i += 3)\r\n\t\t{\r\n\t\t\tvar bc = new THREE.CubicBezierCurve3(\r\n\t\t\t\tthis._positions[i],\r\n\t\t\t\tthis._positions[i + 1],\r\n\t\t\t\tthis._positions[i + 2],\r\n\t\t\t\tthis._positions[i + 3],\r\n\t\t\t);\r\n\t\t\tcurve.add(bc);\r\n\t\t}\r\n\t\tthis._curve = curve;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tallowOperator(op)\r\n\t{\r\n\t\tif (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\treturn this.split(op.points, true);\r\n\t\t}\r\n\t\telse if (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\treturn this.removePoints(op.points, true);\r\n\t\t}\r\n\t\treturn super.allowOperator(op);\r\n\t}\r\n\tapplyOperator(op)\r\n\t{\r\n\t\tif (op.type === 'splitBetween')\r\n\t\t{\r\n\t\t\treturn this.split(op.points, false);\r\n\t\t}\r\n\t\telse if (op.type === 'removePoints')\r\n\t\t{\r\n\t\t\treturn this.removePoints(op.points, false);\r\n\t\t}\r\n\t\treturn super.applyOperator(op);\r\n\t}\r\n\r\n\t//check 表示只做检查，不修改曲线\r\n\tprivate split(points: number[], check: boolean)\r\n\t{\r\n\t\tif (!points) return false;\r\n\t\tif (!(points.length >= 1 && points.length <= 4))\r\n\t\t\treturn false;\r\n\t\tvar count = this._positions.length;\r\n\t\tpoints = points.slice().sort((a, b) => a - b);\r\n\t\tfor (var i = 0; i < points.length; ++i)\r\n\t\t{\r\n\t\t\tif (!(points[i] >= 0 && points[i] < count))\r\n\t\t\t\treturn false;\r\n\t\t\tif (i + 1 < points.length && points[i] + 1 !== points[i + 1])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//分裂idx0到idx0 + 3之间的定点\r\n\t\tvar idx0 = -1\r\n\t\tif (points.length === 1)\r\n\t\t{\r\n\t\t\t//一定要选中一个控制点\r\n\t\t\tlet pt = points[0];\r\n\t\t\tif (pt % 3 === 0) return false;\r\n\t\t\tif (pt % 3 == 1)\r\n\t\t\t{\r\n\t\t\t\tidx0 = pt - 1;\r\n\t\t\t}\r\n\t\t\telse //if (pt%3 == 2)\r\n\t\t\t{\r\n\t\t\t\tidx0 = pt - 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (points.length === 2)\r\n\t\t{\r\n\t\t\t//选择其中的一个控制点\r\n\t\t\tlet pt = points[0] % 3 == 0 ? points[1] : points[0];\r\n\t\t\tif (pt % 3 === 0) return false;\r\n\t\t\tif (pt % 3 == 1)\r\n\t\t\t{\r\n\t\t\t\tidx0 = pt - 1;\r\n\t\t\t}\r\n\t\t\telse //if (pt%3 == 2)\r\n\t\t\t{\r\n\t\t\t\tidx0 = pt - 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (points.length === 3)\r\n\t\t{\r\n\t\t\t//[0,1,2] || [1,2,3]\r\n\t\t\tif (points[0] % 3 == 0)\r\n\t\t\t{\r\n\t\t\t\tidx0 = points[0];\r\n\t\t\t}\r\n\t\t\telse if (points[2] % 3 == 0)\r\n\t\t\t{\r\n\t\t\t\tidx0 = points[2] - 3;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (points.length === 4)\r\n\t\t{\r\n\t\t\tif (points[0] % 3 === 0 && points[3] % 3 === 0)\r\n\t\t\t{\r\n\t\t\t\tidx0 = points[0];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (check) return true;\r\n\t\t//从idx0开始\r\n\t\tvar result = this.generate();\r\n\t\tvar p0 = this._positions[idx0];\r\n\t\tvar p1 = this._positions[idx0 + 3];\r\n\r\n\t\tvar p0idx = findClosestPointIndex(result.positions, p0);\r\n\t\tvar p1idx = findClosestPointIndex(result.positions, p1);\r\n\t\tvar mididx = ((p0idx + p1idx) * 0.5) | 0;\r\n\t\tvar midpt = result.positions[mididx]; if (!midpt) throw new Error('midpt is null');\r\n\t\tvar midrot = result.rotations[mididx];\r\n\t\t//generate 4 control points\r\n\t\t//p0 -- c0 -- c1 -- mid -- c2 -- c3 -- p1\r\n\t\tvar tan0 = result.forwards[p0idx];\r\n\t\tvar tanmid = result.forwards[mididx];\r\n\t\tvar tan1 = result.forwards[p1idx];\r\n\t\tvar len0 = p0.distanceTo(midpt);\r\n\t\tvar len1 = midpt.distanceTo(p1);\r\n\r\n\t\tvar c0 = tan0.clone().multiplyScalar(len0 * 0.4).add(p0);\r\n\t\tvar c1 = tanmid.clone().multiplyScalar(-len0 * 0.4).add(midpt);\r\n\t\tvar c2 = tanmid.clone().multiplyScalar(len1 * 0.4).add(midpt);\r\n\t\tvar c3 = tan1.clone().multiplyScalar(-len1 * 0.4).add(p1);\r\n\r\n\t\tthis._positions.splice(idx0 + 1, 2, c0, c1, midpt, c2, c3);\r\n\t\tthis._rotations.splice(idx0 + 1, 2, 0, 0, midrot, 0, 0);\r\n\t\tthis.rebuild();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tremovePoints(points: number[], check: boolean): boolean\r\n\t{\r\n\t\tif (!points || points.length !== 1) return false;\r\n\t\tvar pt = points[0];\r\n\t\tif (pt % 3 !== 0) return false;\r\n\t\tif (this._positions.length <= 4) return false;\r\n\t\tif (!(pt >= 0 && pt < this._positions.length)) return false;\r\n\t\tif (check) return true;\r\n\t\tif (pt === 0)\r\n\t\t{\r\n\t\t\tthis._positions.splice(0, 2);\r\n\t\t\tthis._rotations.splice(0, 2);\r\n\t\t}\r\n\t\telse if (pt === this._positions.length - 1)\r\n\t\t{\r\n\t\t\tthis._positions.splice(pt - 1, 2);\r\n\t\t\tthis._rotations.splice(pt - 1, 2);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis._positions.splice(pt - 1, 3);\r\n\t\t\tthis._rotations.splice(pt - 1, 3);\r\n\t\t}\r\n\t\tthis.rebuild();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetHelperLine()\r\n\t{\r\n\t\tvar arr: THREE.Vector3[] = [];\r\n\t\tfor (var i = 0; i < this._positions.length; i += 3)\r\n\t\t{\r\n\t\t\tif (i > 0) arr.push(this._positions[i], this._positions[i - 1]);\r\n\t\t\tif (i < this._positions.length - 1) arr.push(this._positions[i], this._positions[i + 1]);\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n}\r\n","import { ICurveImpl, CurveGenerateResult } from '.'\r\nimport { AbstractCurve } from './AbstractCurve'\r\nimport { generateQuaternion, lerpRotation, applyRoll } from './util'\r\n//控制形态的点的数量\r\nconst FIX_POINT_COUNT = 2;\r\nexport class ArcCurve extends AbstractCurve//implements ICurveImpl\r\n{\r\n\tcurveType: string = 'ArcCurve';\r\n\tprivate _generateQuality = 100;\r\n\tprivate _positions: THREE.Vector3[];\r\n\t//前FIX_POINT_COUNT是没用的。为了有些代码简单一点\r\n\tprivate _rotations: number[];\r\n\tprivate _cacheGenerate: CurveGenerateResult | null = null;\r\n\tprivate _radius = 100;\r\n\tprivate _degreeStart = 0;\r\n\tprivate _degreeEnd = 360 * 1;\r\n\tprivate _extraPointCount = 10;\r\n\r\n\r\n\tget startPoint() { return this._positions[0] }\r\n\tget endPoint() { return this._positions[1] }\r\n\r\n\tconstructor(jsObj)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._positions = [\r\n\t\t\tnew THREE.Vector3(-200, 0, 0),\r\n\t\t\tnew THREE.Vector3(200, 0, 0),\r\n\t\t];\r\n\t\tthis._rotations = new Array(this._extraPointCount + FIX_POINT_COUNT);\r\n\t\tfor (var i = 0; i < this._rotations.length; ++i)\r\n\t\t{\r\n\t\t\tthis._rotations[i] = 0;\r\n\t\t}\r\n\t\tthis.fromJSON(jsObj);\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\treturn {\r\n\t\t\ttype: this.curveType,\r\n\t\t\tradius: this._radius,\r\n\t\t\tdegreeStart: this._degreeStart,\r\n\t\t\tdegreeEnd: this._degreeEnd,\r\n\t\t\tpositions: this._positions.map(pt => ({ x: pt.x, y: pt.y, z: pt.z })),\r\n\t\t\trotations: this._rotations\r\n\t\t};\r\n\t}\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tif (obj && obj.type === this.curveType &&\r\n\t\t\tobj.positions && obj.positions.length === FIX_POINT_COUNT)\r\n\t\t{\r\n\t\t\tthis._radius = obj.radius || 100;\r\n\t\t\tthis._degreeStart = obj.degreeStart || 0;\r\n\t\t\tthis._degreeEnd = typeof obj.degreeEnd === 'number' ? obj.degreeEnd : 720;\r\n\t\t\tfor (var i = 0; i < FIX_POINT_COUNT; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar pp = obj.positions[i];\r\n\t\t\t\tthis._positions[i].set(pp.x, pp.y, pp.z);\r\n\t\t\t}\r\n\r\n\t\t\tif (obj.rotations && obj.rotations.length >= FIX_POINT_COUNT)\r\n\t\t\t{\r\n\t\t\t\tthis._extraPointCount = obj.rotations.length - FIX_POINT_COUNT;\r\n\t\t\t\tthis._rotations = obj.rotations.map(x => x || 0);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis._extraPointCount = 0;\r\n\t\t\t\tthis._rotations = [0, 0];\r\n\t\t\t}\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\tgetInternalCurve() { return null; }\r\n\r\n\tgetControlPointCount() { return this._positions.length + this._extraPointCount; }\r\n\tallowPointRotation(i) { return i >= 2; }\r\n\tallowPointTranslation(i) { return i >= 0 && i < 2; }\r\n\r\n\tgetPointPosition(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\tif (i >= FIX_POINT_COUNT && i < FIX_POINT_COUNT + this._extraPointCount)\r\n\t\t{\r\n\t\t\tvar idx = this._convertIndex(i);\r\n\t\t\tvar cacheGenerate = this._cacheGenerate!;\r\n\t\t\tif (idx < 0 || idx >= cacheGenerate.positions.length || !cacheGenerate.positions[idx] || !target)\r\n\t\t\t{\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthis._convertIndex(i);\r\n\t\t\t}\r\n\t\t\ttarget.copy(cacheGenerate.positions[idx]);\r\n\t\t}\r\n\t\telse if (i >= 0 && i < this._positions.length)\r\n\t\t{\r\n\t\t\ttarget.copy(this._positions[i]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconsole.log('invalid position index:', i);\r\n\t\t}\r\n\t}\r\n\r\n\tgetPointRotation(i: number)\r\n\t{\r\n\t\tif (i >= FIX_POINT_COUNT)\r\n\t\t{\r\n\t\t\treturn this._rotations[i];\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tgetPointForward(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\tif (i >= FIX_POINT_COUNT)\r\n\t\t{\r\n\t\t\tvar idx = this._convertIndex(i);\r\n\t\t\ttarget.copy(this._cacheGenerate!.forwards[idx]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetPointQuaternion(i: number, target: THREE.Quaternion)\r\n\t{\r\n\t\tif (i >= FIX_POINT_COUNT)\r\n\t\t{\r\n\t\t\tvar idx = this._convertIndex(i);\r\n\t\t\ttarget.copy(this._cacheGenerate!.quaternions[idx]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tsetPointPosition(i: number, pos: THREE.Vector3)\r\n\t{\r\n\t\tif (i >= 0 && i < FIX_POINT_COUNT)\r\n\t\t{\r\n\t\t\tthis._positions[i].copy(pos);\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t}\r\n\t}\r\n\r\n\tsetPointRotation(i: number, rot: number)\r\n\t{\r\n\t\tif (i >= FIX_POINT_COUNT && i < this._rotations.length)\r\n\t\t{\r\n\t\t\tthis._rotations[i] = rot;\r\n\t\t\tthis._cacheGenerate = null;\r\n\t\t}\r\n\t}\r\n\r\n\tallowOperator(op)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\tapplyOperator(op)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\tgetParameter(key)\r\n\t{\r\n\t\tif (['radius', 'degreeStart', 'degreeEnd', 'extraPointCount'].indexOf(key) >= 0)\r\n\t\t{\r\n\t\t\treturn this['_' + key];\r\n\t\t}\r\n\r\n\t\tif (key === 'generateQuality')\r\n\t\t{\r\n\t\t\treturn this._generateQuality;\r\n\t\t}\r\n\t}\r\n\tsetParameter(key, value)\r\n\t{\r\n\t\tif (typeof value === 'number' && !isNaN(value))\r\n\t\t{\r\n\t\t\tif (key === 'radius' && value > 0)\r\n\t\t\t{\r\n\t\t\t\tthis._radius = value;\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (key === 'degreeStart')\r\n\t\t\t{\r\n\t\t\t\tthis._degreeStart = value;\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (key === 'degreeEnd')\r\n\t\t\t{\r\n\t\t\t\tthis._degreeEnd = value;\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (key === 'extraPointCount')\r\n\t\t\t{\r\n\t\t\t\tif (value === (value | 0) && value >= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._setExtraPoint(value);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (key === 'generateQuality')\r\n\t\t\t{\r\n\t\t\t\tif (value > 100) value = 100;\r\n\t\t\t\telse if (value < 0) value = 0;\r\n\t\t\t\tif (this._generateQuality !== value)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._generateQuality = value;\r\n\t\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate _setExtraPoint(val)\r\n\t{\r\n\t\tif (val === this._extraPointCount) return;\r\n\t\tvar oldrotations = this._rotations;\r\n\r\n\t\tthis._rotations = new Array(val + FIX_POINT_COUNT);\r\n\r\n\t\tfor (var i = 0; i < this._rotations.length; ++i)\r\n\t\t{\r\n\t\t\tif (i < FIX_POINT_COUNT) { this._rotations[0] = 0; }\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar t = (i - FIX_POINT_COUNT) / (this._rotations.length - FIX_POINT_COUNT - 1);\r\n\t\t\t\tthis._rotations[i] = findRotation(oldrotations, t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._extraPointCount = val;\r\n\t\tthis._cacheGenerate = null;\r\n\t}\r\n\tgenerate(numpoints?)\r\n\t{\r\n\t\tvar degree0 = this._degreeStart;\r\n\t\tvar degree1 = this._degreeEnd;\r\n\r\n\t\tif (degree0 > degree1)\r\n\t\t{\r\n\t\t\t[degree0, degree1] = [degree1, degree0];\r\n\t\t}\r\n\t\tnumpoints = numpoints || (((degree1 - degree0) + 1) | 0);\r\n\t\tif (this._cacheGenerate) return this._cacheGenerate;\r\n\r\n\t\tif (this._generateQuality < 100)\r\n\t\t{\r\n\t\t\tnumpoints = (numpoints * this._generateQuality / 100) | 0;\r\n\t\t\tif (numpoints < 10) numpoints = 10;\r\n\t\t}\r\n\r\n\r\n\t\tvar positions: THREE.Vector3[] = new Array(numpoints);\r\n\t\tvar rotations: number[] = new Array(numpoints);\r\n\t\tvar forwards: THREE.Vector3[] = new Array(numpoints);\r\n\t\tvar quaternions: THREE.Quaternion[] = new Array(numpoints);\r\n\t\t//首先生成rotation。只是lerp而已。\r\n\t\tfor (var i = 0; i < numpoints; ++i)\r\n\t\t{\r\n\t\t\trotations[i] = findRotation(this._rotations, i / (numpoints - 1));\r\n\t\t}\r\n\r\n\t\tvar length = this.startPoint.distanceTo(this.endPoint);\r\n\t\tvar zstep = length / (numpoints - 1);\r\n\r\n\r\n\t\tvar angle0 = degree0 * Math.PI / 180.0;\r\n\t\tvar angle1 = degree1 * Math.PI / 180.0;\r\n\r\n\t\tvar angle_step = (angle1 - angle0) / (numpoints - 1);\r\n\t\tvar radius = this._radius;\r\n\t\tvar lookmat = new THREE.Matrix4();\r\n\t\tvar ZERO = new THREE.Vector3();\r\n\t\t//向着Z+方向生成。然后再旋转并平移到实际的位置\r\n\t\tfor (var i = 0; i < numpoints; ++i)\r\n\t\t{\r\n\t\t\tvar a = angle0 + angle_step * i;\r\n\t\t\tvar x = radius * Math.cos(a);\r\n\t\t\tvar y = -radius * Math.sin(a);\r\n\t\t\tvar z = -zstep * i;\r\n\t\t\tpositions[i] = new THREE.Vector3(x, y, z);\r\n\r\n\t\t\tvar np = new THREE.Vector3(\r\n\t\t\t\tradius * Math.cos(a - angle_step),\r\n\t\t\t\t-radius * Math.sin(a - angle_step),\r\n\t\t\t\tzstep * (i - 1)\r\n\t\t\t);\r\n\t\t\t//.....\r\n\t\t\t//dir是 x,y,z对于i的积分\r\n\t\t\tvar dir = new THREE.Vector3(-angle_step * y, angle_step * x, zstep);\r\n\t\t\t//dir.negate();\r\n\t\t\tdir.normalize();\r\n\t\t\tvar up = new THREE.Vector3(x, y, zstep);\r\n\t\t\tlookmat.lookAt(ZERO, dir, up);\r\n\t\t\tquaternions[i] = new THREE.Quaternion();\r\n\t\t\tquaternions[i].setFromRotationMatrix(lookmat);\r\n\t\t}\r\n\t\t//然后，旋转到end-start的方向\r\n\t\tif (length > 0)\r\n\t\t{\r\n\t\t\t//z\r\n\t\t\tvar dir = this.endPoint.clone().sub(this.startPoint).multiplyScalar(1 / length);\r\n\t\t\tvar up: THREE.Vector3; //y\r\n\t\t\tvar left: THREE.Vector3;//x\r\n\t\t\tif (dir.y > dir.x && dir.y > dir.z)\r\n\t\t\t{\r\n\t\t\t\tup = new THREE.Vector3(0, 0, -1);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tup = new THREE.Vector3(0, 1, 0);\r\n\t\t\t}\r\n\t\t\t//X = Y * Z\r\n\t\t\tleft = up.clone().cross(dir);\r\n\t\t\t//Y = Z * X\r\n\t\t\tup.crossVectors(dir, left);\r\n\t\t\tvar rotmat = new THREE.Matrix4();\r\n\t\t\tvar translatemat = new THREE.Matrix4();\r\n\t\t\trotmat.lookAt(new THREE.Vector3(0, 0, 0), dir, up);\r\n\t\t\ttranslatemat.makeTranslation(this.startPoint.x, this.startPoint.y, this.startPoint.z);\r\n\r\n\t\t\tvar rotquat = new THREE.Quaternion();\r\n\t\t\trotquat.setFromRotationMatrix(rotmat);\r\n\r\n\t\t\tvar mat = new THREE.Matrix4();\r\n\t\t\tmat.copy(rotmat).premultiply(translatemat);\r\n\r\n\t\t\tfor (var i = 0; i < numpoints; ++i)\r\n\t\t\t{\r\n\t\t\t\tpositions[i].applyMatrix4(mat);\r\n\t\t\t\tquaternions[i].premultiply(rotquat);\r\n\t\t\t\t//应用rotation\r\n\t\t\t\tapplyRoll(quaternions[i], rotations[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//计算forward。可以放到上面去吗？？？\r\n\t\t//（放到一开始计算，需要后面旋转的。）\r\n\t\tfor (var i = 0; i < numpoints; ++i)\r\n\t\t{\r\n\t\t\tif (i === numpoints - 1)\r\n\t\t\t{\r\n\t\t\t\tforwards[i] = forwards[i - 1].clone();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tforwards[i] = new THREE.Vector3();\r\n\t\t\t\tforwards[i].copy(positions[i + 1]).sub(positions[i]).normalize();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tvar result = { positions, rotations, forwards, quaternions };\r\n\t\tthis._cacheGenerate = result;\r\n\t\treturn result;\r\n\t}\r\n\tupdate()\r\n\t{\r\n\t\tthis.generate();\r\n\t}\r\n\r\n\t//输入i（控制点序号，从0开始，已经减去FIX_POINT_COUNT）\r\n\t//返回对应的generateresult中数据的下标\r\n\t_convertIndex(i: number)\r\n\t{\r\n\t\ti -= 2;\r\n\t\tif (i >= 0 && i < this._extraPointCount)\r\n\t\t{\r\n\t\t\tvar t = i / (this._extraPointCount - 1);\r\n\t\t\tif (this._extraPointCount <= 1)\r\n\t\t\t{\r\n\t\t\t\tt = 0;\r\n\t\t\t}\r\n\t\t\tvar result = this.generate();\r\n\t\t\tvar count = result.positions.length;\r\n\t\t\tvar idx = Math.floor(count * t + 0.5);\r\n\t\t\tif (idx >= count)\r\n\t\t\t{\r\n\t\t\t\tidx = count - 1;\r\n\t\t\t}\r\n\t\t\treturn idx;\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tgetHelperLine()\r\n\t{\r\n\t\treturn [this.startPoint, this.endPoint];\r\n\t}\r\n}\r\n\r\n//从2开始的rotations\r\nfunction findRotation(rotations: number[], t: number)\r\n{\r\n\tvar count = rotations.length - FIX_POINT_COUNT;\r\n\tif (count <= 0) return 0;\r\n\tif (count === 1) return rotations[FIX_POINT_COUNT];\r\n\tif (t <= 0) return rotations[FIX_POINT_COUNT];\r\n\tif (t >= 1) return rotations[rotations.length - 1];\r\n\tvar step = 1 / (count - 1);\r\n\tvar i0 = Math.floor(t / step);\r\n\tvar tt = (t - i0 * step) / step;\r\n\tif (i0 >= count - 1) return rotations[rotations.length - 1];\r\n\treturn lerpRotation(rotations[i0 + FIX_POINT_COUNT], rotations[i0 + 1 + FIX_POINT_COUNT], tt);\r\n}","import { AbstractCurve } from './AbstractCurve'\r\nimport { CurveGenerateResult, ICurveImpl } from '.'\r\nimport { CurveObject } from '../CurveObject'\r\nexport class TranslationGhostCurve extends AbstractCurve\r\n{\r\n\treadonly curveType = 'TranslationGhostCurve'\r\n\treadonly isGhostCurve = true;\r\n\tprivate _refUUID: string | null = null;\r\n\tprivate _curve: ICurveImpl | null = null;\r\n\tprivate _translations: THREE.Vector3[] = [\r\n\t\tnew THREE.Vector3(0, 200, 0),\r\n\t\tnew THREE.Vector3(0, -200, 0),\r\n\t\tnew THREE.Vector3(0, 0, 200),\r\n\t\tnew THREE.Vector3(0, 0, -200),\r\n\t];\r\n\tprivate _cacheGenerate: CurveGenerateResult[] | null;\r\n\tconstructor(jsobj)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.fromJSON(jsobj);\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\treturn { type: this.curveType, refUUID: this._refUUID };\r\n\t}\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tthis._refUUID = obj.refUUID || null;\r\n\t}\r\n\r\n\tallowPointRotation() { return false; }\r\n\tallowPointTranslation() { return false; }\r\n\r\n\t//在每个线的头部放一个控制点\r\n\tgetControlPointCount()\r\n\t{\r\n\t\tvar ret = this.generateMulti();\r\n\t\tif (ret.length === 0) return 1;\r\n\t\tif (ret[0].positions.length === 0) return 1;\r\n\t\treturn ret.length;\r\n\t}\r\n\r\n\tgetPointPosition(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\tvar ret = this.generateMulti();\r\n\t\tif (ret.length === 0 || ret[0].positions.length === 0)\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (i >= 0 && i < ret.length)\r\n\t\t{\r\n\t\t\ttarget.copy(ret[i].positions[0]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0);\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tsuper.update();\r\n\t\tthis._cacheGenerate = null;\r\n\t}\r\n\r\n\tgenerate(numpoints?): CurveGenerateResult\r\n\t{\r\n\t\tvar ret = this.generateMulti();\r\n\t\tif (ret.length === 0)\r\n\t\t{\r\n\t\t\treturn { positions: [], rotations: [], forwards: [], quaternions: [] };\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn ret[0];\r\n\t\t}\r\n\t}\r\n\r\n\tgenerateMulti()\r\n\t{\r\n\t\tif (this._cacheGenerate) return this._cacheGenerate;\r\n\t\tif (!this._curve || this._translations.length === 0 || this._curve.isGhostCurve)\r\n\t\t{\r\n\t\t\tthis._cacheGenerate = [];\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tvar g = this._curve.generate();\r\n\t\tvar rotations = g.rotations.slice();\r\n\t\tvar forwards = g.forwards.slice();\r\n\t\tvar quaternions = g.quaternions.slice();\r\n\t\t//this._cacheGenerate = this._translations.map(t =>\r\n\t\t//{\r\n\t\t//\tvar positions = g.positions.map(p => p.clone().add(t));\r\n\t\t//\treturn { positions, rotations, forwards, quaternions };\r\n\t\t//});\r\n\t\tthis._cacheGenerate = new Array(this._translations.length);\r\n\t\tfor (var i = 0; i < this._cacheGenerate.length; ++i)\r\n\t\t{\r\n\t\t\tvar positions = new Array(g.positions.length);\r\n\t\t\tvar t = this._translations[i];\r\n\t\t\tfor (var j = 0; j < positions.length; ++j)\r\n\t\t\t{\r\n\t\t\t\tvar pp = g.positions[j];\r\n\t\t\t\tpositions[j] = new THREE.Vector3(t.x + pp.x, t.y + pp.y, t.z + pp.z);\r\n\t\t\t}\r\n\t\t\tthis._cacheGenerate[i] = { positions, rotations, forwards, quaternions };\r\n\t\t}\r\n\t\treturn this._cacheGenerate;\r\n\t}\r\n\r\n\tgetParameter(key: string)\r\n\t{\r\n\t\tif (key === 'refUUID') { return this._refUUID; }\r\n\t\tif (key === 'refCurve') { return this._curve; }\r\n\t}\r\n\tsetParameter(key: string, value)\r\n\t{\r\n\t\tif (key === 'refUUID')\r\n\t\t{\r\n\t\t\tthis._refUUID = value;\r\n\t\t\treturn 'norecord';//todo:不需要undo record\r\n\t\t}\r\n\r\n\t\tif (key === 'refCurve')\r\n\t\t{\r\n\t\t\tif (value && typeof value.curveType === 'string' && typeof value.generate === 'function' && !value.isGhostCurve)\r\n\t\t\t{\r\n\t\t\t\tthis._curve = value;\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tapplyOperator(op)\r\n\t{\r\n\t\tif (op.type === 'setFormulation')\r\n\t\t{\r\n\t\t\tif (op.kind === 'box')\r\n\t\t\t{\r\n\t\t\t\tif (op.up && op.right && op.width && op.height)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.setBox(op);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (op.kind === 'circle')\r\n\t\t\t{\r\n\t\t\t\tif (op.up && op.right && op.radius && op.count)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.setCircle(op);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tprivate setCircle(obj)\r\n\t{\r\n\t\tvar up = new THREE.Vector3(obj.up.x, obj.up.y, obj.up.z);\r\n\t\tvar right = new THREE.Vector3(obj.right.x, obj.right.y, obj.right.z);\r\n\t\tvar radius = obj.radius || 0.1;\r\n\t\tvar count = Math.floor(obj.count) || 2; if (count < 2) count = 2;\r\n\r\n\t\tup.normalize();\r\n\t\tright.normalize();\r\n\r\n\r\n\t\tvar angle_step = Math.PI * 2 / count;\r\n\t\tvar translations: THREE.Vector3[] = [];\r\n\t\tvar xtemp = new THREE.Vector3();\r\n\t\tvar ytemp = new THREE.Vector3();\r\n\t\tfor (var i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\tvar angle = i * angle_step;\r\n\t\t\tvar y = radius * Math.cos(angle);\r\n\t\t\tvar x = radius * Math.sin(angle);\r\n\r\n\t\t\txtemp.copy(right);\r\n\t\t\txtemp.multiplyScalar(x);\r\n\r\n\t\t\tytemp.copy(up);\r\n\t\t\tytemp.multiplyScalar(y);\r\n\r\n\t\t\tvar t = new THREE.Vector3();\r\n\t\t\tt.addVectors(xtemp, ytemp);\r\n\t\t\ttranslations.push(t);\r\n\t\t}\r\n\t\tthis._translations = translations;\r\n\t\tthis._cacheGenerate = null;\r\n\t\treturn true;\r\n\t}\r\n\tprivate setBox(obj)\r\n\t{\r\n\t\tvar up = new THREE.Vector3(obj.up.x, obj.up.y, obj.up.z);\r\n\t\tvar right = new THREE.Vector3(obj.right.x, obj.right.y, obj.right.z);\r\n\t\tvar width = obj.width || 100;\r\n\t\tvar height = obj.height || 100;\r\n\t\tvar xcount = obj.xcount || 1;\r\n\t\tvar ycount = obj.ycount || 1;\r\n\r\n\t\tup.normalize();\r\n\t\tright.normalize();\r\n\r\n\t\tvar o = new THREE.Vector3();\r\n\t\to.sub(up.clone().multiplyScalar(height * 0.5));\r\n\t\to.sub(right.clone().multiplyScalar(width * 0.5));\r\n\t\tvar translations: THREE.Vector3[] = [];\r\n\r\n\t\tvar xtemp = new THREE.Vector3();\r\n\t\tvar ytemp = new THREE.Vector3();\r\n\t\tfor (var x = 0; x < xcount; ++x)\r\n\t\t{\r\n\t\t\txtemp.copy(right);\r\n\t\t\txtemp.multiplyScalar(width * x / (xcount - 1));\r\n\t\t\tfor (var y = 0; y < ycount; ++y)\r\n\t\t\t{\r\n\t\t\t\tytemp.copy(up);\r\n\t\t\t\tytemp.multiplyScalar(height * y / (ycount - 1));\r\n\t\t\t\ttranslations.push(\r\n\t\t\t\t\to.clone().add(xtemp).add(ytemp)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._translations = translations;\r\n\t\tthis._cacheGenerate = null;\r\n\t\treturn true;\r\n\t}\r\n\r\n}","import { AbstractCurve } from './AbstractCurve'\r\nimport { CurveGenerateResult, ICurveImpl } from '.'\r\nimport { CurveObject } from '../CurveObject'\r\nimport { generateQuaternion } from './util'\r\nexport class MirrorGhostCurve extends AbstractCurve\r\n{\r\n\treadonly curveType = 'MirrorGhostCurve'\r\n\treadonly isGhostCurve = true;\r\n\tprivate _flipRotation = true;\r\n\tprivate _viewPointCount = 5;\r\n\tprivate _refUUID: string | null = null;\r\n\tprivate _curve: ICurveImpl | null = null;\r\n\tprivate _cacheGenerate: CurveGenerateResult | null = null;\r\n\tconstructor(jsobj)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.fromJSON(jsobj);\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\treturn { type: this.curveType, refUUID: this._refUUID, viewPointCount: this._viewPointCount };\r\n\t}\r\n\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tthis._refUUID = obj.refUUID || null;\r\n\t\tif (typeof obj.viewPointCount === 'number' && obj.viewPointCount >= 2)\r\n\t\t{\r\n\t\t\tthis._viewPointCount = Math.floor(obj.viewPointCount);\r\n\t\t}\r\n\t\tthis._curve = null;\r\n\t\tthis._cacheGenerate = null;\r\n\t}\r\n\r\n\tallowPointRotation() { return true; }\r\n\tallowPointTranslation() { return false; }\r\n\tgetControlPointCount()\r\n\t{\r\n\t\tvar ret = this.generate();\r\n\t\tif (ret)\r\n\t\t{\r\n\t\t\treturn this._viewPointCount;\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tgetPointPosition(i: number, target: THREE.Vector3)\r\n\t{\r\n\t\tvar ret: CurveGenerateResult = this.generate();\r\n\t\tif (ret && ret.positions.length > 0)\r\n\t\t{\r\n\t\t\tvar idx = Math.floor((ret.positions.length - 1) * i / (this._viewPointCount - 1))\r\n\t\t\ttarget.copy(ret.positions[idx]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0);\r\n\t\t}\r\n\t}\r\n\r\n\tgetPointQuaternion(i: number, target: THREE.Quaternion)\r\n\t{\r\n\t\tvar ret: CurveGenerateResult = this.generate();\r\n\t\tif (ret && ret.positions.length > 0)\r\n\t\t{\r\n\t\t\tvar idx = Math.floor((ret.positions.length - 1) * i / (this._viewPointCount - 1))\r\n\t\t\ttarget.copy(ret.quaternions[idx]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttarget.set(0, 0, 0, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tsuper.update();\r\n\t\tthis._cacheGenerate = null;\r\n\t}\r\n\r\n\tgenerate(numpoints?): CurveGenerateResult\r\n\t{\r\n\t\tif (this._cacheGenerate) return this._cacheGenerate;\r\n\t\tif (!this._curve)\r\n\t\t{\r\n\t\t\tthis._cacheGenerate = { positions: [], forwards: [], quaternions: [], rotations: [] };\r\n\t\t\treturn this._cacheGenerate;\r\n\t\t}\r\n\r\n\t\tvar g = this._curve.generate();\r\n\t\tvar positions = g.positions.map(pos =>\r\n\t\t{\r\n\t\t\treturn new THREE.Vector3(-pos.x, -pos.y, pos.z);\r\n\t\t});\r\n\r\n\t\tvar forwards = g.forwards.map(dir =>\r\n\t\t{\r\n\t\t\treturn new THREE.Vector3(-dir.x, -dir.y, dir.z);\r\n\t\t});\r\n\r\n\t\tvar rotations = g.rotations.map(rot =>\r\n\t\t{\r\n\t\t\tif (this._flipRotation)\r\n\t\t\t{\r\n\t\t\t\trot += 180;\r\n\t\t\t\tif (rot > 180) rot -= 360;\r\n\t\t\t}\r\n\t\t\treturn rot;\r\n\t\t});\r\n\r\n\t\tthis._cacheGenerate = { positions, forwards, rotations, quaternions: [] };\r\n\t\tgenerateQuaternion(this._cacheGenerate);\r\n\t\treturn this._cacheGenerate;\r\n\t}\r\n\r\n\tgetParameter(key: string)\r\n\t{\r\n\t\tif (key === 'refUUID') { return this._refUUID; }\r\n\t\tif (key === 'refCurve') { return this._curve; }\r\n\t\tif (key === 'viewPointCount') { return this._viewPointCount; }\r\n\t\tif (key === 'flipRotation') return this._flipRotation;\r\n\t}\r\n\tsetParameter(key: string, value)\r\n\t{\r\n\t\tif (key === 'refUUID')\r\n\t\t{\r\n\t\t\tthis._refUUID = value;\r\n\t\t\treturn 'norecord';//todo:不需要undo record\r\n\t\t}\r\n\r\n\t\tif (key === 'refCurve')\r\n\t\t{\r\n\t\t\tif (value && typeof value.curveType === 'string' && typeof value.generate === 'function' && !value.isGhostCurve)\r\n\t\t\t{\r\n\t\t\t\tthis._curve = value;\r\n\t\t\t\tthis._cacheGenerate = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (key === 'viewPointCount')\r\n\t\t{\r\n\t\t\tif (typeof value === 'number' && value >= 2 && value <= 30)\r\n\t\t\t{\r\n\t\t\t\tthis._viewPointCount = Math.floor(value);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (key === 'flipRotation' && typeof value === 'boolean' && this._flipRotation !== value)\r\n\t\t{\r\n\t\t\tthis._flipRotation = !!value;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n}","import { CatmullRomCurve3 } from './CatmullRomCurve3'\r\nimport { QuadraticBezierCurve3 } from './QuadraticBezierCurve3'\r\nimport { CubicBezierCurve3 } from './CubicBezierCurve3'\r\nimport { ArcCurve } from './ArcCurve'\r\nimport { TranslationGhostCurve } from './TranslationGhostCurve'\r\nimport { MirrorGhostCurve } from './MirrorGhostCurve'\r\n\r\n\r\nexport interface ICurveImpl\r\n{\r\n\treadonly curveType: string;\r\n\t//ghost curve会引用另一条曲线\r\n\treadonly isGhostCurve: boolean;\r\n\tgenerate(numpoints?: number): CurveGenerateResult;\r\n\tgenerateMulti(): CurveGenerateResult[];\r\n\tgetControlPointCount(): number;\r\n\r\n\tallowPointRotation(i: number): boolean;\r\n\tallowPointTranslation(i: number): boolean;\r\n\r\n\t//target is needed.\r\n\tgetPointPosition(i: number, target: THREE.Vector3);\r\n\tgetPointRotation(i: number): number;\r\n\r\n\t// target will be set to (0,0,0) if target is not avaliable\r\n\tgetPointForward(i: number, target: THREE.Vector3);\r\n\tgetPointQuaternion(i: number, target: THREE.Quaternion);\r\n\t//call update() is needed.\r\n\tsetPointPosition(i: number, pos: THREE.Vector3);\r\n\t//call update() is needed.\r\n\tsetPointRotation(i: number, rot: number);\r\n\tupdate();\r\n\r\n\ttoJSON(): object;\r\n\tfromJSON(obj: any);\r\n\r\n\tallowOperator(op: any): boolean;\r\n\tapplyOperator(op: any): boolean;\r\n\r\n\tgetParameter(key: string): any;\r\n\tsetParameter(key: string, value: any);\r\n\r\n\tgetHelperLine(): THREE.Vector3[];\r\n}\r\n\r\nexport interface CurveGenerateResult\r\n{\r\n\tpositions: THREE.Vector3[];\r\n\trotations: number[];\r\n\tforwards: THREE.Vector3[];\r\n\tquaternions: THREE.Quaternion[];\r\n}\r\n\r\nexport function createCurve(type, initJsonObject): ICurveImpl | null\r\n{\r\n\tif (type === 'CatmullRomCurve3')\r\n\t{\r\n\t\treturn new CatmullRomCurve3(initJsonObject);\r\n\t}\r\n\telse if (type === 'QuadraticBezierCurve3')\r\n\t{\r\n\t\treturn new QuadraticBezierCurve3(initJsonObject);\r\n\t}\r\n\telse if (type === 'CubicBezierCurve3')\r\n\t{\r\n\t\treturn new CubicBezierCurve3(initJsonObject);\r\n\t}\r\n\telse if (type === 'ArcCurve')\r\n\t{\r\n\t\treturn new ArcCurve(initJsonObject);\r\n\t}\r\n\telse if (type === 'TranslationGhostCurve')\r\n\t{\r\n\t\treturn new TranslationGhostCurve(initJsonObject);\r\n\t}\r\n\telse if (type === 'MirrorGhostCurve')\r\n\t{\r\n\t\treturn new MirrorGhostCurve(initJsonObject);\r\n\t}\r\n\tconsole.error('create curve failed', initJsonObject);\r\n\treturn null;\r\n}","import { ControlPoint } from \"./ControlPoint\"\r\nimport { Application } from './Application'\r\nimport * as CurveImpl from './curves'\r\nconst DEFAULT_NUM_POINTS = 400;\r\ntype CurveType = 'CatmullRomCurve3' | 'QuadraticBezierCurve3';\r\nvar g_CurveCount = 1;\r\ninterface CurveBindingInfo\r\n{\r\n\tcurve: CurveObject;\r\n\tdispose: Function;\r\n}\r\n\r\nexport class CurveObject extends THREE.EventDispatcher\r\n{\r\n\tuuid = THREE.Math.generateUUID();\r\n\tname: string = 'curve001';\r\n\ttype: CurveType;\r\n\tcontrolPoints: ControlPoint[];\r\n\tcurve: CurveImpl.ICurveImpl;\r\n\tdisposed = false;\r\n\r\n\tdirtyForAnimation = false;\r\n\tdirtyForSelection = false;\r\n\r\n\t//make public, set dirtyForAnimation\r\n\tanimOffset = new THREE.Vector3(0, 0, 0);\r\n\tanimWait = 0; //ms\r\n\r\n\tprivate _motionSpeed = 200;\r\n\tprivate geometry: THREE.BufferGeometry;\r\n\tprivate material: THREE.LineBasicMaterial;\r\n\tprivate line: THREE.Line;\r\n\tprivate helpLine: THREE.Line;\r\n\tprivate _logicCurveChanged = true;\r\n\tprivate _app: Application;\r\n\r\n\tprivate _curveChangeBindings: CurveBindingInfo[] = [];\r\n\r\n\tconstructor(initJson: any)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.name = `curve${g_CurveCount}`;\r\n\t\t++g_CurveCount;\r\n\t\tthis.controlPoints = [];\r\n\t\tthis.curve = CurveImpl.createCurve(initJson.type, initJson) as CurveImpl.ICurveImpl;\r\n\r\n\t\tthis.geometry = new THREE.BufferGeometry();\r\n\t\tvar attr = new THREE.BufferAttribute(new Float32Array(0), 3, false);\r\n\t\tattr.setDynamic(true);\r\n\t\tthis.geometry.addAttribute('position', attr);\r\n\t\tthis.material = new THREE.LineBasicMaterial({\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\topacity: 1,\r\n\t\t\tlinewidth: 2,\r\n\t\t\tdepthTest: true,\r\n\t\t\tdepthWrite: true,\r\n\t\t\tdepthFunc: THREE.AlwaysDepth,\r\n\t\t});\r\n\t\tthis.line = new THREE.Line(this.geometry, [this.material] as any);\r\n\t\tthis.line.renderOrder = 20;\r\n\t\tthis.line.matrixAutoUpdate = false;\r\n\t\tthis.line.frustumCulled = false;\r\n\r\n\r\n\t\tvar helpLineBuffer = new THREE.BufferGeometry();\r\n\t\tvar helpLineMaterial = new THREE.LineDashedMaterial({\r\n\t\t\tcolor: 0xffff00,\r\n\t\t\tdepthTest: true,\r\n\t\t\tdepthWrite: true,\r\n\t\t\tdepthFunc: THREE.AlwaysDepth,\r\n\t\t\tgapSize: 5,\r\n\t\t\tdashSize: 10,\r\n\t\t\tscale: 1\r\n\t\t});\r\n\t\thelpLineBuffer.addAttribute('position', new THREE.BufferAttribute(new Float32Array(0), 3).setDynamic(true));\r\n\t\tthis.helpLine = new THREE.LineSegments(helpLineBuffer, helpLineMaterial as any);\r\n\r\n\t\tthis.line.add(this.helpLine);\r\n\r\n\t\tthis._updateCurveToControlPoint();\r\n\t\tthis._updateGeometry();\r\n\t\t//call fromJSON here to set my uuid\r\n\t\tthis.fromJSON(initJson);\r\n\t}\r\n\tstatic GetSupportedCurveTypes()\r\n\t{\r\n\t\treturn ['CatmullRomCurve3', 'QuadraticBezierCurve3'];\r\n\t}\r\n\tget color() { return '#' + this.material.color.getHexString(); }\r\n\tset color(val) { this.material.color.set(val); }\r\n\tget visible() { return this.line.visible; }\r\n\tset visible(val: boolean)\r\n\t{\r\n\t\tif (this.line.visible !== val)\r\n\t\t{\r\n\t\t\tthis.line.visible = val;\r\n\t\t\tfor (var cp of this.controlPoints)\r\n\t\t\t{\r\n\t\t\t\tcp.visible = val;\r\n\t\t\t}\r\n\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t}\r\n\t}\r\n\ttoJSON()\r\n\t{\r\n\t\tvar obj: any = this.curve.toJSON();\r\n\t\tobj.uuid = this.uuid;\r\n\t\tobj.motionSpeed = this._motionSpeed;\r\n\t\tobj.animOffset = { x: this.animOffset.x, y: this.animOffset.y, z: this.animOffset.z };\r\n\t\tobj.animWait = this.animWait;\r\n\t\tobj.name = this.name;\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tif (obj.type === this.curve.curveType)\r\n\t\t{\r\n\t\t\tthis.curve.fromJSON(obj);\r\n\t\t\tthis._updateCurveToControlPoint();\r\n\t\t\tif (typeof obj.uuid === 'string')\r\n\t\t\t{\r\n\t\t\t\tthis.uuid = obj.uuid;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof obj.motionSpeed === 'number' && obj.motionSpeed >= 0.01)\r\n\t\t\t{\r\n\t\t\t\tthis._motionSpeed = obj.motionSpeed;\r\n\t\t\t}\r\n\r\n\t\t\tif (obj.animOffset)\r\n\t\t\t{\r\n\t\t\t\tthis.animOffset.x = obj.animOffset.x || 0;\r\n\t\t\t\tthis.animOffset.y = obj.animOffset.y || 0;\r\n\t\t\t\tthis.animOffset.z = obj.animOffset.z || 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof obj.animWait === 'number')\r\n\t\t\t{\r\n\t\t\t\tthis.animWait = obj.animWait;\r\n\t\t\t}\r\n\t\t\tif (obj.name)\r\n\t\t\t{\r\n\t\t\t\tthis.name = obj.name;\r\n\t\t\t}\r\n\t\t\tthis._logicCurveChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget motionSpeed() { return this._motionSpeed; }\r\n\tset motionSpeed(val)\r\n\t{\r\n\t\tif (typeof val === 'number' && val >= 0.01)\r\n\t\t{\r\n\t\t\tthis._motionSpeed = val;\r\n\t\t\tthis.dirtyForAnimation = true;\r\n\t\t\t//this._logicCurveChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\r\n\t\tif (this._logicCurveChanged)\r\n\t\t{\r\n\t\t\tthis._logicCurveChanged = false;\r\n\t\t\t//here check bind\r\n\t\t\tvar refUUID = this.curve.getParameter('refUUID')\r\n\t\t\tif (refUUID)\r\n\t\t\t{\r\n\t\t\t\tvar hasBind = this._curveChangeBindings.some(cc => cc.curve.uuid === refUUID);\r\n\t\t\t\tif (!hasBind)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar otherCurve = app.getCurveByUUID(refUUID);\r\n\t\t\t\t\tif (otherCurve)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.clearBindingCurveChange();\r\n\t\t\t\t\t\tthis.bindCurveChange(otherCurve);\r\n\t\t\t\t\t\tthis.curve.setParameter('refCurve', otherCurve.curve);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.warn('fail to bind curve');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\tthis.curve.update();\r\n\t\t\tthis._updateCurveToControlPoint();\r\n\t\t\tthis._updateGeometry();\r\n\t\t\tthis.dispatchEvent({ type: 'change', curve: this });\r\n\t\t\tthis.dirtyForAnimation = true;\r\n\t\t\tthis.dirtyForSelection = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _updateCurveToControlPoint()\r\n\t{\r\n\t\tvar count = this.curve.getControlPointCount();\r\n\t\twhile (this.controlPoints.length > count)\r\n\t\t{\r\n\t\t\tvar cp = this.controlPoints.pop()!;\r\n\t\t\tcp!.dispose();\r\n\t\t}\r\n\r\n\t\twhile (this.controlPoints.length < count)\r\n\t\t{\r\n\t\t\tvar i = this.controlPoints.length;\r\n\t\t\tvar cp = new ControlPoint(this);\r\n\t\t\tthis.controlPoints.push(cp);\r\n\t\t\tcp.attachTo(app);\r\n\t\t}\r\n\t\tfor (var i = 0; i < this.controlPoints.length; ++i)\r\n\t\t{\r\n\t\t\tvar cp = this.controlPoints[i];\r\n\t\t\tcp._updateFromLogicCurve(i, this.curve);\r\n\t\t}\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tif (this.geometry)\r\n\t\t{\r\n\t\t\tthis.geometry.dispose();\r\n\t\t}\r\n\t\tif (this.material)\r\n\t\t{\r\n\t\t\tthis.material.dispose();\r\n\t\t}\r\n\t\tif (this.line && this.line.parent)\r\n\t\t{\r\n\t\t\tthis.line.parent.remove(this.line);\r\n\t\t}\r\n\t\tif (Array.isArray(this.line.material))\r\n\t\t{\r\n\t\t\tfor (var m of this.line.material)\r\n\t\t\t{\r\n\t\t\t\tm.dispose();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.line.material.dispose();\r\n\t\t}\r\n\t\tfor (var cp of this.controlPoints)\r\n\t\t{\r\n\t\t\tcp.dispose();\r\n\t\t}\r\n\t\tthis.disposed = true;\r\n\t\tthis.dispatchEvent({ type: 'dispose', curve: this });\r\n\t}\r\n\r\n\tattachTo(app: Application)\r\n\t{\r\n\t\tthis._app = app;\r\n\t\tapp.scene.add(this.line);\r\n\t\tthis.line.add(this.helpLine);\r\n\t\tfor (var cp of this.controlPoints)\r\n\t\t\tcp.attachTo(app);\r\n\t}\r\n\r\n\tgenerateAnimationClip(speed?: number): THREE.AnimationClip\r\n\t{\r\n\t\tif (!speed) speed = this._motionSpeed;\r\n\t\tvar duration;\r\n\t\tif (!(speed && speed > 0.01)) speed = 100;\r\n\t\tvar genresult = this.curve.generate();\r\n\t\tvar totalLength = 0;\r\n\t\tfor (var i = 0; i < genresult.positions.length - 1; ++i)\r\n\t\t{\r\n\t\t\ttotalLength += genresult.positions[i].distanceTo(genresult.positions[i + 1]);\r\n\t\t}\r\n\t\tduration = totalLength >= 0.1 ? totalLength / speed : 1;\r\n\r\n\t\tvar count = genresult.positions.length;\r\n\t\tvar times: number[] = [];\r\n\t\tvar animWait = this.animWait >= 0 ? this.animWait : 0;\r\n\t\tfor (var i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\ttimes.push(i / (count - 1) * duration + animWait / 1000);\r\n\t\t}\r\n\r\n\t\tvar flatPos = new Array(count * 3);\r\n\t\tvar { x: offX, y: offY, z: offZ } = this.animOffset;\r\n\t\tfor (var i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\tflatPos[i * 3 + 0] = genresult.positions[i].x + offX;\r\n\t\t\tflatPos[i * 3 + 1] = genresult.positions[i].y + offY;\r\n\t\t\tflatPos[i * 3 + 2] = genresult.positions[i].z + offZ;\r\n\t\t}\r\n\t\tvar positionTrack = new THREE.VectorKeyframeTrack('.position', times, flatPos, THREE.InterpolateLinear);\r\n\r\n\t\tvar flatRot = new Array(count * 4);\r\n\t\tfor (i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\tflatRot[i * 4 + 0] = genresult.quaternions[i].x;\r\n\t\t\tflatRot[i * 4 + 1] = genresult.quaternions[i].y;\r\n\t\t\tflatRot[i * 4 + 2] = genresult.quaternions[i].z;\r\n\t\t\tflatRot[i * 4 + 3] = genresult.quaternions[i].w;\r\n\t\t}\r\n\t\tvar rotationTrack = new THREE.QuaternionKeyframeTrack('.quaternion', times, flatRot, THREE.InterpolateLinear);\r\n\t\treturn new THREE.AnimationClip('noname', duration + animWait / 1000, [positionTrack, rotationTrack]);\r\n\t}\r\n\r\n\tgenerateBuffer(speed?)\r\n\t{\r\n\t\tif (!speed) speed = this._motionSpeed;\r\n\t\tvar clip = this.generateAnimationClip(speed);\r\n\t\tvar posTrack = clip.tracks[0];\r\n\t\tvar rotTrack = clip.tracks[1];\r\n\t\tvar duration = clip.duration;\r\n\t\tvar timegap = 0.03;\r\n\t\tvar count = Math.floor(duration / timegap) + 1;\r\n\r\n\t\tvar buf = new ArrayBuffer(2 + (7 * 2 * count));\r\n\t\t//\r\n\t\tvar shortView = new Int16Array(buf);\r\n\t\tshortView[0] = count;\r\n\r\n\t\tvar posInt = posTrack.InterpolantFactoryMethodLinear(undefined);\r\n\t\tvar rotInt = rotTrack.InterpolantFactoryMethodLinear(undefined);\r\n\r\n\t\tvar floatView = new Int16Array(buf, 2);\r\n\t\tvar offset = 0;\r\n\r\n\t\tvar zero = new THREE.Vector3();\r\n\t\tvar q1 = new THREE.Quaternion();\r\n\t\tvar q2 = new THREE.Quaternion();\r\n\t\tvar up = new THREE.Vector3();\r\n\t\tvar forward = new THREE.Vector3();\r\n\t\tfor (var i = 0; i < count; ++i)\r\n\t\t{\r\n\t\t\tvar t = i * timegap;\r\n\t\t\tvar pos = posInt.evaluate(t) as Float32Array;\r\n\t\t\tvar rot = rotInt.evaluate(t) as Float32Array;\r\n\t\t\tvar rotx = rot[0]\r\n\t\t\t\t, roty = rot[1]\r\n\t\t\t\t, rotz = rot[2]\r\n\t\t\t\t, rotw = rot[3];\r\n\r\n\r\n\r\n\t\t\tq1.set(rotx, roty, rotz, rotw);\r\n\t\t\tup.set(0, 1, 0);\r\n\t\t\tforward.set(0, 0, 1);\r\n\t\t\tup.applyQuaternion(q1);\r\n\t\t\tforward.applyQuaternion(q1);\r\n\t\t\tup.x = -up.x;\r\n\t\t\tforward.x = -forward.x;\r\n\t\t\tforward.negate();\r\n\r\n\t\t\tvar m = new THREE.Matrix4();\r\n\t\t\tm.lookAt(zero, forward, up);\r\n\t\t\tq1.setFromRotationMatrix(m);\r\n\r\n\r\n\t\t\tfloatView[offset++] = q1.x * 32768;\r\n\t\t\tfloatView[offset++] = q1.y * 32768;\r\n\t\t\tfloatView[offset++] = q1.z * 32768;\r\n\t\t\tfloatView[offset++] = q1.w * 32768;\r\n\r\n\t\t\tfloatView[offset++] = -pos[0] / 13107.2 * 32768;\r\n\t\t\tfloatView[offset++] = pos[1] / 13107.2 * 32768;\r\n\t\t\tfloatView[offset++] = pos[2] / 13107.2 * 32768;\r\n\t\t}\r\n\t\t//(new Uint8Array(buf)).set(floatView, 2);\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tprivate _updateGeometry()\r\n\t{\r\n\t\tvar geometry = this.geometry;\r\n\t\tvar attr: THREE.BufferAttribute = geometry.getAttribute('position') as THREE.BufferAttribute;\r\n\t\tvar results = this.curve.generateMulti();\r\n\t\t//support multi lines\r\n\t\tvar totalPoints = 0;\r\n\t\tfor (var i = 0; i < results.length; ++i) totalPoints += results[i].positions.length;\r\n\r\n\t\tif (attr.array.length < totalPoints * 3)\r\n\t\t{\r\n\t\t\tattr = new THREE.BufferAttribute(new Float32Array(totalPoints * 3 + 50 * 3), 3);\r\n\t\t\tgeometry.removeAttribute('position');\r\n\t\t\tgeometry.addAttribute('position', attr);\r\n\t\t}\r\n\t\t//copy pos\r\n\t\tvar array = attr.array as Float32Array;\r\n\t\tgeometry.clearGroups();\r\n\t\tlet offset = 0;\r\n\t\tfor (var i = 0; i < results.length; ++i)\r\n\t\t{\r\n\t\t\tvar g = results[i];\r\n\t\t\tgeometry.addGroup(offset / 3, g.positions.length, 0);\r\n\t\t\t//console.log(`addgroup`, offset, g.positions.length);\r\n\t\t\tfor (var j = 0; j < g.positions.length; ++j)\r\n\t\t\t{\r\n\t\t\t\tvar p = g.positions[j];\r\n\t\t\t\tarray[offset++] = p.x;\r\n\t\t\t\tarray[offset++] = p.y;\r\n\t\t\t\tarray[offset++] = p.z;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tattr.count = totalPoints;\r\n\t\tattr.needsUpdate = true;\r\n\t\tif (geometry.boundingSphere)\r\n\t\t\tgeometry.boundingSphere.radius = 99999999999999999;\r\n\r\n\t\t//update helpline\r\n\t\tvar helpLine = this.helpLine;\r\n\t\tvar helpLineGeom = helpLine.geometry as THREE.BufferGeometry;\r\n\t\tvar helpLineAttr = helpLineGeom.getAttribute('position') as THREE.BufferAttribute;\r\n\t\tvar helpLineData = this.curve.getHelperLine();\r\n\t\tif (helpLineData.length > helpLineAttr.array.length)\r\n\t\t{\r\n\t\t\thelpLineAttr = new THREE.BufferAttribute(new Float32Array(helpLineData.length * 3 + 10 * 3), 3);\r\n\t\t\thelpLineGeom.addAttribute('position', helpLineAttr);\r\n\t\t}\r\n\t\thelpLineAttr.copyVector3sArray(helpLineData);\r\n\t\thelpLineAttr.count = helpLineData.length;\r\n\t\thelpLineGeom.setDrawRange(0, helpLineData.length);\r\n\t\thelpLineAttr.needsUpdate = true;\r\n\t\thelpLine.computeLineDistances();\r\n\t\tif (helpLineGeom.boundingSphere)\r\n\t\t\thelpLineGeom.boundingSphere.radius = 999999999999999;\r\n\t\tthis.dirtyForAnimation = true;\r\n\t}\r\n\r\n\t//operations\r\n\tapplyMoveToPoint(index: number, pt: THREE.Vector3)\r\n\t{\r\n\t\t//if (this.curve.allowPointTranslation(index))\r\n\t\t{\r\n\t\t\tthis.curve.setPointPosition(index, pt);\r\n\t\t\tthis._logicCurveChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tapplyMoveByOffset(index: number, pt: THREE.Vector3)\r\n\t{\r\n\t\t//if (this.curve.allowPointTranslation(index))\r\n\t\t{\r\n\t\t\tvar tmp = new THREE.Vector3();\r\n\t\t\tthis.curve.getPointPosition(index, tmp);\r\n\t\t\ttmp.add(pt);\r\n\t\t\tthis.curve.setPointPosition(index, tmp);\r\n\t\t\tthis._logicCurveChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tapplyPointRotation(index: number, rot: number)\r\n\t{\r\n\t\tthis.curve.setPointRotation(index, rot);\r\n\t\tthis._logicCurveChanged = true;\r\n\t}\r\n\r\n\tapplyPointRotationDelta(index: number, delta: number)\r\n\t{\r\n\t\tvar rot = this.curve.getPointRotation(index) + delta;\r\n\t\tthis.curve.setPointRotation(index, rot);\r\n\t\tthis._logicCurveChanged = true;\r\n\t}\r\n\r\n\tallowOperator(op) { return this.curve.allowOperator(op); }\r\n\tapplyOperator(op)\r\n\t{\r\n\t\tvar ret = this.curve.applyOperator(op);\r\n\t\tif (ret) \r\n\t\t{\r\n\t\t\tthis._logicCurveChanged = true;\r\n\t\t\tthis.curve.update();\r\n\t\t\tthis._updateCurveToControlPoint();\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tsetParameter(key, value)\r\n\t{\r\n\t\tif (key === 'motionSpeed')\r\n\t\t{\r\n\t\t\tthis.motionSpeed = value;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar ret = this.curve.setParameter(key, value);\r\n\t\tif (ret)\r\n\t\t{\r\n\t\t\tthis._logicCurveChanged = true;\r\n\t\t\tthis.curve.update();\r\n\t\t\tthis._updateCurveToControlPoint();\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\tgetParameter(key)\r\n\t{\r\n\t\tif (key === 'motionSpeed') return this._motionSpeed;\r\n\t\treturn this.curve.getParameter(key);\r\n\t}\r\n\r\n\t//绑定一个曲线。\r\n\tbindCurveChange(curve: CurveObject)\r\n\t{\r\n\t\tif (curve === this)\r\n\t\t{\r\n\t\t\tconsole.warn('warning: cant bind to self');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (curve.disposed)\r\n\t\t{\r\n\t\t\tconsole.warn('warning: cant bind to a disposed curve object');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\tif (this._curveChangeBindings.some(bd => bd.curve === curve))\r\n\t\t{\r\n\t\t\tconsole.warn('warning: alread bind the curve');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar self = this;\r\n\t\tfunction onChange(e)\r\n\t\t{\r\n\t\t\tself._logicCurveChanged = true;\r\n\t\t}\r\n\r\n\t\tfunction onDispose(e)\r\n\t\t{\r\n\t\t\tself.unbindCurveChange(curve);\r\n\t\t}\r\n\t\tfunction dispose()\r\n\t\t{\r\n\t\t\tcurve.removeEventListener('change', onChange);\r\n\t\t\tcurve.removeEventListener('dispose', onDispose);\r\n\t\t}\r\n\t\tcurve.addEventListener('change', onChange);\r\n\t\tcurve.addEventListener('dispose', onDispose);\r\n\t\tthis._curveChangeBindings.push({\r\n\t\t\tcurve: curve,\r\n\t\t\tdispose: dispose\r\n\t\t});\r\n\t}\r\n\r\n\tunbindCurveChange(curve: CurveObject)\r\n\t{\r\n\t\tfor (var i = 0; i < this._curveChangeBindings.length; ++i)\r\n\t\t{\r\n\t\t\tif (this._curveChangeBindings[i].curve === curve)\r\n\t\t\t{\r\n\t\t\t\tvar bd = this._curveChangeBindings[i];\r\n\t\t\t\tthis._curveChangeBindings.splice(i, 1);\r\n\t\t\t\tbd.dispose();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thasBindingCurveChange(curve: CurveObject)\r\n\t{\r\n\t\treturn this._curveChangeBindings.some(bd => bd.curve === curve);\r\n\t}\r\n\r\n\tclearBindingCurveChange()\r\n\t{\r\n\t\tfor (var i = this._curveChangeBindings.length - 1; i >= 0; --i)\r\n\t\t{\r\n\t\t\tthis._curveChangeBindings[i].dispose();\r\n\t\t}\r\n\t\tthis._curveChangeBindings.length = 0;\r\n\t}\r\n}\r\n/*\r\nconst ZERO = new THREE.Vector3(0, 0, 0);\r\nconst ROT_MAT = new THREE.Matrix4();\r\nconst UP = new THREE.Vector3();\r\nfunction adjustLookAt(q: THREE.Quaternion, target: THREE.Vector3)\r\n{\r\n\tROT_MAT.makeRotationFromQuaternion(q);\r\n\tUP.setFromMatrixColumn(ROT_MAT, 1);\r\n\tROT_MAT.lookAt(target, ZERO, UP);\r\n\tq.setFromRotationMatrix(ROT_MAT);\r\n}*/\r\n/*\r\nfunction findClosestPointIndex(arr: THREE.Vector3[], pt: THREE.Vector3)\r\n{\r\n\tvar idx = 0;\r\n\tvar dist = Number.MAX_VALUE;\r\n\tfor (var i = 0; i < arr.length; ++i)\r\n\t{\r\n\t\tvar dist2 = pt.distanceToSquared(arr[i]);\r\n\t\tif (dist2 < dist)\r\n\t\t{\r\n\t\t\tidx = i;\r\n\t\t\tdist = dist2;\r\n\t\t}\r\n\t}\r\n\treturn idx;\r\n}\r\n*/\r\n/*\r\nconst Z_AXIS = new THREE.Vector3(0, 0, 1);\r\nconst TEMP_Q = new THREE.Quaternion;\r\nfunction calcRotation(previousQuaternion: THREE.Quaternion, previousTarget: THREE.Vector3,\r\n\tpreviousRotation: number,\r\n\tquaternion: THREE.Quaternion, forward: THREE.Vector3, rotation: number)\r\n{\r\n\tif (!previousQuaternion)\r\n\t{\r\n\t\tquaternion.setFromUnitVectors(Z_AXIS, forward);\r\n\t\tvar q1 = TEMP_Q;\r\n\t\tq1.setFromAxisAngle(Z_AXIS, rotation / 180 * Math.PI);\r\n\t\tquaternion.multiply(q1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tquaternion.copy(previousQuaternion);\r\n\t\tTEMP_Q.setFromUnitVectors(previousTarget, forward);\r\n\t\tquaternion.premultiply(TEMP_Q);\r\n\r\n\t\tTEMP_Q.setFromAxisAngle(Z_AXIS, (rotation - previousRotation) / 180 * Math.PI);\r\n\t\tquaternion.multiply(TEMP_Q);\r\n\t}\r\n\r\n}*/","import { Application } from './Application'\r\n\r\nexport class ObjectPickControl extends THREE.EventDispatcher\r\n{\r\n\tobjects: THREE.Object3D[] = [];\r\n\tprivate _camera: THREE.Camera;\r\n\tprivate _domElement: HTMLElement;\r\n\tprivate _rayCaster: THREE.Raycaster;\r\n\tprivate _removeEventFunc: Function;\r\n\tconstructor(app: Application)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._camera = app.camera;\r\n\t\tthis._domElement = app.domElement;\r\n\t\tthis._rayCaster = new THREE.Raycaster();\r\n\r\n\t\tvar self = this;\r\n\t\tvar tempArray: THREE.Intersection[] = [];\r\n\t\tvar lastHovered: THREE.Object3D|null = null;\r\n\t\tfunction onMouseMove(e: MouseEvent)\r\n\t\t{\r\n\t\t\tvar obj = self.pickNearest(e, tempArray);\r\n\r\n\t\t\tif (obj !== lastHovered)\r\n\t\t\t{\r\n\t\t\t\tself.dispatchEvent({ type: obj ? 'hoveron' : 'hoveroff', object: obj, originalEvent: e });\r\n\t\t\t}\r\n\r\n\t\t\tif (lastHovered && obj !== lastHovered)\r\n\t\t\t{\r\n\t\t\t\tlastHovered.dispatchEvent({ type: 'hoveroff', object: lastHovered, originalEvent: e });\r\n\t\t\t\tlastHovered = null;\r\n\t\t\t}\r\n\t\t\tif (obj !== lastHovered)\r\n\t\t\t{\r\n\t\t\t\tlastHovered = obj;\r\n\t\t\t\tlastHovered!.dispatchEvent({ type: 'hoveron', object: lastHovered, originalEvent: e });\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onMouseDown(e: MouseEvent)\r\n\t\t{\r\n\t\t\tvar obj = self.pickNearest(e, tempArray);\r\n\t\t\tif (obj)\r\n\t\t\t{\r\n\t\t\t\tobj.dispatchEvent({ type: 'mousedown', object: obj, originalEvent: e });\r\n\t\t\t}\r\n\t\t\tself.dispatchEvent({ type: 'mousedown', object: obj, originalEvent: e });\r\n\t\t}\r\n\r\n\t\tfunction onMouseUp(e: MouseEvent)\r\n\t\t{\r\n\t\t\tvar obj = self.pickNearest(e, tempArray);\r\n\t\t\tif (obj)\r\n\t\t\t{\r\n\t\t\t\tobj.dispatchEvent({ type: 'mouseup', object: obj, originalEvent: e });\r\n\t\t\t}\r\n\t\t\tself.dispatchEvent({ type: 'mouseup', object: obj, originalEvent: e });\r\n\t\t}\r\n\r\n\t\tfunction onMouseLeave(e: MouseEvent)\r\n\t\t{\r\n\t\t\tif (lastHovered)\r\n\t\t\t{\r\n\t\t\t\tlastHovered.dispatchEvent({ type: 'hoveroff', object: lastHovered, originalEvent: e });\r\n\t\t\t\tlastHovered = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dom = app.domElement;\r\n\t\tdom.addEventListener('mousemove', onMouseMove, false);\r\n\t\tdom.addEventListener('mousedown', onMouseDown, false);\r\n\t\tdom.addEventListener('mouseup', onMouseUp, false);\r\n\t\tdom.addEventListener('mouseleave', onMouseLeave, false);\r\n\r\n\t\tthis._removeEventFunc = function ()\r\n\t\t{\r\n\t\t\tdom.removeEventListener('mousemove', onMouseMove, false);\r\n\t\t\tdom.removeEventListener('mousedown', onMouseDown, false);\r\n\t\t\tdom.removeEventListener('mouseup', onMouseUp, false);\r\n\t\t\tdom.removeEventListener('mouseleave', onMouseLeave, false);\r\n\t\t};\r\n\t}\r\n\r\n\tpick(e: MouseEvent, array?: THREE.Intersection[]): THREE.Intersection[]\r\n\t{\r\n\t\tif (array) array.length = 0;\r\n\t\tvar rect = this._domElement.getBoundingClientRect();\r\n\t\tvar mouse = {\r\n\t\t\tx: ((e.clientX - rect.left) / rect.width) * 2 - 1,\r\n\t\t\ty: - ((e.clientY - rect.top) / rect.height) * 2 + 1\r\n\t\t};\r\n\t\tthis._rayCaster.setFromCamera(mouse, this._camera);\r\n\t\tarray = this._rayCaster.intersectObjects(this.objects, true, array);\r\n\t\tarray.sort((a, b) =>\r\n\t\t{\r\n\t\t\treturn a.distance - b.distance;\r\n\t\t})\r\n\t\treturn array;\r\n\t}\r\n\r\n\tpickNearest(e: MouseEvent, array?: THREE.Intersection[])\r\n\t{\r\n\t\tarray = this.pick(e, array);\r\n\t\tfor (var ob of array)\r\n\t\t{\r\n\t\t\tvar realObj = ob.object;\r\n\t\t\twhile (true)\r\n\t\t\t{\r\n\t\t\t\tif (this.objects.indexOf(realObj) >= 0) break;\r\n\t\t\t\tif (!realObj.parent) break;\r\n\t\t\t\trealObj = realObj.parent;\r\n\t\t\t}\r\n\r\n\t\t\tif (realObj['disablePick'] !== true)\r\n\t\t\t{\r\n\t\t\t\treturn realObj;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tif (this._removeEventFunc)\r\n\t\t{\r\n\t\t\tthis._removeEventFunc();\r\n\t\t}\r\n\t}\r\n}","\r\nclass EventDispatcherHelper\r\n{\r\n\tevtDisp: any;\r\n\tprivate _record: any[] = [];\r\n\tconstructor(e: THREE.EventDispatcher)\r\n\t{\r\n\t\tthis.evtDisp = e;\r\n\t}\r\n\r\n\tadd(name: string, func: (e: any) => void, arg0?, arg1?)\r\n\t{\r\n\t\tthis.evtDisp.addEventListener(name, func, arg0, arg1);\r\n\t\tthis._record.push([name, func, arg0, arg1]);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tfor (var arr of this._record)\r\n\t\t{\r\n\t\t\tthis.evtDisp.removeEventListener(arr[0], arr[1], arr[2], arr[3]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function WrapEventDispatcher(e)\r\n{\r\n\treturn new EventDispatcherHelper(e);\r\n}","import { WrapEventDispatcher } from '../util/EventDispatcherHelper'\r\n\r\nconst AXIS = {\r\n\t'X': new THREE.Vector3(1, 0, 0),\r\n\t'Y': new THREE.Vector3(0, 1, 0),\r\n\t'Z': new THREE.Vector3(0, 0, 1),\r\n}\r\ntype PlaneType = 'X' | 'Y' | 'Z' | 'XY' | 'YZ' | 'XZ';\r\nexport class PlaneDragControl extends THREE.EventDispatcher\r\n{\r\n\tprivate camera: THREE.Camera;\r\n\tprivate domElement: HTMLElement;\r\n\tprivate scene: THREE.Scene;\r\n\r\n\tprivate object: THREE.Object3D | null;\r\n\tprivate gizmos: THREE.Object3D;\r\n\tprivate gridPlane: THREE.GridHelper;\r\n\r\n\tprivate toDispose: { dispose: Function }[] = [];\r\n\tprivate eventHelper;\r\n\r\n\tprivate plane: string;\r\n\r\n\tprivate _rayCaster: THREE.Raycaster = new THREE.Raycaster();\r\n\tprivate _mouse: THREE.Vector2 = new THREE.Vector2;\r\n\tprivate _castPlane: THREE.Plane = new THREE.Plane();\r\n\tprivate _hoving = false;\r\n\tprivate _draging = false;\r\n\r\n\tprivate _previousPosition = new THREE.Vector3();\r\n\tprivate _currentPosition = new THREE.Vector3();\r\n\tconstructor(scene: THREE.Scene, camera: THREE.Camera, domElement: HTMLElement)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.scene = scene;\r\n\t\tthis.camera = camera;\r\n\t\tthis.domElement = domElement;\r\n\t\tthis.eventHelper = WrapEventDispatcher(domElement)\r\n\t\t\t.add('mousedown', e => this._onMouseDown(e), false)\r\n\t\t\t.add('mouseup', e => this._onMouseUp(e), false)\r\n\t\t\t.add('mousemove', e => this._onMouseMove(e), false)\r\n\t\t\t.add('mouseleave', e => this._onMouseLeave(e), false)\r\n\t\t\t.add('touchstart', e => this._onMouseDown(e), false)\r\n\t\t\t.add('touchmove', e => this._onMouseMove(e))\r\n\t\t\t.add('touchend', e => this._onMouseUp(e));\r\n\r\n\t\t//gizmos\r\n\t\tvar geom = new THREE.PlaneBufferGeometry(1, 1);\r\n\t\tvar mat = new THREE.MeshBasicMaterial({\r\n\t\t\tcolor: 0xffff00,\r\n\t\t\topacity: 0.2,\r\n\t\t\ttransparent: true,\r\n\t\t\tside: THREE.DoubleSide,\r\n\t\t\tpolygonOffset: true,\r\n\t\t\tpolygonOffsetFactor: 1.0,\r\n\t\t\tpolygonOffsetUnits: 1.0\r\n\t\t});\r\n\t\tthis.gizmos = new THREE.Mesh(geom, mat);\r\n\t\tthis.toDispose.push(geom, mat);\r\n\t\tthis.scene.add(this.gizmos);\r\n\t\tthis.gizmos.visible = false;\r\n\r\n\t\tthis.gridPlane = new THREE.GridHelper(10, 30, new THREE.Color('blue'), new THREE.Color('lightblue'));\r\n\t\tthis.scene.add(this.gridPlane);\r\n\t\tthis.gridPlane.visible = false;\r\n\t\tthis.gridPlane.material.transparent = true;\r\n\t\tthis.gridPlane.material.opacity = 0.4;\r\n\t\tthis.setPlane('Z');\r\n\t\tthis.setScale(50.0);\r\n\t\tthis.updateGizmos();\r\n\t}\r\n\r\n\tsetPlane(s: PlaneType)\r\n\t{\r\n\t\tvar d90 = Math.PI * 0.5;\r\n\t\tif (s === 'X' || s === 'YZ')\r\n\t\t{\r\n\t\t\tthis.gizmos.rotation.set(0, d90, 0);\r\n\t\t\tthis.gridPlane.rotation.set(0, 0, d90);\r\n\t\t}\r\n\t\telse if (s === 'Y' || s === 'XZ')\r\n\t\t{\r\n\t\t\tthis.gizmos.rotation.set(d90, 0, 0);\r\n\t\t\tthis.gridPlane.rotation.set(0, 0, 0);\r\n\t\t}\r\n\t\telse if (s === 'Z' || s === 'XY')\r\n\t\t{\r\n\t\t\tthis.gizmos.rotation.set(0, 0, 0);\r\n\t\t\tthis.gridPlane.rotation.set(d90, 0, 0);\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn;\r\n\t\t//this.gridPlane.rotation.copy(this.gizmos.rotation);\r\n\t\tthis.plane = s;\r\n\t}\r\n\r\n\t//some events\r\n\t_prepareMouse(event: MouseEvent)\r\n\t{\r\n\t\tvar rect = this.domElement.getBoundingClientRect();\r\n\r\n\t\tthis._mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n\t\tthis._mouse.y = - ((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n\t\tthis._rayCaster.setFromCamera(this._mouse, this.camera);\r\n\t}\r\n\tprivate _TestCastPlane(target: THREE.Vector3): THREE.Vector3 | null\r\n\t{\r\n\t\tif (this._rayCaster.ray.intersectPlane(this._castPlane, target))\r\n\t\t\treturn target;\r\n\t\tthis._castPlane.normal.negate();\r\n\t\tif (this._rayCaster.ray.intersectPlane(this._castPlane, target))\r\n\t\t\treturn target;\r\n\t\treturn null;\r\n\t}\r\n\tpublic triggerDrag(e: MouseEvent)\r\n\t{\r\n\t\tthis._onMouseDown(e, true);\r\n\t}\r\n\tprivate _onMouseDown(e: MouseEvent, force?)\r\n\t{\r\n\t\tif (!this.object) return;\r\n\t\tthis._prepareMouse(e);\r\n\r\n\t\tif (!this._draging)\r\n\t\t{\r\n\t\t\tvar intersects = this._rayCaster.intersectObject(this.gizmos, true);\r\n\t\t\tthis._hoving = intersects.length > 0;\r\n\t\t\tif (force && !this._hoving)\r\n\t\t\t{\r\n\t\t\t\tthis._hoving = true;\r\n\t\t\t\tthis.updateGizmos();\r\n\t\t\t}\r\n\t\t\t//here, start draging\r\n\t\t\tif (this._hoving || force)\r\n\t\t\t{\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tthis._draging = true;\r\n\t\t\t\tthis.gridPlane.visible = true;\r\n\t\t\t\tthis.gridPlane.position.copy(this.object.position);\r\n\t\t\t\t//prepare plane\r\n\t\t\t\tthis._castPlane.setFromNormalAndCoplanarPoint(AXIS[this.plane], this.object.position);\r\n\r\n\t\t\t\tif (!this._TestCastPlane(this._previousPosition))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._previousPosition.copy(this.object.position);\r\n\t\t\t\t}\r\n\t\t\t\tthis.dispatchEvent({ type: 'mouseDown' });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onMouseUp(e: MouseEvent)\r\n\t{\r\n\t\tif (this._draging)\r\n\t\t{\r\n\t\t\tif (e) e.preventDefault();\r\n\t\t\t//e.stopPropagation();\r\n\t\t\tthis._draging = false;\r\n\t\t\tthis.gridPlane.visible = false;\r\n\t\t\tif (this.object)\r\n\t\t\t{\r\n\t\t\t\tthis.dispatchEvent({ type: 'mouseUp' });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onMouseMove(e: MouseEvent)\r\n\t{\r\n\t\tif (!this.object) return;\r\n\t\te.preventDefault();\r\n\t\tthis._prepareMouse(e);\r\n\t\tif (this._draging)\r\n\t\t{\r\n\t\t\te.stopPropagation();\r\n\t\t\tif (this._TestCastPlane(this._currentPosition))\r\n\t\t\t{\r\n\t\t\t\tvar x = this._currentPosition.x - this._previousPosition.x;\r\n\t\t\t\tvar y = this._currentPosition.y - this._previousPosition.y;\r\n\t\t\t\tvar z = this._currentPosition.z - this._previousPosition.z;\r\n\t\t\t\tif (this.plane === 'X') x = 0;\r\n\t\t\t\telse if (this.plane === 'Y') y = 0;\r\n\t\t\t\telse if (this.plane === 'Z') z = 0;\r\n\t\t\t\tthis.object.position.add(new THREE.Vector3(x, y, z));\r\n\t\t\t\tthis._previousPosition.copy(this._currentPosition);\r\n\t\t\t\tthis.dispatchEvent({ type: 'objectChange' });\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//check hover\r\n\t\t\tvar intersects = this._rayCaster.intersectObject(this.gizmos, true);\r\n\t\t\tthis._hoving = intersects.length > 0;\r\n\r\n\t\t}\r\n\t\tthis.updateGizmos();\r\n\t}\r\n\r\n\tprivate _onMouseLeave(e: MouseEvent)\r\n\t{\r\n\t\tthis._onMouseUp(e);\r\n\t}\r\n\r\n\tattachObject(obj: THREE.Object3D)\r\n\t{\r\n\t\tif (obj === this.object)\r\n\t\t{\r\n\t\t\tthis.updateGizmos();\r\n\t\t\tif (this._draging)\r\n\t\t\t{\r\n\t\t\t\t//todo:....\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.object)\r\n\t\t{\r\n\t\t\tthis.detachObject();\r\n\t\t}\r\n\t\tthis.object = obj;\r\n\t\tthis.updateGizmos();\r\n\t}\r\n\r\n\tdetachObject()\r\n\t{\r\n\t\tif (this.object)\r\n\t\t{\r\n\t\t\tthis.object = null;\r\n\t\t\tif (this._hoving) this._hoving = false;\r\n\t\t\tif (this._draging) this._draging = false;\r\n\t\t\tthis.gridPlane.visible = false;\r\n\t\t\tthis.updateGizmos();\r\n\t\t}\r\n\t}\r\n\r\n\tsetScale(val: number)\r\n\t{\r\n\t\tthis.gizmos.scale.setScalar(val);\r\n\t\tthis.gridPlane.scale.setScalar(val);\r\n\t}\r\n\tprivate updateGizmos()\r\n\t{\r\n\t\tif (this.object)\r\n\t\t{\r\n\t\t\tthis.gizmos.visible = true;\r\n\t\t\tvar m = (this.gizmos as THREE.Mesh).material as THREE.Material;\r\n\t\t\tm.opacity = this._hoving ? 0.9 : 0.2;\r\n\t\t\tif (this.object)\r\n\t\t\t{\r\n\t\t\t\tthis.gizmos.position.copy(this.object.position);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.gizmos.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tfor (var x of this.toDispose)\r\n\t\t{\r\n\t\t\tx.dispose();\r\n\t\t}\r\n\t\tthis.toDispose.length = 0;\r\n\t\tthis.scene.remove(this.gizmos);\r\n\t\tthis.scene.remove(this.gridPlane);\r\n\t\tthis.eventHelper.dispose();\r\n\t}\r\n}","import { Application } from './Application'\r\nimport { ControlPoint } from './ControlPoint'\r\nimport { PlaneDragControl } from './control/PlaneDragControl'\r\nimport { CurveObject } from './CurveObject'\r\ntype CONTROL_POSITION_MODE = 'last' | 'center';\r\nexport class ControlPointSelection\r\n{\r\n\r\n\ttransformControl: THREE.TransformControls;\r\n\tdragControl: PlaneDragControl;\r\n\t/**选中的控制点 */\r\n\tselections: ControlPoint[] = [];\r\n\tprivate controlMode: string = 'drag';\r\n\tprivate dummy: THREE.Object3D = new THREE.Object3D;\r\n\tprivate lastPosition: THREE.Vector3 = new THREE.Vector3();\r\n\tprivate lastRotation: THREE.Quaternion = new THREE.Quaternion();\r\n\tprivate app: Application;\r\n\t//private gui: dat.GUI;\r\n\tprivate changedDuringMouseDown = false;\r\n\t/**选中的曲线 */\r\n\tget selectionCurves(): CurveObject[]\r\n\t{\r\n\t\tvar arr: any[] = [];\r\n\t\tfor (var cp of this.selections)\r\n\t\t{\r\n\t\t\tif (arr.indexOf(cp.curve) < 0) arr.push(cp.curve);\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tget onlyOneSelectedCurve(): CurveObject | null\r\n\t{\r\n\t\tif (this.selections.length === 0)\r\n\t\t\treturn null;\r\n\t\tvar curve = this.selections[0].curve;\r\n\t\tfor (var cp of this.selections)\r\n\t\t{\r\n\t\t\tif (cp.curve !== curve)\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t\treturn curve;\r\n\t}\r\n\r\n\tconstructor(app: Application)\r\n\t{\r\n\t\tthis.app = app;\r\n\t\tthis.transformControl = new THREE.TransformControls(app.camera, app.domElement);\r\n\t\tapp.scene.add(this.transformControl);\r\n\t\tapp.scene.add(this.dummy);\r\n\r\n\t\tthis.transformControl.visible = false;\r\n\t\tthis.transformControl.setSpace('world');\r\n\t\tthis.transformControl.addEventListener('objectChange', e => this.onChange());\r\n\t\tthis.transformControl.addEventListener('mouseDown', e => this.onTransformControlMouseDown());\r\n\t\tthis.transformControl.addEventListener('mouseUp', e => this.onTransformControlMouseUp());\r\n\t\twindow.addEventListener('keydown', e => this.onKeyDown(e));\r\n\r\n\t\tthis.dragControl = new PlaneDragControl(app.scene, app.camera, app.domElement);\r\n\t\tthis.dragControl.addEventListener('objectChange', e => this.onChange());\r\n\t\tthis.dragControl.addEventListener('mouseDown', e => this.onTransformControlMouseDown());\r\n\t\tthis.dragControl.addEventListener('mouseUp', e => this.onTransformControlMouseUp());\r\n\t}\r\n\t//#region all command\r\n\tcmd_isAllowRemovePoints()\r\n\t{\r\n\t\tif (this.selectionCurves.length === 1)\r\n\t\t{\r\n\t\t\treturn this.selectionCurves[0].allowOperator({\r\n\t\t\t\ttype: 'removePoints',\r\n\t\t\t\tpoints: this.selections.map(cp => cp.index)\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcmd_applyRemovePoints()\r\n\t{\r\n\t\tif (this.selectionCurves.length === 1)\r\n\t\t{\r\n\t\t\tvar op = {\r\n\t\t\t\ttype: 'removePoints',\r\n\t\t\t\tpoints: this.selections.map(cp => cp.index)\r\n\t\t\t};\r\n\t\t\tapp.recordCurveModify(this.selectionCurves[0]);\r\n\t\t\tthis.selectionCurves[0].applyOperator(op);\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcmd_isAllowSplit()\r\n\t{\r\n\t\tif (this.selectionCurves.length === 1)\r\n\t\t{\r\n\t\t\tvar op = {\r\n\t\t\t\ttype: 'splitBetween',\r\n\t\t\t\tpoints: this.selections.map(cp => cp.index)\r\n\t\t\t};\r\n\t\t\treturn this.selectionCurves[0].allowOperator(op);\r\n\t\t}\r\n\t}\r\n\r\n\tcmd_applySplit()\r\n\t{\r\n\t\tif (this.selectionCurves.length === 1)\r\n\t\t{\r\n\t\t\tvar op = {\r\n\t\t\t\ttype: 'splitBetween',\r\n\t\t\t\tpoints: this.selections.map(cp => cp.index)\r\n\t\t\t};\r\n\t\t\tapp.recordCurveModify(this.selectionCurves[0]);\r\n\t\t\tthis.selectionCurves[0].applyOperator(op);\r\n\t\t}\r\n\t}\r\n\r\n\t//选中整条曲线\r\n\tcmd_isAllowSelectAll()\r\n\t{\r\n\t\treturn !!this.onlyOneSelectedCurve;\r\n\t}\r\n\r\n\tcmd_selectAll()\r\n\t{\r\n\r\n\t\tvar curve = this.onlyOneSelectedCurve;\r\n\t\tif (curve)\r\n\t\t{\r\n\t\t\tvar last = this.selections[this.selections.length - 1];\r\n\t\t\tfor (var cp of curve.controlPoints)\r\n\t\t\t{\r\n\t\t\t\tif (this.selections.indexOf(cp) < 0)\r\n\t\t\t\t\tthis.add(cp);\r\n\t\t\t}\r\n\t\t\tthis.add(last);\r\n\t\t}\r\n\t}\r\n\r\n\tcmd_isAllowRemoveCurve()\r\n\t{\r\n\t\treturn !!this.onlyOneSelectedCurve;\r\n\t}\r\n\tcmd_removeCurve()\r\n\t{\r\n\t\tvar curve = this.onlyOneSelectedCurve\r\n\t\tif (curve)\r\n\t\t{\r\n\t\t\tapp.recordRemoveCurve(curve);\r\n\t\t\tapp.removeCurve(curve);\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t}\r\n\t//#endregion\r\n\r\n\tprivate _resetControl()\r\n\t{\r\n\t\tif (this.selections.length === 0)\r\n\t\t{\r\n\t\t\tthis.transformControl.visible = false;\r\n\t\t\tthis.transformControl.detach();\r\n\t\t\tthis.dragControl.detachObject();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar last = this.selections[this.selections.length - 1];\r\n\t\t\tthis.dummy.position.copy(last.mesh.position);\r\n\t\t\tif (this.selections.length == 1)\r\n\t\t\t{\r\n\t\t\t\tthis.dummy.quaternion.copy(last.mesh.quaternion);\r\n\t\t\t}\r\n\t\t\tthis.lastPosition.copy(this.dummy.position);\r\n\t\t\tthis.lastRotation.copy(this.dummy.quaternion);\r\n\t\t\tif (this.controlMode === 'translate')\r\n\t\t\t{\r\n\t\t\t\tthis.dragControl.detachObject();\r\n\t\t\t\tthis.transformControl.visible = true;\r\n\t\t\t\tthis.transformControl.attach(this.dummy);\r\n\r\n\t\t\t}\r\n\t\t\telse if (this.controlMode === 'drag')\r\n\t\t\t{\r\n\t\t\t\t//clear transform\r\n\t\t\t\tthis.transformControl.visible = false;\r\n\t\t\t\tthis.transformControl.detach();\r\n\t\t\t\tthis.dragControl.attachObject(this.dummy);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.transformControl.visible = false;\r\n\t\t\t\tthis.transformControl.detach();\r\n\t\t\t\tthis.dragControl.detachObject();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tisIntersectControl(e)\r\n\t{\r\n\t\tif (!this.transformControl.visible) return false;\r\n\t\treturn this.transformControl['axis'] != null;\r\n\t}\r\n\ttryTriggerDrag(e: MouseEvent)\r\n\t{\r\n\t\tif (this.selections.length === 1 && this.controlMode === 'drag')\r\n\t\t{\r\n\t\t\tthis.dragControl.triggerDrag(e);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tadd(pt: ControlPoint)\r\n\t{\r\n\t\tvar pos = this.selections.indexOf(pt);\r\n\t\tif (pos < 0)\r\n\t\t{\r\n\t\t\tthis.selections.push(pt);\r\n\t\t\tpt.selected = true;\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\telse if (pos != this.selections.length - 1)\r\n\t\t{\r\n\t\t\tthis.selections.splice(pos, 1);\r\n\t\t\tthis.selections.push(pt);\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\t//this.gui.updateDisplay();\r\n\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tremove(pt: ControlPoint)\r\n\t{\r\n\t\tvar pos = this.selections.indexOf(pt);\r\n\t\tif (pos >= 0)\r\n\t\t{\r\n\t\t\tthis.selections.splice(pos, 1);\r\n\t\t\tpt.selected = false;\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\t//this.gui.updateDisplay();\r\n\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tisInSelection(pt: ControlPoint)\r\n\t{\r\n\t\treturn this.selections.indexOf(pt) >= 0;\r\n\t}\r\n\r\n\ttoggle(pt: ControlPoint)\r\n\t{\r\n\t\tif (this.isInSelection(pt))\r\n\t\t\tthis.remove(pt);\r\n\t\telse\r\n\t\t\tthis.add(pt);\r\n\t}\r\n\r\n\tclear()\r\n\t{\r\n\t\tif (this.selections.length > 0)\r\n\t\t{\r\n\t\t\tfor (var cp of this.selections)\r\n\t\t\t{\r\n\t\t\t\tcp.selected = false;\r\n\t\t\t}\r\n\t\t\tthis.selections.length = 0;\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\t//this.gui.updateDisplay();\r\n\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tonChange()\r\n\t{\r\n\t\tif (this.controlMode === 'translate' || this.controlMode === 'drag')\r\n\t\t{\r\n\t\t\t//if (this.transformControl.getMode() === 'translate')\r\n\t\t\t{\r\n\t\t\t\tvar offset = this.dummy.position.clone().sub(this.lastPosition);\r\n\t\t\t\tthis.lastPosition.copy(this.dummy.position);\r\n\t\t\t\tvar curveToUpdate: CurveObject[] = [];\r\n\t\t\t\tvar hasmove = false;\r\n\t\t\t\tfor (var cp of this.selections)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (cp.allowTranslation)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcp.curve.applyMoveByOffset(cp.index, offset);\r\n\t\t\t\t\t\thasmove = true;\r\n\t\t\t\t\t\tif (curveToUpdate.indexOf(cp.curve) < 0)\r\n\t\t\t\t\t\t\tcurveToUpdate.push(cp.curve);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (var cv of curveToUpdate)\r\n\t\t\t\t{\r\n\t\t\t\t\tcv.update();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.selections.length === 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.dummy.quaternion.copy(this.selections[0].mesh.quaternion);\r\n\t\t\t\t}\r\n\t\t\t\tif (hasmove)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.changedDuringMouseDown = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar last = this.selections[this.selections.length - 1];\r\n\t\t\t\t\tif (last)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.dummy.position.copy(last.mesh.position);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tonKeyDown(e: KeyboardEvent)\r\n\t{\r\n\t\tif (e.key === 'w')\r\n\t\t{\r\n\t\t\tthis.controlMode = 'translate';\r\n\t\t\tthis.transformControl.setMode('translate');\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\telse if (e.key === 'e')\r\n\t\t{\r\n\t\t\tthis.controlMode = 'drag';\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\telse if (e.key === 'q')\r\n\t\t{\r\n\t\t\tthis.controlMode = '';\r\n\t\t\tthis._resetControl();\r\n\t\t}\r\n\t\telse if (e.key === 'Escape')\r\n\t\t{\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t}\r\n\trefreshSelection()\r\n\t{\r\n\t\tfor (var i = 0; i < this.selections.length; ++i)\r\n\t\t{\r\n\t\t\tvar cp = this.selections[i];\r\n\t\t\tif (cp.curve.controlPoints.indexOf(cp) < 0 || app.curves.indexOf(cp.curve) < 0)\r\n\t\t\t{\r\n\t\t\t\tthis.selections.splice(i, 1);\r\n\t\t\t\t--i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._resetControl();\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tvar changed = false;\r\n\t\tfor (var cp of this.selectionCurves)\r\n\t\t{\r\n\t\t\tif (cp.dirtyForSelection)\r\n\t\t\t{\r\n\t\t\t\tcp.dirtyForSelection = false;\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t{\r\n\t\t\tthis._resetControl();\r\n\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t}\r\n\t\tthis.transformControl.update();\r\n\t}\r\n\r\n\r\n\tonTransformControlMouseDown()\r\n\t{\r\n\t\tvar cc: any[] = [];\r\n\t\tfor (var cp of this.selections)\r\n\t\t{\r\n\t\t\tif (cc.indexOf(cp.curve) < 0 && cp.allowTranslation)\r\n\t\t\t\tcc.push(cp.curve);\r\n\t\t}\r\n\t\tif (cc.length > 0)\r\n\t\t{\r\n\t\t\tapp.recordCurveModify(cc);\r\n\t\t}\r\n\t\tthis.changedDuringMouseDown = false;\r\n\t}\r\n\r\n\tonTransformControlMouseUp()\r\n\t{\r\n\t\tif (!this.changedDuringMouseDown)\r\n\t\t{\r\n\t\t\tapp.removeRecord();\r\n\t\t}\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tthis.transformControl.parent.remove(this.transformControl);\r\n\t\tthis.dummy.parent.remove(this.dummy);\r\n\t}\r\n}\r\n","import { CurveObject } from './CurveObject'\r\n\r\n\r\nclass AnimationSession\r\n{\r\n\tbox: THREE.Object3D;\r\n\tcurve: CurveObject;\r\n\tprivate _clip: THREE.AnimationClip | null = null;\r\n\tprivate _mixer: THREE.AnimationMixer | null = null;\r\n\tprivate _action: THREE.AnimationAction | null = null;\r\n\tconstructor(box: THREE.Object3D, curve: CurveObject)\r\n\t{\r\n\t\tthis.box = box.clone(true);\r\n\t\tthis.curve = curve;\r\n\t\tthis.updateAnimation(curve);\r\n\t}\r\n\r\n\tget duration()\r\n\t{\r\n\t\tif (this.curve.dirtyForAnimation)\r\n\t\t{\r\n\t\t\tthis.curve.dirtyForAnimation = false;\r\n\t\t\tthis.updateAnimation(this.curve);\r\n\t\t}\r\n\t\tif (this._clip) return this._clip.duration;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tupdateAnimation(curve: CurveObject)\r\n\t{\r\n\t\tvar clip = this._clip = curve.generateAnimationClip();\r\n\t\tvar mixer = this._mixer = new THREE.AnimationMixer(this.box);\r\n\t\tvar action = this._action = mixer.clipAction(clip);\r\n\t\taction.play();\r\n\t}\r\n\r\n\tupdateAt(time: number)\r\n\t{\r\n\t\tif (this.curve.dirtyForAnimation)\r\n\t\t{\r\n\t\t\tthis.curve.dirtyForAnimation = false;\r\n\t\t\tthis.updateAnimation(this.curve);\r\n\t\t}\r\n\t\tthis._mixer!.time = time;\r\n\t\tthis._action!.time = time;\r\n\t\tthis._mixer!.update(0);\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tif (this.box && this.box.parent)\r\n\t\t{\r\n\t\t\tthis.box.parent.remove(this.box);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class AnimationPreviewControl\r\n{\r\n\tprivate _previewObject: THREE.Object3D | null;\r\n\tprivate _time = 0;\r\n\tprivate _playing = false;\r\n\tprivate _timeScale = 1;\r\n\tprivate _sessions: AnimationSession[] = [];\r\n\tconstructor()\r\n\t{\r\n\t\tthis._createPreviewObject();\r\n\r\n\t}\r\n\tget isPlaying()\r\n\t{\r\n\t\treturn this._playing;\r\n\t}\r\n\tget timeScale() { return this._timeScale; }\r\n\tset timeScale(val) { this._timeScale = val; }\r\n\r\n\tplay()\r\n\t{\r\n\t\tthis.stop();\r\n\r\n\t\tvar curves = app.curves.filter(x => x.visible);\r\n\t\tif (curves.length > 0)\r\n\t\t{\r\n\t\t\tfor (var cc of curves)\r\n\t\t\t{\r\n\t\t\t\tvar ss = new AnimationSession(this._previewObject!, cc);\r\n\t\t\t\tthis._time = 0;\r\n\t\t\t\tthis._playing = true;\r\n\t\t\t\tapp.scene.add(ss.box);\r\n\t\t\t\tthis._sessions.push(ss);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tstop()\r\n\t{\r\n\t\tfor (var s of this._sessions)\r\n\t\t{\r\n\t\t\ts.dispose();\r\n\t\t}\r\n\t\tthis._sessions.length = 0;\r\n\t\tthis._playing = false;\r\n\t}\r\n\r\n\r\n\r\n\r\n\tprivate _createPreviewObject(): THREE.Object3D\r\n\t{\r\n\t\tvar box = new THREE.Group();\r\n\t\tthis._previewObject = box;\r\n\t\tthis.loadExampleFish(box);\r\n\t\tconst ARROW_SCALE = 20.2;\r\n\t\t// box.add(\r\n\t\t// \tnew THREE.ArrowHelper(new THREE.Vector3(1, 0, 0), new THREE.Vector3(-1 * ARROW_SCALE, 0, 0), 2 * ARROW_SCALE, 0xff0000, 1, 2.5),\r\n\t\t// \tnew THREE.ArrowHelper(new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, -1 * ARROW_SCALE, 0), 2 * ARROW_SCALE, 0x00ff00, 1, 2.5),\r\n\t\t// \tnew THREE.ArrowHelper(new THREE.Vector3(0, 0, 1), new THREE.Vector3(0, 0, -1 * ARROW_SCALE), 2 * ARROW_SCALE, 0x0000ff, 1, 2.5),\r\n\t\t// );\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tloadExampleFish(box: THREE.Group)\r\n\t{\r\n\t\tvar loader = new THREE.OBJLoader();\r\n\t\tloader.load('res/fish.obj', (g) =>\r\n\t\t{\r\n\t\t\tfor (var mesh of g.children)\r\n\t\t\t{\r\n\t\t\t\tif (mesh instanceof THREE.Mesh)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (mesh.material && mesh.material instanceof THREE.Material) mesh.material.dispose();\r\n\t\t\t\t\tvar texture = new THREE.TextureLoader().load('res/gzy.jpg', t =>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log('load ok');\r\n\t\t\t\t\t}, undefined, e =>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconsole.log('load error,', e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tmesh.material = new THREE.MeshLambertMaterial({ color: 0xffffff, wireframe: false, map: texture });\r\n\t\t\t\t\tbox.add(mesh);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, e => { }, e =>\r\n\t\t\t{\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t})\r\n\t}\r\n\r\n\r\n\tupdate()\r\n\t{\r\n\t\tif (this._playing)\r\n\t\t{\r\n\t\t\tthis._time += app.deltaTime * this._timeScale;\r\n\t\t\tvar maxtime = 0;\r\n\t\t\tfor (var ss of this._sessions)\r\n\t\t\t{\r\n\t\t\t\tmaxtime = Math.max(maxtime, ss.duration);\r\n\t\t\t}\r\n\t\t\tif (this._time >= maxtime) this._time = 0;\r\n\t\t\tfor (var ss of this._sessions)\r\n\t\t\t{\r\n\t\t\t\tss.updateAt(this._time);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\r\n\t}\r\n}","\r\n\r\n\r\ninterface NumberBoxProps extends React.AllHTMLAttributes<any>\r\n{\r\n\tonChangeDelta?: Function;\r\n\tonChangeValue?: Function;\r\n\tonChangeStart?: Function;\r\n\tvalue?: number | string;\r\n\tstep?: number;\r\n\tmin?: number;\r\n\tmax?: number;\r\n}\r\n\r\nfunction formatNumber(n)\r\n{\r\n\tif (typeof n === 'number')\r\n\t{\r\n\t\tif (isNaN(n)) return 'NaN';\r\n\t\treturn (Math.round(n * 100) / 100).toString();\r\n\t}\r\n\treturn n ? n.toString() : '';\r\n}\r\n\r\n\r\nexport class NumberBox extends React.Component<NumberBoxProps, any>\r\n{\r\n\tprivate dispose: Function | null;\r\n\tprivate isCancel: boolean = false;\r\n\tprivate isDraging = false;\r\n\tprivate min = Number.NEGATIVE_INFINITY;\r\n\tprivate max = Number.POSITIVE_INFINITY;\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = { focus: false, draging: false, input: null };\r\n\t\tif (typeof props.min === 'number') this.min = props.min;\r\n\t\tif (typeof props.max === 'number') this.max = props.max;\r\n\t}\r\n\r\n\tcomponentDidMount()\r\n\t{\r\n\r\n\t}\r\n\r\n\tcomponentWillUnmount()\r\n\t{\r\n\t\t//console.log('numberbox unmount')\r\n\t\tif (this.dispose)\r\n\t\t{\r\n\t\t\tthis.dispose();\r\n\t\t\tthis.dispose = null;\r\n\t\t}\r\n\t}\r\n\r\n\tonChange(e)\r\n\t{\r\n\t\t// var value = parseFloat(e.target.value);\r\n\t\t// if (e.target.value === '') value = 0;\r\n\t\t// if (isNaN(value))\r\n\t\t// {\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\tif (this.state.focus && !this.state.draging)\r\n\t\t{\r\n\t\t\tthis.setState({ input: e.target.value });\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseDown(e: React.MouseEvent<any>)\r\n\t{\r\n\t\tif (this.dispose)\r\n\t\t{\r\n\t\t\tthis.dispose();\r\n\t\t\tthis.dispose = null;\r\n\t\t}\r\n\r\n\t\tif (this.props.disabled) return;\r\n\t\tvar startX = e.screenX;\r\n\t\tvar lastY = e.screenY;\r\n\t\tvar firstDelta = true;\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tfunction onMouseUp(e)\r\n\t\t{\r\n\t\t\tself.dispose && self.dispose();\r\n\t\t\tself.dispose = null;\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove(e: MouseEvent)\r\n\t\t{\r\n\t\t\tvar delta = lastY - e.screenY;\r\n\t\t\t//console.log('move delta', delta);\r\n\t\t\t//e.preventDefault();\r\n\t\t\t//e.stopPropagation();\r\n\t\t\tvar xdelta = Math.abs(e.screenX - startX);\r\n\r\n\t\t\tif (firstDelta)\r\n\t\t\t{\r\n\t\t\t\tif (Math.abs(delta) > 20 && xdelta < Math.abs(delta))\r\n\t\t\t\t{\r\n\t\t\t\t\tfirstDelta = false;\r\n\t\t\t\t\tlastY = e.screenY;\r\n\t\t\t\t\tself.props.onChangeStart && self.props.onChangeStart!();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlastY = e.screenY;\r\n\t\t\tdelta = -e.movementY;\r\n\r\n\t\t\tif (delta !== 0)\r\n\t\t\t{\r\n\t\t\t\tdelta *= self.props.step || 0.1;\r\n\t\t\t\tif (self.props.onChangeDelta)\r\n\t\t\t\t{\r\n\t\t\t\t\tself.props.onChangeDelta(delta);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar value: number = parseFloat(self.state.input) || parseFloat(self.props.value as string) || 0;\r\n\t\t\t\t\tvalue += delta;\r\n\t\t\t\t\tif (value > self.max) value = self.max;\r\n\t\t\t\t\tif (value < self.min) value = self.min;\r\n\t\t\t\t\tself.setState({ input: value.toString() });\r\n\t\t\t\t\tself.props.onChangeValue && self.props.onChangeValue(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log('down start')\r\n\t\tconst capture = false;\r\n\t\twindow.addEventListener('mouseup', onMouseUp, capture);\r\n\t\twindow.addEventListener('mousemove', onMouseMove, capture);\r\n\t\tthis.isDraging = true;\r\n\t\tthis.setState({ draging: true });\r\n\t\tthis.dispose = function ()\r\n\t\t{\r\n\t\t\twindow.removeEventListener('mouseup', onMouseUp, capture);\r\n\t\t\twindow.removeEventListener('mousemove', onMouseMove, capture);\r\n\t\t\tthis.isDraging = false;\r\n\t\t\tdocument.exitPointerLock();\r\n\t\t\tthis.setState({ draging: false });\r\n\t\t}\r\n\t}\r\n\r\n\tonBlur(e)\r\n\t{\r\n\t\tthis.setState({ focus: false, input: null });\r\n\t\tif (this.isCancel)\r\n\t\t{\r\n\t\t\tthis.isCancel = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.state.input)\r\n\t\t{\r\n\t\t\tvar value = parseFloat(this.state.input);\r\n\t\t\tif (!isNaN(value))\r\n\t\t\t{\r\n\t\t\t\tif (value > this.max) value = this.max;\r\n\t\t\t\tif (value < this.min) value = this.min;\r\n\t\t\t\tthis.props.onChangeValue && this.props.onChangeValue(value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonFocus(e)\r\n\t{\r\n\t\tthis.setState({ focus: true });\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tvar self = this;\r\n\t\tfunction onKeyDown(e: React.KeyboardEvent<any>)\r\n\t\t{\r\n\t\t\tif (e.key === 'Enter' || e.key === 'Escape')\r\n\t\t\t{\r\n\t\t\t\tself.isCancel = e.key === 'Escape';\r\n\t\t\t\te.currentTarget.blur();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar props = { ...this.props };\r\n\t\tdelete props.onChangeDelta;\r\n\t\tdelete props.onChangeValue;\r\n\t\tdelete props.onChangeStart;\r\n\r\n\t\tvar showValue = formatNumber(this.props.value);\r\n\t\tif (this.state.focus && !this.state.draging && this.state.input)\r\n\t\t{\r\n\t\t\tshowValue = this.state.input;\r\n\t\t}\r\n\r\n\t\treturn <input onDragStart={e => e.preventDefault()} draggable={false} type='text' onKeyDown={onKeyDown} onBlur={e => this.onBlur(e)} onChange={e => this.onChange(e)} onFocus={e => this.onFocus(e)}\r\n\t\t\tonMouseDown={e => this.onMouseDown(e)} {...props} value={showValue} />\r\n\t}\r\n}","import { ControlPoint } from '../../ControlPoint'\r\nimport { CurveObject } from '../../CurveObject'\r\nimport { NumberBox } from './NumberBox'\r\nexport class ControlPointEditor extends React.Component\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tvar selections = app.selection.selections;\r\n\t\tvar curves = app.selection.selectionCurves;\r\n\t\tif (selections.length === 0)\r\n\t\t{\r\n\t\t\treturn <div className='ControlPointEditor'>no selections</div>;\r\n\t\t}\r\n\t\tvar self = this;\r\n\t\tvar alldisabled = selections.every(x => !x.allowTranslation);\r\n\t\tfunction AxisEditor(key)\r\n\t\t{\r\n\t\t\tvar firstPoint = selections[0].point;\r\n\t\t\tvar allsame = selections.reduce((pv, cv) =>\r\n\t\t\t{\r\n\t\t\t\treturn pv && cv.point[key] === firstPoint[key];\r\n\t\t\t}, true);\r\n\t\t\tfunction onChangeValue(val)\r\n\t\t\t{\r\n\t\t\t\tapp.recordCurveModify(app.selection.selectionCurves);\r\n\t\t\t\tselections.forEach(cp =>\r\n\t\t\t\t{\r\n\t\t\t\t\tvar pt = cp.point.clone();\r\n\t\t\t\t\tpt[key] = val;\r\n\t\t\t\t\tcp.curve.applyMoveToPoint(cp.index, pt);\r\n\t\t\t\t});\r\n\t\t\t\t//app.selection.refreshSelection();\r\n\t\t\t\t//self.forceUpdate();\r\n\t\t\t}\r\n\r\n\t\t\tfunction onChangeDelta(val)\r\n\t\t\t{\r\n\t\t\t\tselections.forEach(cp =>\r\n\t\t\t\t{\r\n\t\t\t\t\t//cp.point[key] += val;\r\n\t\t\t\t\t//cp.setPointDirty();\r\n\t\t\t\t\tvar pt = new THREE.Vector3();\r\n\t\t\t\t\tpt[key] = val;\r\n\t\t\t\t\tcp.curve.applyMoveByOffset(cp.index, pt);\r\n\t\t\t\t});\r\n\t\t\t\t//app.selection.refreshSelection();\r\n\t\t\t\t//self.forceUpdate();\r\n\t\t\t}\r\n\t\t\tfunction onChangeStart()\r\n\t\t\t{\r\n\t\t\t\tapp.recordCurveModify(app.selection.selectionCurves);\r\n\t\t\t}\r\n\t\t\tvar showValue;\r\n\t\t\tif (allsame)\r\n\t\t\t{\r\n\t\t\t\tshowValue = firstPoint[key];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tshowValue = '--'\r\n\t\t\t}\r\n\r\n\t\t\treturn <span className='AxisEditor'>\r\n\t\t\t\t{key}: <NumberBox disabled={alldisabled} value={showValue} onChangeValue={onChangeValue} onChangeDelta={onChangeDelta} onChangeStart={onChangeStart} />\r\n\t\t\t</span>;\r\n\t\t};\r\n\r\n\t\tfunction RotationEditor()\r\n\t\t{\r\n\t\t\tvar firstRotation = selections[0].rotation;\r\n\t\t\tvar allsame = selections.reduce((lv, cv) => { return lv && cv.rotation === firstRotation }, true);\r\n\t\t\tvar alldisabled = selections.every(x => !x.allowRotation);\r\n\t\t\tvar showValue = allsame ? firstRotation : '--';\r\n\t\t\tfunction onChangeValue(val)\r\n\t\t\t{\r\n\t\t\t\tif (alldisabled) return;\r\n\t\t\t\tapp.recordCurveModify(app.selection.selectionCurves);\r\n\t\t\t\tfor (var cp of selections)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (cp.allowRotation)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcp.curve.applyPointRotation(cp.index, val);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tapp.selection.refreshSelection();\r\n\t\t\t\tself.forceUpdate();\r\n\t\t\t}\r\n\t\t\tfunction onChangeDelta(val)\r\n\t\t\t{\r\n\t\t\t\tif (alldisabled) return;\r\n\t\t\t\tfor (var cp of selections)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (cp.allowRotation)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//cp.rotation += val;\r\n\t\t\t\t\t\t//cp.setPointDirty();\r\n\t\t\t\t\t\tcp.curve.applyPointRotationDelta(cp.index, val);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tapp.selection.refreshSelection();\r\n\t\t\t\tself.forceUpdate();\r\n\t\t\t}\r\n\t\t\tfunction onChangeStart()\r\n\t\t\t{\r\n\t\t\t\tif (alldisabled) return;\r\n\t\t\t\tapp.recordCurveModify(app.selection.selectionCurves);\r\n\t\t\t}\r\n\t\t\treturn <span>rotation: <NumberBox disabled={alldisabled} value={showValue} step={1} onChangeValue={onChangeValue} onChangeDelta={onChangeDelta} onChangeStart={onChangeStart} /></span>\r\n\t\t}\r\n\t\tfunction RemovePointsButton()\r\n\t\t{\r\n\t\t\tvar disabled = !app.selection.cmd_isAllowRemovePoints();\r\n\t\t\tfunction onClick()\r\n\t\t\t{\r\n\t\t\t\tapp.selection.cmd_applyRemovePoints();\r\n\t\t\t\tself.forceUpdate();\r\n\t\t\t}\r\n\t\t\treturn <button disabled={disabled} onClick={onClick}>删除选中的点</button>\r\n\t\t}\r\n\r\n\t\tfunction SplitButton()\r\n\t\t{\r\n\t\t\tvar disabled = !app.selection.cmd_isAllowSplit();\r\n\t\t\tfunction onClick()\r\n\t\t\t{\r\n\t\t\t\tapp.selection.cmd_applySplit();\r\n\t\t\t}\r\n\t\t\treturn <button disabled={disabled} onClick={onClick}>分裂/插入定点</button>\r\n\t\t}\r\n\r\n\t\tvar showCurveType = '...';\r\n\t\tif (curves.length === 1)\r\n\t\t{\r\n\t\t\tshowCurveType = curves[0].curve.curveType;\r\n\t\t}\r\n\t\treturn <div className='ControlPointEditor'>\r\n\t\t\t<div style={{ fontSize: '12px', whiteSpace: 'nowrap' }}>选中了 <Highlight>{selections.length}</Highlight> 个控制点(第{selections.length === 1 ? selections[0].index : '...'}个)</div>\r\n\t\t\t<div style={{ fontSize: '12px', whiteSpace: 'nowrap' }}>选中了 <Highlight>{curves.length}</Highlight> 条曲线(<Highlight>{showCurveType}</Highlight>)</div>\r\n\t\t\t<div>{AxisEditor('x')}{AxisEditor('y')}{AxisEditor('z')}</div>\r\n\t\t\t<div>{RotationEditor()}</div>\r\n\t\t\t<div>{RemovePointsButton()} {SplitButton()}</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nfunction Highlight(props)\r\n{\r\n\treturn <span style={{ color: 'lightgreen' }}>{props.children}</span>\r\n}","import { NumberBox } from './NumberBox'\r\nvar FORMS: any = {\r\n\t'box': {\r\n\t\t_name: '方块',\r\n\t\tkind: 'box',\r\n\t\twidth: 300,\r\n\t\theight: 300,\r\n\t\txcount: 5,\r\n\t\tycount: 5,\r\n\t\tup: { x: 0, y: 1, z: 0 },\r\n\t\tright: { x: 0, y: 0, z: -1 },\r\n\t},\r\n\t'circle': {\r\n\t\t_name: '圆',\r\n\t\tkind: 'circle',\r\n\t\tradius: 100,\r\n\t\tcount: 20,\r\n\t\tup: { x: 0, y: 1, z: 0 },\r\n\t\tright: { x: 0, y: 0, z: -1 },\r\n\t}\r\n}\r\n\r\n\r\nexport class TranslationGhostCurveEditor extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = { form: 'box' }\r\n\t}\r\n\trender()\r\n\t{\r\n\t\tfunction BindButton(props)\r\n\t\t{\r\n\t\t\t//var NullButton = <button disabled={true}>绑定</button>;\r\n\t\t\tvar sels = app.selection.selectionCurves;\r\n\r\n\t\t\tif (sels.length === 1)\r\n\t\t\t{\r\n\t\t\t\tif (sels[0].curve.curveType === 'TranslationGhostCurve' &&\r\n\t\t\t\t\t!sels[0].curve.getParameter('refCurve'))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn <div style={{ color: 'red' }}>请同时选择另一条曲线进行绑定</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (sels.length != 2) return null;\r\n\t\t\tvar [one, other] = sels;\r\n\t\t\tif (!one || one.curve.curveType !== 'TranslationGhostCurve')\r\n\t\t\t\t[one, other] = [other, one];\r\n\t\t\tif (!one || one.curve.curveType != 'TranslationGhostCurve') return null;\r\n\t\t\tif (!other || other.curve.isGhostCurve) return null;\r\n\r\n\r\n\r\n\r\n\t\t\tfunction bind()\r\n\t\t\t{\r\n\t\t\t\t// if (one.setParameter('refCurve', other.curve))\r\n\t\t\t\t// {\r\n\t\t\t\t// \tone.clearBindingCurveChange();\r\n\t\t\t\t// \tone.bindCurveChange(other);\r\n\t\t\t\t// }\r\n\t\t\t\t// else\r\n\t\t\t\t// {\r\n\t\t\t\t// \tconsole.error('bind error??');\r\n\t\t\t\t// }\r\n\t\t\t\tone.setParameter('refUUID', other.uuid);\r\n\t\t\t}\r\n\t\t\treturn <div><button onClick={bind}>绑定</button></div>;\r\n\t\t}\r\n\t\treturn <><BindButton />{this.FormEditor()}</>\r\n\t}\r\n\r\n\tFormEditor()\r\n\t{\r\n\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\tif (curve && curve.curve.curveType === 'TranslationGhostCurve')\r\n\t\t{\r\n\t\t\tvar form = FORMS[this.state.form];\r\n\t\t\tvar kindList = Object.keys(FORMS).map(key =>\r\n\t\t\t{\r\n\t\t\t\treturn <option value={key} key={key}>{FORMS[key]._name}</option>\r\n\t\t\t})\r\n\t\t\tvar panelcss: React.CSSProperties = {\r\n\t\t\t\tborder: '1px solid white'\r\n\t\t\t};\r\n\t\t\tvar onKindChange = e =>\r\n\t\t\t{\r\n\t\t\t\tthis.setState({ form: e.target.value });\r\n\t\t\t}\r\n\r\n\t\t\tfunction getOnChangeValueFunc(key)\r\n\t\t\t{\r\n\t\t\t\treturn function (val)\r\n\t\t\t\t{\r\n\t\t\t\t\tform[key] = val;\r\n\t\t\t\t\tself.setState({});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this;\r\n\t\t\tvar BoxForm = function ()\r\n\t\t\t{\r\n\r\n\t\t\t\tfunction onClick(e)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar op = {\r\n\t\t\t\t\t\ttype: 'setFormulation',\r\n\t\t\t\t\t\tkind: 'box',\r\n\t\t\t\t\t\twidth: form.width,\r\n\t\t\t\t\t\theight: form.height,\r\n\t\t\t\t\t\txcount: Math.floor(form.xcount) || 1,\r\n\t\t\t\t\t\tycount: Math.floor(form.ycount) || 1,\r\n\t\t\t\t\t\tup: form.up,\r\n\t\t\t\t\t\tright: form.right\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (curve) curve.applyOperator(op);\r\n\t\t\t\t}\r\n\t\t\t\tvar css = { width: '120px' }\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<div>宽度：<NumberBox style={css} min={10} max={1000} step={1} onChangeValue={getOnChangeValueFunc('width')} value={form.width} /></div>\r\n\t\t\t\t\t<div>高度：<NumberBox style={css} min={10} max={1000} step={1} onChangeValue={getOnChangeValueFunc('height')} value={form.height} /></div>\r\n\t\t\t\t\t<div>横向个数：<NumberBox style={css} min={1} max={20} step={1} onChangeValue={getOnChangeValueFunc('xcount')} value={form.xcount} /></div>\r\n\t\t\t\t\t<div>纵向个数：<NumberBox style={css} min={1} max={20} step={1} onChangeValue={getOnChangeValueFunc('ycount')} value={form.ycount} /></div>\r\n\t\t\t\t\t<div><button onClick={onClick}>设置</button></div>\r\n\t\t\t\t</>\r\n\t\t\t};\r\n\r\n\t\t\tvar CircleForm = function ()\r\n\t\t\t{\r\n\t\t\t\tvar css = { width: '120px' }\r\n\t\t\t\tfunction onClick(e)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar op = {\r\n\t\t\t\t\t\ttype: 'setFormulation',\r\n\t\t\t\t\t\tkind: 'circle',\r\n\t\t\t\t\t\tradius: form.radius || 0.1,\r\n\t\t\t\t\t\tcount: Math.floor(form.count) || 2,\r\n\t\t\t\t\t\tup: form.up,\r\n\t\t\t\t\t\tright: form.right\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (curve) curve.applyOperator(op);\r\n\t\t\t\t}\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<div>半径：<NumberBox style={css} min={0.1} max={1000} step={1} onChangeValue={getOnChangeValueFunc('radius')} value={form.radius} /></div>\r\n\t\t\t\t\t<div>数量：<NumberBox style={css} min={2} max={50} step={1} onChangeValue={getOnChangeValueFunc('count')} value={form.count} /></div>\r\n\t\t\t\t\t<div><button onClick={onClick}>设置</button></div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\r\n\t\t\tvar CurrentForm: any = null;\r\n\t\t\tif (form.kind === 'box')\r\n\t\t\t{\r\n\t\t\t\tCurrentForm = BoxForm();\r\n\t\t\t}\r\n\t\t\telse if (form.kind === 'circle')\r\n\t\t\t{\r\n\t\t\t\tCurrentForm = CircleForm();\r\n\t\t\t}\r\n\t\t\treturn <div style={panelcss}>\r\n\t\t\t\t<div style={{ color: 'white', textAlign: 'center' }}>阵型设置</div>\r\n\t\t\t\t<div>阵型：<select style={{ width: '120px' }} value={form.kind} onChange={onKindChange}>{kindList}</select></div>\r\n\t\t\t\t{CurrentForm}\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n","export class IndeterminateCheckbox extends React.Component<any, any> {\r\n\tcomponentDidMount()\r\n\t{\r\n\t\tif (this.props.indeterminate === true)\r\n\t\t{\r\n\t\t\tthis._setIndeterminate(true);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidUpdate(previousProps)\r\n\t{\r\n\t\tif (previousProps.indeterminate !== this.props.indeterminate)\r\n\t\t{\r\n\t\t\tthis._setIndeterminate(this.props.indeterminate);\r\n\t\t}\r\n\t}\r\n\r\n\t_setIndeterminate(indeterminate)\r\n\t{\r\n\t\tconst node = ReactDOM.findDOMNode(this);\r\n\t\t(node as HTMLInputElement).indeterminate = indeterminate;\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst { indeterminate, type, ...props } = this.props;\r\n\t\treturn <input type=\"checkbox\" {...props} />;\r\n\t}\r\n}","import { IndeterminateCheckbox } from './IndeterminateCheckbox'\r\n\r\nconst MY_CURVE_TYPE = 'MirrorGhostCurve'\r\n\r\nexport class MirrorGhostCurveEditor extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\r\n\trender()\r\n\t{\r\n\t\tfunction BindButton()\r\n\t\t{\r\n\t\t\t//var NullButton = <button disabled={true}>绑定</button>;\r\n\t\t\tvar sels = app.selection.selectionCurves;\r\n\r\n\t\t\tif (sels.length === 1)\r\n\t\t\t{\r\n\t\t\t\tif (sels[0].curve.curveType === MY_CURVE_TYPE &&\r\n\t\t\t\t\t!sels[0].curve.getParameter('refCurve'))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn <div style={{ color: 'red' }}>请同时选择另一条曲线进行绑定</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (sels.length != 2) return null;\r\n\t\t\tvar [one, other] = sels;\r\n\t\t\tif (!one || one.curve.curveType !== MY_CURVE_TYPE)\r\n\t\t\t\t[one, other] = [other, one];\r\n\t\t\tif (!one || one.curve.curveType != MY_CURVE_TYPE) return null;\r\n\t\t\tif (!other || other.curve.isGhostCurve) return null;\r\n\r\n\r\n\r\n\r\n\t\t\tfunction bind()\r\n\t\t\t{\r\n\t\t\t\t// if (one.setParameter('refCurve', other.curve))\r\n\t\t\t\t// {\r\n\t\t\t\t// \tone.clearBindingCurveChange();\r\n\t\t\t\t// \tone.bindCurveChange(other);\r\n\t\t\t\t// }\r\n\t\t\t\t// else\r\n\t\t\t\t// {\r\n\t\t\t\t// \tconsole.error('bind error??');\r\n\t\t\t\t// }\r\n\t\t\t\tone.setParameter('refUUID', other.uuid);\r\n\t\t\t}\r\n\t\t\treturn <div><button onClick={bind}>绑定</button></div>;\r\n\t\t}\r\n\r\n\t\tfunction FlipToggle()\r\n\t\t{\r\n\t\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\t\tif (curve && curve.curve.curveType === MY_CURVE_TYPE)\r\n\t\t\t{\r\n\t\t\t\tvar key = 'flipRotation';\r\n\t\t\t\tvar value = curve.getParameter(key);\r\n\t\t\t\tfunction onChange(e)\r\n\t\t\t\t{\r\n\t\t\t\t\tcurve && curve.setParameter(key, e.target.checked);\r\n\t\t\t\t}\r\n\t\t\t\treturn <div>翻转背部朝向：<IndeterminateCheckbox checked={value} onChange={onChange} /></div>\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn <>{FlipToggle()}{BindButton()}</>\r\n\t}\r\n}","import { NumberBox } from './NumberBox'\r\nimport { TranslationGhostCurveEditor } from './TranslationGhostCurveEditor'\r\nimport { IndeterminateCheckbox } from './IndeterminateCheckbox'\r\nimport { MirrorGhostCurveEditor } from './MirrorGhostCurveEditor'\r\nexport class CurveEditor extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {};\r\n\t}\r\n\tcomponentWillUnmount()\r\n\t{\r\n\t\tconsole.log('will unmount');\r\n\t}\r\n\trender()\r\n\t{\r\n\t\tvar css_round_box: React.CSSProperties = {\r\n\t\t\tborderRadius: '5px',\r\n\t\t\tborder: '1px solid white',\r\n\t\t\tpadding: '4px 0 4px 0'\r\n\r\n\t\t}\r\n\t\treturn <div className='CurveEditor'>\r\n\t\t\t<div style={css_round_box}>\r\n\t\t\t\t<div style={{ textAlign: 'center', borderBottom: '1px solid white', margin: '0' }}>创建曲线</div>\r\n\t\t\t\t<CreateCurveButton type='CatmullRomCurve3' name='自动曲线' />\r\n\t\t\t\t<CreateCurveButton type='QuadraticBezierCurve3' name='二次贝塞尔曲线' />\r\n\t\t\t\t<CreateCurveButton type='CubicBezierCurve3' name='三次贝塞尔曲线' />\r\n\t\t\t\t<CreateCurveButton type='ArcCurve' name='螺旋曲线' />\r\n\t\t\t\t<CreateCurveButton type='TranslationGhostCurve' name='多重分身曲线' />\r\n\t\t\t\t<CreateCurveButton type='MirrorGhostCurve' name='镜像曲线' />\r\n\t\t\t</div>\r\n\t\t\t<CurveCommonEditor />\r\n\t\t\t<hr />\r\n\t\t\t<ArcCurveEditor />\r\n\t\t\t<CatmullRomCurve3Editor />\r\n\t\t\t<TranslationGhostCurveEditor />\r\n\t\t\t<MirrorGhostCurveEditor />\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nfunction CurveCommonEditor()\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\tfunction SelectAllButton()\r\n\t{\r\n\t\tvar disabled = !app.selection.cmd_isAllowSelectAll();\r\n\t\treturn <button onClick={e => app.selection.cmd_selectAll()} disabled={disabled}>选中整条曲线</button>\r\n\t}\r\n\tfunction RemoveCurveButton(props)\r\n\t{\r\n\t\tvar disabled = !app.selection.cmd_isAllowRemoveCurve();\r\n\t\tfunction onClick()\r\n\t\t{\r\n\t\t\tapp.selection.cmd_removeCurve();\r\n\t\t}\r\n\t\tvar css = {\r\n\t\t\tcolor: disabled ? undefined : 'red'\r\n\t\t};\r\n\t\treturn <button style={css} onClick={onClick} disabled={disabled}>删除当前曲线</button>\r\n\t}\r\n\r\n\tvar curves = app.selection.selectionCurves;\r\n\tvar allVisible = curves.every(x => x.visible);\r\n\tvar allHidden = curves.every(x => !x.visible);\r\n\tfunction onVisibleChange(e)\r\n\t{\r\n\t\tapp.selection.selectionCurves.forEach(c =>\r\n\t\t{\r\n\t\t\tc.visible = !!e.target.checked;\r\n\t\t})\r\n\t}\r\n\r\n\tfunction MirrorButton()\r\n\t{\r\n\t\tfunction onClick()\r\n\t\t{\r\n\t\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\t\tif (curve)\r\n\t\t\t{\r\n\t\t\t\tcurve.applyOperator({ type: 'mirrorX' });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isEnable()\r\n\t\t{\r\n\t\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\t\treturn curve && curve.allowOperator({ type: 'mirrorX' });\r\n\t\t}\r\n\t\treturn <button onClick={onClick} disabled={!isEnable()}>X镜像</button>\r\n\t}\r\n\r\n\tfunction MotionSpeedBox()\r\n\t{\r\n\t\tvar css = { width: '50%' };\r\n\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\tfunction onChangeValue(val)\r\n\t\t{\r\n\t\t\tif (curve)\r\n\t\t\t{\r\n\t\t\t\tcurve.motionSpeed = val;\r\n\t\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar elem = <NumberBox disabled={!curve} style={css} min={0} step={1} value={curve ? curve.motionSpeed : '--'} onChangeValue={onChangeValue} />\r\n\t\treturn elem;\r\n\t}\r\n\r\n\tfunction NameEditor()\r\n\t{\r\n\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\tvar style = {\r\n\t\t\twidth: '120px'\r\n\t\t}\r\n\t\tif (curve)\r\n\t\t{\r\n\t\t\tfunction onChange(e)\r\n\t\t\t{\r\n\t\t\t\tif (curve)\r\n\t\t\t\t{\r\n\t\t\t\t\tcurve.name = e.target.value;\r\n\t\t\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn <input style={style} type='text' value={curve.name} onChange={onChange} />\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn <input style={style} type='text' value='' disabled />\r\n\t\t}\r\n\t}\r\n\r\n\treturn <div>\r\n\t\t<div><CurveList /></div>\r\n\t\t<div style={{ overflow: 'hidden', whiteSpace: 'nowrap' }}>曲线类型：{curve ? curve.curve.curveType : ''}</div>\r\n\t\t<div title='越低越好'>曲线误差：   {curve ? ((Math.floor(curve.curve.getParameter('curveError') * 10000))) / 100 + '%' : ''}</div>\r\n\t\t<div><SelectAllButton /><RemoveCurveButton /></div>\r\n\t\t<div><MirrorButton /></div>\r\n\t\t<div>曲线名字：{NameEditor()}</div>\r\n\t\t<div>运动速度：{MotionSpeedBox()}</div>\r\n\t\t<div>生成质量：{ParameterBox('generateQuality', 1)}</div>\r\n\t\t<div>曲线颜色：<CurveColorInput /></div>\r\n\t\t<div>显示曲线：<IndeterminateCheckbox disabled={curves.length === 0} indeterminate={!allHidden && !allVisible} checked={allVisible} onChange={onVisibleChange} /></div>\r\n\t\t<div>鱼群偏移：<br />{AnimOffsetEditor()}</div>\r\n\t\t<div>鱼群延迟：{AnimWaitEditor()}</div>\r\n\t</div>\r\n}\r\n\r\nfunction AnimOffsetEditor()\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\tfunction Axis(key)\r\n\t{\r\n\t\tvar style = {\r\n\t\t\twidth: '36px'\r\n\t\t};\r\n\t\tif (!curve)\r\n\t\t{\r\n\t\t\treturn <span>{key}: <NumberBox style={style} disabled={true} /></span>\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar pt = curve.animOffset;\r\n\t\t\tfunction onChangeValue(val)\r\n\t\t\t{\r\n\t\t\t\tapp.recordCurveModify(curve!);\r\n\t\t\t\tpt[key] = val;\r\n\t\t\t\tcurve!.dirtyForAnimation = true;\r\n\t\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t\t}\r\n\t\t\tfunction onChangeDelta(val)\r\n\t\t\t{\r\n\t\t\t\tpt[key] += val;\r\n\t\t\t\tcurve!.dirtyForAnimation = true;\r\n\t\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t\t}\r\n\t\t\tfunction onChangeStart()\r\n\t\t\t{\r\n\t\t\t\tapp.recordCurveModify(curve!);\r\n\t\t\t}\r\n\r\n\t\t\tvar showValue = Math.round(pt[key] * 100) / 100;\r\n\t\t\treturn <span>{key}: <NumberBox style={style} step={1} value={showValue.toString()} onChangeValue={onChangeValue} onChangeDelta={onChangeDelta} onChangeStart={onChangeStart} /></span>\r\n\t\t}\r\n\t}\r\n\treturn <>{Axis('x')} {Axis('y')} {Axis('z')}</>\r\n}\r\n\r\nfunction AnimWaitEditor()\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\tvar css = { width: '50%' };\r\n\tif (!curve)\r\n\t{\r\n\t\treturn <NumberBox style={css} disabled={true} />\r\n\t}\r\n\telse\r\n\t{\r\n\t\tfunction onChangeValue(val)\r\n\t\t{\r\n\t\t\tapp.recordCurveModify(curve!);\r\n\t\t\tcurve!.animWait = val;\r\n\t\t\tcurve!.dirtyForAnimation = true;\r\n\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t}\r\n\t\tfunction onChangeDelta(val)\r\n\t\t{\r\n\t\t\tcurve!.animWait += val;\r\n\t\t\tcurve!.dirtyForAnimation = true;\r\n\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t}\r\n\t\tfunction onChangeStart()\r\n\t\t{\r\n\t\t\tapp.recordCurveModify(curve!);\r\n\t\t}\r\n\t\tvar showValue = Math.round(curve.animWait);\r\n\t\treturn <NumberBox style={css} step={1} value={showValue} onChangeDelta={onChangeDelta} onChangeValue={onChangeValue} onChangeStart={onChangeStart} />\r\n\t}\r\n}\r\n\r\nfunction CurveList()\r\n{\r\n\tvar sel = app.selection.onlyOneSelectedCurve;\r\n\tvar list = app.curves.filter(x => x.curve.curveType !== 'MirrorGhostCurve').map(curve =>\r\n\t{\r\n\t\treturn <option key={curve.uuid} value={curve.uuid}>{curve.name}{curve.visible ? '' : '(隐藏的)'}</option>\r\n\t});\r\n\tlist.unshift(<option key='' value=''>--</option>);\r\n\tfunction onChange(e)\r\n\t{\r\n\t\tif (!e.target.value)\r\n\t\t{\r\n\t\t\tapp.selection.clear();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar cc = app.getCurveByUUID(e.target.value);\r\n\t\t\tif (cc)\r\n\t\t\t{\r\n\t\t\t\tapp.selection.clear();\r\n\t\t\t\tapp.selection.add(cc.controlPoints[0]);\r\n\t\t\t\tapp.selection.cmd_selectAll();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar css = { width: '60%' };\r\n\treturn <>曲线列表：<select style={css} onChange={onChange} value={sel ? sel.uuid : ''}>{list}</select></>\r\n}\r\n\r\nfunction CurveColorInput()\r\n{\r\n\tvar curves = app.selection.selectionCurves;\r\n\tvar color;\r\n\tif (curves.length === 0)  \r\n\t{\r\n\t\tcolor = '#000000';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tcolor = curves[curves.length - 1].color;\r\n\t}\r\n\r\n\tfunction onChange(e)\r\n\t{\r\n\t\tvar value = e.target.value;\r\n\t\tfor (var c of app.selection.selectionCurves)\r\n\t\t{\r\n\t\t\tc.color = value;\r\n\t\t}\r\n\t}\r\n\treturn <input type='color' value={color} disabled={curves.length === 0} onChange={onChange} />;\r\n}\r\n\r\nfunction ArcCurveEditor(props)\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve!;\r\n\tif (!curve) return null;\r\n\tif (curve.curve.curveType !== 'ArcCurve') return null;\r\n\r\n\tfunction getOnChangeValueProc(key)\r\n\t{\r\n\t\treturn function (val)\r\n\t\t{\r\n\t\t\tcurve.setParameter(key, val);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getOnChangeDeltaProc(key)\r\n\t{\r\n\t\treturn function (val)\r\n\t\t{\r\n\t\t\tcurve.setParameter(key, curve.getParameter(key) + val);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getOnChangeStart(key)\r\n\t{\r\n\t\treturn function ()\r\n\t\t{\r\n\t\t\tapp.recordCurveModify(curve);\r\n\t\t}\r\n\t}\r\n\tvar css = { width: '50%' };\r\n\r\n\tvar Box = key => <NumberBox style={css} step={1} value={curve.getParameter(key)} onChangeValue={getOnChangeValueProc(key)} onChangeDelta={getOnChangeDeltaProc(key)} onChangeStart={getOnChangeStart(key)} />;\r\n\r\n\treturn <div>\r\n\t\t<div>半径大小： {Box('radius')}</div>\r\n\t\t<div>开始角度： {Box('degreeStart')}</div>\r\n\t\t<div>结束角度： {Box('degreeEnd')}</div>\r\n\t\t<div>额外的点： {Box('extraPointCount')}</div>\r\n\t</div>\r\n}\r\n\r\nfunction CatmullRomCurve3Editor(props)\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve!;\r\n\tif (!curve) return null;\r\n\tif (curve.curve.curveType !== 'CatmullRomCurve3')\r\n\t\treturn null;\r\n\tfunction getOnChangeValueProc(key)\r\n\t{\r\n\t\treturn function (val)\r\n\t\t{\r\n\t\t\tcurve.setParameter(key, val);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getOnChangeDeltaProc(key)\r\n\t{\r\n\t\treturn function (val)\r\n\t\t{\r\n\t\t\tcurve.setParameter(key, curve.getParameter(key) + val);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getOnChangeStart(key)\r\n\t{\r\n\t\treturn function ()\r\n\t\t{\r\n\t\t\tapp.recordCurveModify(curve);\r\n\t\t}\r\n\t}\r\n\tvar css = { width: '50%' };\r\n\r\n\tvar Box = key => <NumberBox style={css} step={0.1} value={curve.getParameter(key)} onChangeValue={getOnChangeValueProc(key)} onChangeDelta={getOnChangeDeltaProc(key)} onChangeStart={getOnChangeStart(key)} />;\r\n\r\n\treturn <div>\r\n\t\t<div>曲线张力：   {Box('tension')}</div>\r\n\t</div>\r\n}\r\n\r\nfunction ParameterBox(key: string, step = 0.1)\r\n{\r\n\tvar curve = app.selection.onlyOneSelectedCurve!;\r\n\r\n\tfunction OnChangeValue(val)\r\n\t{\r\n\t\tif (curve) curve.setParameter(key, val);\r\n\t}\r\n\r\n\tfunction OnChangeDelta(val)\r\n\t{\r\n\t\tif (curve) curve.setParameter(key, curve.getParameter(key) + val);\r\n\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tfunction OnChangeStart()\r\n\t{\r\n\t\tif (curve) app.recordCurveModify(curve);\r\n\t}\r\n\r\n\tvar css = { width: '50%' };\r\n\tvar value: number = curve ? (curve!.getParameter(key) as number || 0) : 0;\r\n\treturn <NumberBox disabled={!curve} style={css} step={step}\r\n\t\tvalue={value} onChangeValue={OnChangeValue}\r\n\t\tonChangeDelta={OnChangeDelta} onChangeStart={OnChangeStart} />;\r\n}\r\n\r\nfunction CreateCurveButton(props)\r\n{\r\n\tfunction onClick()\r\n\t{\r\n\t\tvar curve = app.addNewCurve(props.type);\r\n\t\tapp.recordAddCurve(curve);\r\n\t}\r\n\tvar css = {\r\n\t\twidth: '47%'\r\n\t}\r\n\treturn <><button style={css} onClick={onClick}>{props.name}</button></>\r\n}","import { NumberBox } from './NumberBox'\r\nexport class AnimationEditor extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = {};\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tvar self = this;\r\n\t\tvar playbutton;\r\n\t\tvar control = app.animationPreviewControl;\r\n\t\tif (control.isPlaying)\r\n\t\t{\r\n\t\t\tplaybutton = <button onClick={e => { control.stop(); this.setState({}) }}>停止</button>\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tplaybutton = <button onClick={e => { control.play(); this.setState({}) }}>播放</button>\r\n\t\t}\r\n\r\n\t\tfunction onTimeScaleChange(e)\r\n\t\t{\r\n\t\t\tcontrol.timeScale = e.target.value;\r\n\t\t\tself.setState({});\r\n\t\t}\r\n\r\n\t\tfunction onClickExport(e)\r\n\t\t{\r\n\t\t\tvar curve = app.selection.onlyOneSelectedCurve;\r\n\t\t\tif (curve)\r\n\t\t\t{\r\n\t\t\t\tvar buffer = curve.generateBuffer();\r\n\t\t\t\tvar blob = new Blob([buffer]);\r\n\t\t\t\tvar url = window.URL.createObjectURL(blob);\r\n\t\t\t\tvar elem = document.createElement('a');\r\n\t\t\t\telem.href = url;\r\n\t\t\t\telem.download = 'Animation88.anim3';\r\n\t\t\t\telem.style.display = 'none';\r\n\t\t\t\tdocument.body.appendChild(elem);\r\n\t\t\t\telem.click();\r\n\t\t\t\twindow.setTimeout(() =>\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.body.removeChild(elem);\r\n\t\t\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\t\t}, 60 * 1000);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onClickExportAll()\r\n\t\t{\r\n\t\t\tapp.exportAll();\r\n\t\t}\r\n\r\n\t\tfunction onClickSave()\r\n\t\t{\r\n\t\t\tvar blob = new Blob([JSON.stringify(app.toJSON(), null, '    ')]);\r\n\t\t\tvar url = window.URL.createObjectURL(blob);\r\n\t\t\tvar elem = document.createElement('a');\r\n\t\t\telem.href = url;\r\n\t\t\telem.download = 'curves.scene';\r\n\t\t\telem.style.display = 'none';\r\n\t\t\tdocument.body.appendChild(elem);\r\n\t\t\telem.click();\r\n\t\t\twindow.setTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\tdocument.body.removeChild(elem);\r\n\t\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\t}, 60 * 1000);\r\n\t\t}\r\n\r\n\t\tvar fileInput: HTMLInputElement | null;\r\n\t\tfunction onClickOpen()\r\n\t\t{\r\n\t\t\tif (fileInput)\r\n\t\t\t{\r\n\t\t\t\tfileInput.click();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onFileChange(e)\r\n\t\t{\r\n\t\t\te = e.nativeEvent;\r\n\t\t\tvar files: FileList = e.target.files;\r\n\t\t\tif (files.length === 1)\r\n\t\t\t{\r\n\t\t\t\tvar file = files[0];\r\n\t\t\t\tvar fileReader = new FileReader();\r\n\t\t\t\tfileReader.onload = function (e)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar obj;\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tobj = JSON.parse(e.target!.result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert('打开失败');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log('loaded', obj);\r\n\t\t\t\t\tapp.fromJSON(obj);\r\n\t\t\t\t\tapp.getUI().refreshSelectionControlPoints();\r\n\t\t\t\t}\r\n\t\t\t\tfileReader.readAsText(file);\r\n\r\n\t\t\t}\r\n\t\t\tconsole.log('onFileChange', e, files);\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t<div>{playbutton}</div>\r\n\t\t\t<div><button onClick={onClickExport} disabled={!app.selection.onlyOneSelectedCurve}>导出</button><button onClick={onClickExportAll}>导出全部</button></div>\r\n\t\t\t<div><button onClick={onClickSave}>保存场景</button><input onChange={onFileChange} style={{ display: 'none' }} type='file' ref={x => fileInput = x} accept='.scene' /><button onClick={onClickOpen}>打开场景</button></div>\r\n\t\t\t<div><button onClick={() => app.changeToGameView()}>游戏视图</button></div>\r\n\t\t\t<div>播放速度：\r\n\t\t\t\t<input style={{ width: '100px', verticalAlign: 'middle' }} type='range' min={0} max={5} step={0.1} value={control.timeScale} onChange={onTimeScaleChange} />\r\n\t\t\t\t{control.timeScale}</div>\r\n\t\t</>;\r\n\t}\r\n}","export class Panel extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = { show: true };\r\n\t}\r\n\tonClick(e)\r\n\t{\r\n\t\tthis.setState((ps) => { return { show: !ps.show } });\r\n\t}\r\n\trender()\r\n\t{\r\n\t\tconst up = '▲';\r\n\t\tconst down = '▼'\r\n\t\treturn <div className='panel'>\r\n\t\t\t<div className='title' onMouseDown={e => this.onClick(e)}>{this.props.title || ''}{this.state.show ? down : up}</div>\r\n\t\t\t<div className={['content', this.state.show ? \"show\" : \"hide\"].join(' ')}>{this.props.children}</div>\r\n\t\t</div>\r\n\t}\r\n}","//import { NumberBox } from './controls/NumberBox'\r\nimport { ControlPointEditor } from './controls/ControlPointEditor'\r\nimport { CurveEditor } from './controls/CurveEditor'\r\nimport { AnimationEditor } from './controls/AnimationEditor'\r\nimport { Panel } from './controls/Panel';\r\nimport { NumberBox } from './controls/NumberBox'\r\n\r\n\r\nclass UIApplication extends React.Component<any, any>\r\n{\r\n\tconstructor(props)\r\n\t{\r\n\t\tsuper(props);\r\n\t\tthis.state = { value: 0 }\r\n\t}\r\n\r\n\t//call this when selection changed\r\n\t//or control point data changed\r\n\trefreshSelectionControlPoints()\r\n\t{\r\n\t\tthis.setState({});\r\n\t}\r\n\tcomponentWillUnmount()\r\n\t{\r\n\t}\r\n\trender()\r\n\t{\r\n\r\n\t\treturn <>\r\n\t\t\t<Panel title='point editor'><ControlPointEditor /></Panel>\r\n\t\t\t<Panel title='curve editor'><CurveEditor /></Panel>\r\n\t\t\t<Panel title='动画'><AnimationEditor /></Panel>\r\n\t\t</>\r\n\t}\r\n}\r\n\r\nvar appRef = React.createRef<UIApplication>();\r\n\r\nexport function init()\r\n{\r\n\tvar uilayer = document.createElement('div');\r\n\tuilayer.id = 'uilayer';\r\n\tReactDOM.render(<UIApplication ref={appRef} />, uilayer);\r\n\tdocument.body.appendChild(uilayer);\r\n}\r\n\r\nexport function getUIApp(): UIApplication\r\n{\r\n\treturn appRef.current as UIApplication;\r\n}","import { CurveObject } from './CurveObject'\r\nimport { ControlPoint } from './ControlPoint'\r\nimport { ObjectPickControl } from './ObjectPickControl'\r\nimport { ControlPointSelection } from './ControlPointSelection'\r\nimport { AnimationPreviewControl } from './AnimationPreviewControl'\r\nimport * as UI from './ui/index';\r\n\r\nconst DEFAULT_CURVE = {\r\n\tcurves: [\r\n\t\t{\r\n\t\t\ttype: 'CatmullRomCurve3',\r\n\t\t\tpoints: [\r\n\t\t\t\t{ x: 400, y: -120, z: 100 },\r\n\t\t\t\t{ x: 200, y: -120, z: 100 },\r\n\t\t\t\t{ x: 0, y: 120, z: 100 },\r\n\t\t\t\t{ x: -200, y: -120, z: 100 },\r\n\t\t\t\t{ x: -400, y: -120, z: 100 },\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'ArcCurve',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'CubicBezierCurve3',\r\n\t\t\tpoints: [\r\n\t\t\t\t{ x: -400, y: 120, z: 300 },\r\n\t\t\t\t{ x: -400, y: -120, z: 300 },\r\n\t\t\t\t{ x: 0, y: -120, z: 300 },\r\n\t\t\t\t{ x: 0, y: 0, z: 300 },\r\n\t\t\t\t{ x: 0, y: 120, z: 300 },\r\n\t\t\t\t{ x: 400, y: 120, z: 300 },\r\n\t\t\t\t{ x: 400, y: -120, z: 300 }\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'QuadraticBezierCurve3',\r\n\t\t\tpoints: [\r\n\t\t\t\t{ x: -400, y: -120, z: 0 },\r\n\t\t\t\t{ x: -200, y: 120, z: 0 },\r\n\t\t\t\t{ x: 0, y: 120, z: 0 },\r\n\t\t\t\t{ x: 200, y: 120, z: 0 },\r\n\t\t\t\t{ x: 400, y: -120, z: 0 },\r\n\t\t\t]\r\n\t\t},\r\n\r\n\r\n\t]\r\n};\r\nDEFAULT_CURVE.curves.length = 1;\r\n\r\ntype CurveObjectUndoRecord = {\r\n\ttype: 'modify' | 'add' | 'remove',\r\n\tcurve?: CurveObject | null,\r\n\tdata?: any\r\n}[];\r\n\r\nconst CAMERA_POS = new THREE.Vector3(0, 0, -624);\r\nconst CAMERA_ROTATION = new THREE.Quaternion();\r\nconst CAMERA_TARGET = new THREE.Vector3(0, 0, 0);\r\nTHREE.Object3D.prototype['lookAt'].call({ position: CAMERA_POS, quaternion: CAMERA_ROTATION, up: new THREE.Vector3(0, 1, 0), isCamera: true }, 0, 0, 0);\r\nexport class Application\r\n{\r\n\r\n\tscene = new THREE.Scene();\r\n\tcamera: THREE.Camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);\r\n\trenderer = new THREE.WebGLRenderer();\r\n\tcurves: CurveObject[] = [];\r\n\tcontrolPoints: ControlPoint[] = [];\r\n\tcontrolPointObjects: THREE.Object3D[] = [];\r\n\tpickOfControlPoints: ObjectPickControl;\r\n\tselection: ControlPointSelection;\r\n\t//rootGui: dat.GUI = new dat.GUI();\r\n\tclock: THREE.Clock = new THREE.Clock(true);\r\n\tanimationPreviewControl: AnimationPreviewControl;\r\n\tcameraOrbitControl: THREE.OrbitControls;\r\n\tprivate _deltaTime = 0;\r\n\tprivate _records: CurveObjectUndoRecord[] = [];\r\n\r\n\tprivate _isCameraMoving = false;\r\n\tprivate _cameraMovingTime = 0;\r\n\tprivate _cameraMovingEndTime = 0.3;\r\n\tprivate _cameraTargetPosition = CAMERA_POS;\r\n\tprivate _cameraTargetRotation = CAMERA_ROTATION;\r\n\tprivate _cameraStartPosition = CAMERA_POS;\r\n\tprivate _cameraStartRotation = CAMERA_ROTATION;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tdocument.body.appendChild(this.renderer.domElement);\r\n\t\twindow.addEventListener('keydown', e =>\r\n\t\t{\r\n\t\t\tif (e.key === 'z' && e.ctrlKey)\r\n\t\t\t{\r\n\t\t\t\tthis.restoreRecord();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.domElement.addEventListener('mousedown', e =>\r\n\t\t{\r\n\t\t\tif (document.activeElement && document.activeElement['blur'])\r\n\t\t\t\tdocument.activeElement['blur']();\r\n\t\t})\r\n\r\n\t\tthis.initCommonUI();\r\n\t\tthis.initScene();\r\n\t\tthis.pickOfControlPoints = new ObjectPickControl(this);\r\n\t\tthis.pickOfControlPoints.objects = this.controlPointObjects;\r\n\t\tthis.initSelection();\r\n\t\tthis.initOrbitControl();\r\n\t\tthis.initGameCameraFrame();\r\n\t\twindow.addEventListener('resize', () => this.onResize());\r\n\t\tdocument.addEventListener('unload', e => { this.renderer.dispose(); })\r\n\t\tsetTimeout(() => this.onResize(), 1);\r\n\t\twindow['app'] = this;\r\n\r\n\t\tthis.animationPreviewControl = new AnimationPreviewControl();\r\n\r\n\t\t//var curve = this.addCurveObject();\r\n\r\n\t\tif (window.location.search !== '?reset' && localStorage.getItem('default_slot'))\r\n\t\t{\r\n\t\t\tvar data = JSON.parse(localStorage.getItem('default_slot') as string);\r\n\t\t\tthis.fromJSON(data)\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.fromJSON(DEFAULT_CURVE);\r\n\t\t}\r\n\r\n\t\tthis.renderer.setClearColor(new THREE.Color(0, 0, 0), 1);\r\n\t\tthis.animate();\r\n\r\n\t\tUI.init();\r\n\t}\r\n\r\n\r\n\tget domElement() { return this.renderer.domElement; }\r\n\tget deltaTime() { return this._deltaTime; }\r\n\tinitCommonUI()\r\n\t{\r\n\t\t//var ui = this.rootGui.addFolder('common');\r\n\t\t//ui.add(this, 'resetCamera').name('Reset camera');\r\n\t}\r\n\tinitScene()\r\n\t{\r\n\t\tthis.scene.background = new THREE.Color(0);\r\n\t\tthis.scene.add(new THREE.AmbientLight(0xf0f0f0));\r\n\r\n\t\tvar directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n\t\tthis.scene.add(directionalLight);\r\n\r\n\t\tvar helper = new THREE.GridHelper(600 * 2, 100);\r\n\t\thelper.position.y = -200;\r\n\t\thelper.material.opacity = 0.25;\r\n\t\thelper.material.transparent = true;\r\n\t\tthis.scene.add(helper);\r\n\t\thelper.visible = false;\r\n\r\n\t\tthis.camera.position.copy(CAMERA_POS);\r\n\t\tthis.camera.quaternion.copy(CAMERA_ROTATION);\r\n\t\tif (this.camera instanceof THREE.PerspectiveCamera)\r\n\t\t{\r\n\t\t\tthis.camera.fov = 60;\r\n\t\t\tthis.camera.near = 9.9;\r\n\t\t\tthis.camera.far = 2800 * 3;\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\t\t}\r\n\r\n\t\tthis.camera.updateMatrix();\r\n\t}\r\n\r\n\tinitOrbitControl()\r\n\t{\r\n\t\tvar control = new THREE.OrbitControls(this.camera, this.renderer.domElement);\r\n\t\tthis.cameraOrbitControl = control;\r\n\t}\r\n\r\n\tinitSelection()\r\n\t{\r\n\t\tthis.selection = new ControlPointSelection(this);\r\n\t\tthis.pickOfControlPoints.addEventListener('mousedown', e =>\r\n\t\t{\r\n\t\t\tvar obj = (e as any).object;\r\n\t\t\tif (obj) obj = obj['controlPoint']\r\n\t\t\tvar me: MouseEvent = (e as any).originalEvent;\r\n\t\t\tif (!obj)\r\n\t\t\t{\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (me.shiftKey)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.selection.add(obj);\r\n\t\t\t\t}\r\n\t\t\t\telse if (me.ctrlKey)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.selection.toggle(obj);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t//如果obj是selections中最后一个的话，可能是的点在了 drag gizmos上。\r\n\t\t\t\t\t//那样，如果执行了下面的代码的话，就会清空选择了。\r\n\t\t\t\t\tif (obj !== this.selection.selections[this.selection.selections.length - 1])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.selection.clear();\r\n\t\t\t\t\t\tthis.selection.add(obj);\r\n\t\t\t\t\t\tthis.selection.tryTriggerDrag(me);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tonResize()\r\n\t{\r\n\t\tvar canvas = this.renderer.domElement;\r\n\t\tthis.renderer.setSize(window.innerWidth, window.innerHeight, true);\r\n\t\tif (this.camera instanceof THREE.PerspectiveCamera)\r\n\t\t{\r\n\t\t\tthis.camera.aspect = window.innerWidth / window.innerHeight;\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\taddControlPoint(c: ControlPoint)\r\n\t{\r\n\t\tthis.controlPoints.push(c);\r\n\t\tthis.controlPointObjects.push(c.mesh);\r\n\t}\r\n\r\n\tremoveControlPoint(c: ControlPoint)\r\n\t{\r\n\t\tvar pos = this.controlPoints.indexOf(c);\r\n\t\tif (pos >= 0)\r\n\t\t{\r\n\t\t\tthis.controlPoints.splice(pos, 1);\r\n\t\t\tthis.controlPointObjects.splice(pos, 1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconsole.warn('removeControlPoint error.', c);\r\n\t\t}\r\n\t}\r\n\r\n\tanimate()\r\n\t{\r\n\t\tthis._deltaTime = this.clock.getDelta();\r\n\t\tthis.updateCameraMoving();\r\n\t\tthis.animationPreviewControl.update();\r\n\t\tthis.selection.update();\r\n\t\tfor (var c of this.curves)\r\n\t\t{\r\n\t\t\tc.update();\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t\trequestAnimationFrame(() => this.animate());\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tthis.renderer.render(this.scene, this.camera, undefined, true);\r\n\t}\r\n\r\n\trecordAllCurves()\r\n\t{\r\n\t\tthis.recordCurveModify(this.curves);\r\n\t}\r\n\r\n\trecordCurveModify(curves: CurveObject[] | CurveObject)\r\n\t{\r\n\t\tif (!Array.isArray(curves))\r\n\t\t{\r\n\t\t\tcurves = [curves];\r\n\t\t}\r\n\t\tvar record: CurveObjectUndoRecord = [];\r\n\t\tfor (var cc of curves)\r\n\t\t{\r\n\t\t\tif (this.curves.indexOf(cc) >= 0)\r\n\t\t\t{\r\n\t\t\t\trecord.push({\r\n\t\t\t\t\ttype: 'modify',\r\n\t\t\t\t\tcurve: cc,\r\n\t\t\t\t\tdata: cc.toJSON()\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (record.length > 0) this._records.push(record);\r\n\t\treturn record;\r\n\t}\r\n\r\n\trecordAddCurve(curve: CurveObject)\r\n\t{\r\n\t\tthis._records.push([\r\n\t\t\t{ type: 'add', curve: curve }\r\n\t\t]);\r\n\t}\r\n\r\n\trecordRemoveCurve(curve: CurveObject)\r\n\t{\r\n\t\tthis._records.push([\r\n\t\t\t{ type: 'remove', curve: null, data: curve.toJSON() }\r\n\t\t]);\r\n\t}\r\n\r\n\trestoreRecord()\r\n\t{\r\n\t\tvar record = this._records.pop();\r\n\t\tif (record)\r\n\t\t{\r\n\t\t\tfor (var item of record)\r\n\t\t\t{\r\n\t\t\t\tif (item.type === 'modify')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.curves.indexOf(item.curve!) >= 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titem.curve!.fromJSON(item.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (item.type === 'add')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.removeCurve(item.curve!);\r\n\t\t\t\t}\r\n\t\t\t\telse if (item.type === 'remove')\r\n\t\t\t\t{\r\n\t\t\t\t\tlet curve = new CurveObject(item.data);\r\n\t\t\t\t\tthis.addCurve(curve);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.selection.refreshSelection();\r\n\t\t\tthis.getUI().forceUpdate();\r\n\t\t}\r\n\t}\r\n\r\n\tremoveRecord()\r\n\t{\r\n\t\tthis._records.pop();\r\n\t}\r\n\t//add an alread constructed CurveObject\r\n\tprivate addCurve(curve: CurveObject)\r\n\t{\r\n\t\tcurve.attachTo(app);\r\n\t\tthis.curves.push(curve);\r\n\t\tcurve.addEventListener('change', e => this.onCurveChange(e));\r\n\t\tthis.getUI().refreshSelectionControlPoints();\r\n\t}\r\n\r\n\tchangeToGameView()\r\n\t{\r\n\t\tthis.startCameraMoving();\r\n\t}\r\n\r\n\tprivate startCameraMoving()\r\n\t{\r\n\t\tthis._cameraStartPosition = this.camera.position.clone();\r\n\t\tthis._cameraStartRotation = this.camera.quaternion.clone();\r\n\t\tthis.cameraOrbitControl.enabled = false;\r\n\t\tthis._cameraMovingTime = 0;\r\n\t\tthis._cameraMovingEndTime = 0.2;\r\n\t\tthis._isCameraMoving = true;\r\n\t}\r\n\tprivate endCameraMoving()\r\n\t{\r\n\t\tthis.cameraOrbitControl.dispose();\r\n\t\tthis.cameraOrbitControl = new THREE.OrbitControls(this.camera, this.domElement);\r\n\t\tthis._isCameraMoving = false;\r\n\t}\r\n\r\n\tprivate updateCameraMoving()\r\n\t{\r\n\t\tif (this._isCameraMoving)\r\n\t\t{\r\n\t\t\tthis._cameraMovingTime += this.deltaTime;\r\n\t\t\tvar t = this._cameraMovingTime / this._cameraMovingEndTime;\r\n\t\t\tif (t > 1) t = 1;\r\n\r\n\t\t\tthis.camera.position.lerpVectors(this._cameraStartPosition, this._cameraTargetPosition, t);\r\n\t\t\tthis.camera.quaternion.copy(this._cameraStartRotation).slerp(this._cameraTargetRotation, t);\r\n\t\t\tthis.camera.updateMatrix();\r\n\t\t\tif (t >= 1)\r\n\t\t\t{\r\n\t\t\t\tthis.endCameraMoving();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON()\r\n\t{\r\n\t\tvar curves: any[] = [];\r\n\t\tfor (var c of this.curves)\r\n\t\t{\r\n\t\t\tcurves.push(c.toJSON());\r\n\t\t}\r\n\t\treturn { curves };\r\n\t}\r\n\r\n\tfromJSON(obj)\r\n\t{\r\n\t\tif (obj && obj.curves && Array.isArray(obj.curves))\r\n\t\t{\r\n\t\t\twhile (this.curves.length > obj.curves.length)\r\n\t\t\t{\r\n\t\t\t\tvar c = this.curves.pop();\r\n\t\t\t\tc!.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < obj.curves.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar curveObj = obj.curves[i];\r\n\t\t\t\tif (this.curves[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.curves[i].curve.curveType === curveObj.type)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.curves[i].fromJSON(curveObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.curves[i].dispose();\r\n\t\t\t\t\t\tthis.curves[i] = new CurveObject(curveObj);\r\n\t\t\t\t\t\tthis.curves[i].attachTo(this);\r\n\t\t\t\t\t\tthis.curves[i].addEventListener('change', e => this.onCurveChange(e));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.curves[i] = new CurveObject(curveObj);\r\n\t\t\t\t\tthis.curves[i].attachTo(this);\r\n\t\t\t\t\tthis.curves[i].addEventListener('change', e => this.onCurveChange(e));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._records.length = 0;\r\n\t}\r\n\r\n\taddNewCurve(type: string)\r\n\t{\r\n\t\tvar curve = new CurveObject({ type: type });\r\n\t\tthis.addCurve(curve);\r\n\t\treturn curve;\r\n\t}\r\n\r\n\tremoveCurve(curve: CurveObject)\r\n\t{\r\n\t\tvar idx = this.curves.indexOf(curve);\r\n\t\tif (idx >= 0)\r\n\t\t{\r\n\t\t\tcurve.dispose();\r\n\t\t\tthis.curves.splice(idx, 1);\r\n\t\t\tthis.selection.refreshSelection();\r\n\t\t\tthis.getUI().refreshSelectionControlPoints();\r\n\t\t}\r\n\t}\r\n\r\n\tonCurveChange(e)\r\n\t{\r\n\t\tlocalStorage.setItem('default_slot', JSON.stringify(this.toJSON()));\r\n\t}\r\n\tresetCamera()\r\n\t{\r\n\t\tthis.startCameraMoving();\r\n\t}\r\n\r\n\tinitGameCameraFrame(): any\r\n\t{\r\n\t\tvar near = 9.9;\r\n\t\tvar far = 2800;\r\n\t\tvar fov = 60 - 0.5;\r\n\t\tvar aspect = 16 / 8;\r\n\t\tconst Vector3 = THREE.Vector3;\r\n\t\ttype Vector3 = THREE.Vector3;\r\n\t\tvar pos = CAMERA_POS;\r\n\t\tvar up = new Vector3(0, 1, 0);\r\n\t\tvar dir = new Vector3();\r\n\t\tdir.subVectors(CAMERA_TARGET, CAMERA_POS).normalize();\r\n\t\tvar right = up.clone().cross(dir);\r\n\r\n\t\tfunction gen(center: Vector3, w, h)\r\n\t\t{\r\n\t\t\tvar ww = right.clone().multiplyScalar(w);\r\n\t\t\tvar hh = up.clone().multiplyScalar(h);\r\n\t\t\tvar n1 = center.clone().sub(ww).sub(hh);\r\n\t\t\tvar n2 = center.clone().sub(ww).add(hh);\r\n\t\t\tvar n3 = center.clone().add(ww).add(hh);\r\n\t\t\tvar n4 = center.clone().add(ww).sub(hh);\r\n\t\t\treturn [n1, n2, n3, n4];\r\n\t\t}\r\n\r\n\t\tvar nh = near * Math.tan(fov * 0.5 * Math.PI / 180);\r\n\t\tvar nw = aspect * nh;\r\n\t\tvar nearCenter = dir.clone().multiplyScalar(near).add(pos);\r\n\r\n\t\tvar fh = far * Math.tan(fov * 0.5 * Math.PI / 180);\r\n\t\tvar fw = aspect * fh;\r\n\t\tvar farCenter = dir.clone().multiplyScalar(far).add(pos);\r\n\t\tvar nn = gen(nearCenter, nw, nh);\r\n\t\tvar ff = gen(farCenter, fw, fh);\r\n\t\tvar geom = new THREE.Geometry();\r\n\t\tgeom.vertices.push(\r\n\t\t\tnn[0], nn[1],\r\n\t\t\tnn[1], nn[2],\r\n\t\t\tnn[2], nn[3],\r\n\t\t\tnn[3], nn[0],\r\n\r\n\t\t\tff[0], ff[1],\r\n\t\t\tff[1], ff[2],\r\n\t\t\tff[2], ff[3],\r\n\t\t\tff[3], ff[0],\r\n\r\n\t\t\tnn[0], ff[0],\r\n\t\t\tnn[1], ff[1],\r\n\t\t\tnn[2], ff[2],\r\n\t\t\tnn[3], ff[3],\r\n\t\t);\r\n\t\tvar mat = new THREE.LineBasicMaterial({ color: 0xff0000 })\r\n\t\tthis.scene.add(new THREE.LineSegments(geom, mat));\r\n\r\n\t\tvar geom2 = new THREE.BufferGeometry();\r\n\r\n\t\tgeom2.addAttribute('position',\r\n\t\t\tnew THREE.BufferAttribute(\r\n\t\t\t\tnew Float32Array([\r\n\t\t\t\t\tff[0].x, ff[0].y, ff[0].z,\r\n\t\t\t\t\tff[1].x, ff[1].y, ff[1].z,\r\n\t\t\t\t\tff[2].x, ff[2].y, ff[2].z,\r\n\t\t\t\t\tff[3].x, ff[3].y, ff[3].z,\r\n\t\t\t\t]), 3)\r\n\t\t);\r\n\r\n\r\n\r\n\t\tgeom2.addAttribute('uv',\r\n\t\t\tnew THREE.BufferAttribute(\r\n\t\t\t\tnew Float32Array([\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\t0, 1,\r\n\t\t\t\t\t1, 1,\r\n\t\t\t\t\t1, 0\r\n\t\t\t\t]), 2));\r\n\t\tgeom2.setIndex([0, 1, 2, 0, 2, 3]);\r\n\r\n\r\n\t\tvar texture = new THREE.TextureLoader().load('res/bg.jpg');\r\n\t\tvar mat2 = new THREE.MeshBasicMaterial({ color: 0xffff00, map: texture, polygonOffset: true, polygonOffsetFactor: 1, polygonOffsetUnits: 1 });\r\n\t\tthis.scene.add(new THREE.Mesh(geom2, mat2));\r\n\t}\r\n\r\n\tgetUI()\r\n\t{\r\n\t\treturn UI.getUIApp();\r\n\t}\r\n\r\n\tgetCurveByUUID(id: string): CurveObject | null\r\n\t{\r\n\t\tfor (var c of this.curves)\r\n\t\t{\r\n\t\t\tif (c.uuid === id) return c;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetPreviewQ()\r\n\t{\r\n\t\tvar q = (this.animationPreviewControl['_previewObject'] as THREE.Object3D).quaternion.clone();\r\n\t\tvar up = new THREE.Vector3(0, 1, 0);\r\n\t\tup.applyQuaternion(q);\r\n\t\tvar q2 = new THREE.Quaternion();\r\n\t\tq2.setFromAxisAngle(up, Math.PI);\r\n\t\treturn q.premultiply(q2);\r\n\t}\r\n\r\n\texportAll()\r\n\t{\r\n\t\tvar file = new JSZip();\r\n\t\tvar configJson = {\r\n\t\t\tredfish: [] as any[],\r\n\t\t\tfistList: [] as any[],\r\n\t\t\tfishTimes: [] as any[],\r\n\t\t\tpositionOffsets: [] as any[],\r\n\t\t\ttraceIDs: [] as any[],\r\n\t\t\tTotalTime: 0,\r\n\t\t};\r\n\t\tvar maxtime = 0;\r\n\t\tthis.curves.forEach((cc, index) =>\r\n\t\t{\r\n\t\t\tfile.file(cc.name + '.anim3', cc.generateBuffer())\r\n\t\t\tconfigJson.redfish.push(false);\r\n\t\t\tconfigJson.fistList.push(0);\r\n\t\t\tconfigJson.fishTimes.push(cc.animWait);\r\n\t\t\tconfigJson.positionOffsets.push({\r\n\t\t\t\tx: cc.animOffset.x,\r\n\t\t\t\ty: cc.animOffset.y,\r\n\t\t\t\tz: cc.animOffset.z,\r\n\t\t\t});\r\n\t\t\tconfigJson.traceIDs.push(index);\r\n\t\t\tmaxtime = Math.max(maxtime, cc.generateAnimationClip().duration);\r\n\t\t});\r\n\r\n\t\tconfigJson.TotalTime = maxtime * 1000;\r\n\r\n\t\tfile.file('config.json', 'var AllYuZheng=[];\\nAllYuZheng[0]=' + JSON.stringify(configJson, null, '    '));\r\n\r\n\r\n\r\n\t\tfile.generateAsync({ type: 'blob' })\r\n\t\t\t.then(blob =>\r\n\t\t\t{\r\n\t\t\t\tvar url = window.URL.createObjectURL(blob);\r\n\t\t\t\tvar elem = document.createElement('a');\r\n\t\t\t\telem.href = url;\r\n\t\t\t\telem.download = 'curves.zip';\r\n\t\t\t\telem.style.display = 'none';\r\n\t\t\t\tdocument.body.appendChild(elem);\r\n\t\t\t\telem.click();\r\n\t\t\t\twindow.setTimeout(() =>\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.body.removeChild(elem);\r\n\t\t\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\t\t}, 60 * 1000);\r\n\t\t\t});\r\n\t}\r\n}","///<reference path=\"types.d.ts\"/>\r\nimport { Application } from \"./Application\"\r\nwindow.onerror = function (e)\r\n{\r\n\talert('Error:\\n' + e.toString() + '\\n' + e['stack']);\r\n}\r\n\r\nexport function main()\r\n{\r\n\tvar app = new Application();\r\n}\r\n\r\n\r\n"],"names":["DEFAULT_OBJECT","CurveImpl.createCurve","UI.init","UI.getUIApp"],"mappings":"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"}